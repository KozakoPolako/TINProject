{"version":3,"sources":["webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Errors.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/ILogger.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Loggers.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Utils.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/FetchHttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/IHubProtocol.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/XhrHttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/DefaultHttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/TextMessageFormat.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HandshakeProtocol.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Subject.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HubConnection.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/ITransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/DefaultReconnectPolicy.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/AbortController.js","webpack://Lab3ChatKlient/./src/js/app.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/LongPollingTransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/ServerSentEventsTransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/WebSocketTransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HttpConnection.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/JsonHubProtocol.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HubConnectionBuilder.js","webpack://Lab3ChatKlient/./src/js/serverConn.js"],"names":["extendStatics","LogLevel","__extends","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","this","constructor","prototype","create","HttpError","_super","errorMessage","statusCode","_this","trueProto","call","Error","TimeoutError","AbortError","__assign","assign","t","s","i","n","arguments","length","HttpResponse","statusText","content","HttpClient","get","url","options","send","method","post","delete","getCookieString","NullLogger","log","_logLevel","_message","instance","Arg","isRequired","val","name","isNotEmpty","match","isIn","values","Platform","defineProperty","window","enumerable","configurable","self","isBrowser","isWebWorker","getDataDetail","data","includeContent","detail","isArrayBuffer","byteLength","view","Uint8Array","str","forEach","num","toString","substr","formatArrayBuffer","ArrayBuffer","sendMessage","logger","transportName","httpClient","accessTokenFactory","logMessageContent","withCredentials","defaultHeaders","thisArg","_arguments","generator","_a","headers","token","_b","value","responseType","response","body","f","y","g","_","label","sent","trys","ops","next","verb","Symbol","iterator","v","op","TypeError","done","pop","push","e","step","__generator","_c","getUserAgentHeader","Trace","P","Promise","resolve","reject","fulfilled","rejected","result","then","apply","SubjectSubscription","subject","observer","dispose","index","observers","indexOf","splice","cancelCallback","catch","ConsoleLogger","minimumLogLevel","outputConsole","console","logLevel","message","Critical","error","Date","toISOString","Warning","warn","Information","info","version","os","runtime","runtimeVersion","userAgent","majorAndMinor","userAgentHeaderName","isNode","getOsName","getRuntimeVersion","split","process","platform","versions","node","MessageType","FetchHttpClient","fetch","requireFunc","jar","CookieJar","fetchType","abortControllerType","bind","AbortController","request","abortController","timeoutId","msTimeout","e_1","payload","abortSignal","aborted","onabort","abort","timeout","setTimeout","cache","credentials","mode","redirect","signal","clearTimeout","ok","status","arrayBuffer","text","deserializeContent","cookies","getCookies","c","join","XhrHttpClient","xhr","XMLHttpRequest","open","undefined","setRequestHeader","keys","header","onload","responseText","onerror","ontimeout","DefaultHttpClient","TextMessageFormat","write","output","RecordSeparator","parse","input","messages","RecordSeparatorCode","String","fromCharCode","HandshakeProtocol","writeHandshakeRequest","handshakeRequest","JSON","stringify","parseHandshakeResponse","messageData","remainingData","Buffer","binaryData","separatorIndex","responseLength","slice","buffer","textData","substring","type","HubConnectionState","Subject","item","_i","err","complete","subscribe","HttpTransportType","TransferFormat","HubConnection","connection","protocol","reconnectPolicy","nextKeepAlive","serverTimeoutInMilliseconds","keepAliveIntervalInMilliseconds","handshakeProtocol","onreceive","processIncomingData","onclose","connectionClosed","callbacks","methods","closedCallbacks","reconnectingCallbacks","reconnectedCallbacks","invocationId","receivedHandshakeResponse","connectionState","Disconnected","connectionStarted","cachedPingMessage","writeMessage","Ping","connectionId","baseUrl","set","Reconnecting","start","startPromise","startWithStateTransitions","Connecting","Debug","startInternal","Connected","handshakePromise","e_2","stopDuringStartError","handshakeResolver","handshakeRejecter","transferFormat","cleanupTimeout","resetTimeoutPeriod","resetKeepAliveInterval","cleanupPingTimer","stop","stopPromise","stopInternal","Disconnecting","reconnectDelayHandle","completeClose","stream","methodName","args","promiseQueue","replaceStreamingParams","streams","streamIds","invocationDescriptor","createStreamInvocation","cancelInvocation","createCancelInvocation","sendWithProtocol","invocationEvent","Completion","launchStreams","sendPromise","createInvocation","invoke","on","newMethod","toLowerCase","off","handlers","removeIdx","callback","onreconnecting","onreconnected","processHandshakeResponse","messages_1","parseMessages","Invocation","invokeClientMethod","StreamItem","Close","allowReconnect","responseMessage","features","inherentKeepAlive","getTime","timeoutHandle","serverTimeout","pingServerHandle","nextPing","invocationMessage","target","m","cancelCallbacksWithError","reconnect","reconnectStartTime","previousReconnectAttempts","retryError","nextRetryDelay","e_4","now","getNextRetryDelay","previousRetryCount","elapsedMilliseconds","retryReason","nextRetryDelayInMilliseconds","key","nonblocking","_loop_1","streamId","createCompletionMessage","createStreamItemMessage","argument","isObservable","arg","StreamInvocation","id","CancelInvocation","DEFAULT_RETRY_DELAYS_IN_MILLISECONDS","DefaultReconnectPolicy","retryDelays","concat","retryContext","username","isAborted","LongPollingTransport","pollAbort","running","connect","pollOptions","pollUrl","Binary","getAccessToken","updateHeaderToken","closeError","receiving","poll","pollAborted","raiseOnClose","name_1","deleteOptions","logMessage","ServerSentEventsTransport","eventSourceConstructor","encodeURIComponent","opened","Text","eventSource","Cookie","onmessage","close","onopen","WebSocketTransport","webSocketConstructor","webSocket","replace","binaryType","_event","event","ErrorEvent","readyState","OPEN","isCloseEvent","wasClean","code","reason","HttpConnection","stopPromiseResolver","negotiateVersion","resolveUrl","webSocketModule","eventSourceModule","WebSocket","EventSource","startInternalPromise","sendQueue","TransportSendQueue","transport","stopError","stopConnection","negotiateResponse","redirects","this_1","e_3","skipNegotiation","WebSockets","constructTransport","startTransport","accessToken_1","getNegotiationResponse","ProtocolVersion","accessToken","createTransport","negotiateUrl","resolveNegotiateUrl","connectionToken","createConnectUrl","requestedTransport","requestedTransferFormat","connectUrl","transportExceptions","transports","negotiate","transports_1","endpoint","transportOrError","ex_1","ex_2","isITransport","availableTransports","resolveTransportOrError","ServerSentEvents","LongPolling","actualTransport","transportMatches","transferFormats","map","ex","lastIndexOf","document","aTag","createElement","href","executing","sendBufferedData","PromiseSource","transportResult","sendLoopPromise","sendLoop","bufferData","promise","error_1","concatBuffers","arrayBuffers","totalLength","reduce","a","offset","arrayBuffers_1","resolver","rejecter","JsonHubProtocol","hubMessages","parsedMessage","isInvocationMessage","isStreamItemMessage","isCompletionMessage","assertNotEmptyString","LogLevelNameMapping","trace","debug","information","warning","critical","none","None","HubConnectionBuilder","configureLogging","logging","mapping","parseLogLevel","withUrl","transportTypeOrOptions","httpConnectionOptions","withHubProtocol","withAutomaticReconnect","retryDelaysOrReconnectPolicy","isArray","build","server","signalR","onSuccess","onError","password","onEvent","destination","json","group","convName","base64","byte","selected","loginBtn","querySelector","unseen","Set","disabled","style","color","addEventListener","login","preventDefault","click","onLoginStatus","prepareWindow","getUsers","getGroupsByUser","parentNode","children","el","remove","container","appPanel","groupsList","usersList","messagesView","messageInput","imageInput","breakLine","div1","div2","div3","divBox","width","display","classList","add","height","innerHTML","accept","appendChild","file","files","toBase64","onReceiveGroupMessage","appendMessage","onReceivePrivateMessage","onReceiveUsersList","buildUsersList","onReceiveGroupsList","buildGroupsList","onReceiveMessagesPack","conv","dir","showMessages","addToGroup","sendPrivateMessage","sendGroupMessage","user","Users","has","isActive","getSelected","flag","Groups","abortion","getElementById","sel","buildConversation","removeUserFromGroup","groupInput","joinBTN","placeholder","addUserToGroup","getMessagesByGroup","msg","sender","float","textAlign","marginRight","marginLeft","scrollTop","scrollHeight","reader","FileReader","onloadend","readAsDataURL"],"mappings":"yBAEA,IACQA,ECIGC,EDLPC,GACIF,EAAgBG,OAAOC,gBACtB,CAAEC,UAAW,cAAgBC,OAAS,SAAUC,EAAGC,GAAKD,EAAEF,UAAYG,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIC,KAAKD,EAAOA,EAAEE,eAAeD,KAAIF,EAAEE,GAAKD,EAAEC,KAClE,SAAUF,EAAGC,GAEhB,SAASG,IAAOC,KAAKC,YAAcN,EADnCP,EAAcO,EAAGC,GAEjBD,EAAEO,UAAkB,OAANN,EAAaL,OAAOY,OAAOP,IAAMG,EAAGG,UAAYN,EAAEM,UAAW,IAAIH,KAInFK,EAA2B,SAAUC,GAOrC,SAASD,EAAUE,EAAcC,GAC7B,IACIC,EAAQR,KACRS,EAFaT,KAAKC,YAEKC,UAM3B,OALAM,EAAQH,EAAOK,KAAKV,KAAMM,IAAiBN,MACrCO,WAAaA,EAGnBC,EAAMf,UAAYgB,EACXD,EAEX,OAjBAlB,EAAUc,EAAWC,GAiBdD,EAlBmB,CAmB5BO,OAGEC,EAA8B,SAAUP,GAMxC,SAASO,EAAaN,QAEG,IAAjBA,IAA2BA,EAAe,uBAC9C,IAAIE,EAAQR,KACRS,EAHaT,KAAKC,YAGKC,UAK3B,OAJAM,EAAQH,EAAOK,KAAKV,KAAMM,IAAiBN,MAGrCP,UAAYgB,EACXD,EAEX,OAhBAlB,EAAUsB,EAAcP,GAgBjBO,EAjBsB,CAkB/BD,OAGEE,EAA4B,SAAUR,GAMtC,SAASQ,EAAWP,QAEK,IAAjBA,IAA2BA,EAAe,sBAC9C,IAAIE,EAAQR,KACRS,EAHaT,KAAKC,YAGKC,UAK3B,OAJAM,EAAQH,EAAOK,KAAKV,KAAMM,IAAiBN,MAGrCP,UAAYgB,EACXD,EAEX,OAhBAlB,EAAUuB,EAAYR,GAgBfQ,EAjBoB,CAkB7BF,OExEEG,EAAsCvB,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GAGPM,EACA,SAAsBf,EAAYgB,EAAYC,GAC1CxB,KAAKO,WAAaA,EAClBP,KAAKuB,WAAaA,EAClBvB,KAAKwB,QAAUA,GASnBC,EAA4B,WAC5B,SAASA,KAoBT,OAlBAA,EAAWvB,UAAUwB,IAAM,SAAUC,EAAKC,GACtC,OAAO5B,KAAK6B,KAAKf,EAAS,GAAIc,EAAS,CAAEE,OAAQ,MAAOH,IAAKA,MAEjEF,EAAWvB,UAAU6B,KAAO,SAAUJ,EAAKC,GACvC,OAAO5B,KAAK6B,KAAKf,EAAS,GAAIc,EAAS,CAAEE,OAAQ,OAAQH,IAAKA,MAElEF,EAAWvB,UAAU8B,OAAS,SAAUL,EAAKC,GACzC,OAAO5B,KAAK6B,KAAKf,EAAS,GAAIc,EAAS,CAAEE,OAAQ,SAAUH,IAAKA,MAQpEF,EAAWvB,UAAU+B,gBAAkB,SAAUN,GAC7C,MAAO,IAEJF,EArBoB,IDhB/B,SAAWpC,GAEPA,EAASA,EAAgB,MAAI,GAAK,QAElCA,EAASA,EAAgB,MAAI,GAAK,QAElCA,EAASA,EAAsB,YAAI,GAAK,cAExCA,EAASA,EAAkB,QAAI,GAAK,UAEpCA,EAASA,EAAgB,MAAI,GAAK,QAElCA,EAASA,EAAmB,SAAI,GAAK,WAErCA,EAASA,EAAe,KAAI,GAAK,OAdrC,CAeGA,IAAaA,EAAW,KEpB3B,IAAI6C,EAA4B,WAC5B,SAASA,KAQT,OAJAA,EAAWhC,UAAUiC,IAAM,SAAUC,EAAWC,KAGhDH,EAAWI,SAAW,IAAIJ,EACnBA,EAToB,GCD3B,EAAsC3C,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GA2CPuB,EAAqB,WACrB,SAASA,KAkBT,OAhBAA,EAAIC,WAAa,SAAUC,EAAKC,GAC5B,GAAID,QACA,MAAM,IAAI9B,MAAM,QAAU+B,EAAO,4BAGzCH,EAAII,WAAa,SAAUF,EAAKC,GAC5B,IAAKD,GAAOA,EAAIG,MAAM,SAClB,MAAM,IAAIjC,MAAM,QAAU+B,EAAO,oCAGzCH,EAAIM,KAAO,SAAUJ,EAAKK,EAAQJ,GAE9B,KAAMD,KAAOK,GACT,MAAM,IAAInC,MAAM,WAAa+B,EAAO,WAAaD,EAAM,MAGxDF,EAnBa,GAuBpBQ,EAA0B,WAC1B,SAASA,KAuBT,OArBAxD,OAAOyD,eAAeD,EAAU,YAAa,CACzCrB,IAAK,WACD,MAAyB,iBAAXuB,QAElBC,YAAY,EACZC,cAAc,IAElB5D,OAAOyD,eAAeD,EAAU,cAAe,CAC3CrB,IAAK,WACD,MAAuB,iBAAT0B,MAAqB,kBAAmBA,MAE1DF,YAAY,EACZC,cAAc,IAElB5D,OAAOyD,eAAeD,EAAU,SAAU,CACtCrB,IAAK,WACD,OAAQ1B,KAAKqD,YAAcrD,KAAKsD,aAEpCJ,YAAY,EACZC,cAAc,IAEXJ,EAxBkB,GA4BtB,SAASQ,EAAcC,EAAMC,GAChC,IAAIC,EAAS,GAab,OAZIC,EAAcH,IACdE,EAAS,yBAA2BF,EAAKI,WACrCH,IACAC,GAAU,eAYf,SAA2BF,GAC9B,IAAIK,EAAO,IAAIC,WAAWN,GAEtBO,EAAM,GAMV,OALAF,EAAKG,SAAQ,SAAUC,GAEnBF,GAAO,MADGE,EAAM,GAAK,IAAM,IACPA,EAAIC,SAAS,IAAM,OAGpCH,EAAII,OAAO,EAAGJ,EAAI1C,OAAS,GArBC+C,CAAkBZ,GAAQ,MAGpC,iBAATA,IACZE,EAAS,yBAA2BF,EAAKnC,OACrCoC,IACAC,GAAU,eAAiBF,EAAO,MAGnCE,EAgBJ,SAASC,EAAclB,GAC1B,OAAOA,GAA8B,oBAAhB4B,cAChB5B,aAAe4B,aAEX5B,EAAIxC,aAAwC,gBAAzBwC,EAAIxC,YAAYyC,MAGzC,SAAS4B,EAAYC,EAAQC,EAAeC,EAAY9C,EAAK+C,EAAoBlD,EAASmD,EAAmBC,EAAiBC,GACjI,OAlIkDC,EAkIjC9E,KAlI0C+E,OAkIpC,EAlImDC,EAkInC,WACnC,IAAIC,EAAIC,EAASC,EAAOC,EAAI1C,EAAM2C,EAAOC,EAAcC,EACvD,OA5HwC,SAAUT,EAASU,GAC/D,IAAsGC,EAAGC,EAAG1E,EAAG2E,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP9E,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAO+E,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEM,KAAMC,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BR,EAAEQ,OAAOC,UAAY,WAAa,OAAOpG,OAAU2F,EACvJ,SAASO,EAAK/E,GAAK,OAAO,SAAUkF,GAAK,OACzC,SAAcC,GACV,GAAIb,EAAG,MAAM,IAAIc,UAAU,mCAC3B,KAAOX,OACH,GAAIH,EAAI,EAAGC,IAAM1E,EAAY,EAARsF,EAAG,GAASZ,EAAU,OAAIY,EAAG,GAAKZ,EAAS,SAAO1E,EAAI0E,EAAU,SAAM1E,EAAEN,KAAKgF,GAAI,GAAKA,EAAEO,SAAWjF,EAAIA,EAAEN,KAAKgF,EAAGY,EAAG,KAAKE,KAAM,OAAOxF,EAE3J,OADI0E,EAAI,EAAG1E,IAAGsF,EAAK,CAAS,EAARA,EAAG,GAAQtF,EAAEqE,QACzBiB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGtF,EAAIsF,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAER,MAAOiB,EAAG,GAAIE,MAAM,GAChD,KAAK,EAAGZ,EAAEC,QAASH,EAAIY,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBzF,GAAZA,EAAI4E,EAAEG,MAAY1E,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAViF,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAActF,GAAMsF,EAAG,GAAKtF,EAAE,IAAMsF,EAAG,GAAKtF,EAAE,IAAM,CAAE4E,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAIA,EAAIsF,EAAI,MAC7D,GAAItF,GAAK4E,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAI4E,EAAEI,IAAIU,KAAKJ,GAAK,MACvDtF,EAAE,IAAI4E,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKd,EAAK9E,KAAKoE,EAASc,GAC1B,MAAOe,GAAKL,EAAK,CAAC,EAAGK,GAAIjB,EAAI,EAAK,QAAUD,EAAIzE,EAAI,EACtD,GAAY,EAARsF,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEjB,MAAOiB,EAAG,GAAKA,EAAG,QAAK,EAAQE,MAAM,GArB9BI,CAAK,CAACzF,EAAGkF,MAyH9CQ,CAAY7G,MAAM,SAAU8G,GAC/B,OAAQA,EAAGjB,OACP,KAAK,EAED,OADAX,EAAU,GACLR,EACE,CAAC,EAAaA,KADW,CAAC,EAAa,GAElD,KAAK,GACDS,EAAQ2B,EAAGhB,WAEIb,EAAK,IACM,cAAI,UAAYE,EADtCD,EAEID,GAER6B,EAAGjB,MAAQ,EACf,KAAK,EAKD,OAJAT,EAAK2B,IAAsBrE,EAAO0C,EAAG,GAAIC,EAAQD,EAAG,GACpDF,EAAQxC,GAAQ2C,EAChBd,EAAOpC,IAAI9C,EAAS2H,MAAO,IAAMxC,EAAgB,6BAA+BjB,EAAc/B,EAASmD,GAAqB,KAC5HW,EAAe3B,EAAcnC,GAAW,cAAgB,OACjD,CAAC,EAAaiD,EAAW1C,KAAKJ,EAAK,CAClCH,QAASA,EACT0D,QAAS,EAAS,GAAIA,EAASL,GAC/BS,aAAcA,EACdV,gBAAiBA,KAE7B,KAAK,EAGD,OAFAW,EAAWuB,EAAGhB,OACdvB,EAAOpC,IAAI9C,EAAS2H,MAAO,IAAMxC,EAAgB,kDAAoDe,EAAShF,WAAa,KACpH,CAAC,QA/JjB,KADgE0G,OAkIxC,KAjIbA,EAAIC,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUhC,GAAS,IAAMuB,EAAK5B,EAAUiB,KAAKZ,IAAW,MAAOsB,GAAKS,EAAOT,IACpF,SAASW,EAASjC,GAAS,IAAMuB,EAAK5B,EAAiB,MAAEK,IAAW,MAAOsB,GAAKS,EAAOT,IACvF,SAASC,EAAKW,GAAUA,EAAOf,KAAOW,EAAQI,EAAOlC,OAAS,IAAI4B,GAAE,SAAUE,GAAWA,EAAQI,EAAOlC,UAAWmC,KAAKH,EAAWC,GACnIV,GAAM5B,EAAYA,EAAUyC,MAAM3C,EAASC,GAAc,KAAKkB,WAL1B,IAAUnB,EAASC,EAAYkC,EAAGjC,EAmL9E,IAAI0C,EAAqC,WACrC,SAASA,EAAoBC,EAASC,GAClC5H,KAAK2H,QAAUA,EACf3H,KAAK4H,SAAWA,EAWpB,OATAF,EAAoBxH,UAAU2H,QAAU,WACpC,IAAIC,EAAQ9H,KAAK2H,QAAQI,UAAUC,QAAQhI,KAAK4H,UAC5CE,GAAS,GACT9H,KAAK2H,QAAQI,UAAUE,OAAOH,EAAO,GAEH,IAAlC9H,KAAK2H,QAAQI,UAAU1G,QAAgBrB,KAAK2H,QAAQO,gBACpDlI,KAAK2H,QAAQO,iBAAiBC,OAAM,SAAUvC,QAG/C8B,EAd6B,GAkBpCU,EAA+B,WAC/B,SAASA,EAAcC,GACnBrI,KAAKqI,gBAAkBA,EACvBrI,KAAKsI,cAAgBC,QAsBzB,OApBAH,EAAclI,UAAUiC,IAAM,SAAUqG,EAAUC,GAC9C,GAAID,GAAYxI,KAAKqI,gBACjB,OAAQG,GACJ,KAAKnJ,EAASqJ,SACd,KAAKrJ,EAASsB,MACVX,KAAKsI,cAAcK,MAAM,KAAM,IAAIC,MAAOC,cAAgB,KAAOxJ,EAASmJ,GAAY,KAAOC,GAC7F,MACJ,KAAKpJ,EAASyJ,QACV9I,KAAKsI,cAAcS,KAAK,KAAM,IAAIH,MAAOC,cAAgB,KAAOxJ,EAASmJ,GAAY,KAAOC,GAC5F,MACJ,KAAKpJ,EAAS2J,YACVhJ,KAAKsI,cAAcW,KAAK,KAAM,IAAIL,MAAOC,cAAgB,KAAOxJ,EAASmJ,GAAY,KAAOC,GAC5F,MACJ,QAEIzI,KAAKsI,cAAcnG,IAAI,KAAM,IAAIyG,MAAOC,cAAgB,KAAOxJ,EAASmJ,GAAY,KAAOC,KAKpGL,EAzBuB,GA6B3B,SAASrB,IACZ,IAO+BmC,EAASC,EAAIC,EAASC,EAEjDC,EACAC,EAVAC,EAAsB,uBAI1B,OAHIzG,EAAS0G,SACTD,EAAsB,cAEnB,CAACA,GAGuBN,EAnMd,QAmMuBC,EAHiBO,IAGbN,EA8CxCrG,EAAS0G,OACF,SAGA,UAlD0CJ,EAH+BM,IAKhFL,EAAY,qBACZC,EAAgBL,EAAQU,MAAM,KAClCN,GAAaC,EAAc,GAAK,IAAMA,EAAc,GACpDD,GAAa,KAAOJ,EAAU,KAE1BI,GADAH,GAAa,KAAPA,EACOA,EAAK,KAGL,eAEjBG,GAAa,GAAKF,EAEdE,GADAD,EACa,KAAOA,EAGP,4BAEjBC,GAAa,MAGjB,SAASI,IACL,IAAI3G,EAAS0G,OAaT,MAAO,GAZP,OAAQI,QAAQC,UACZ,IAAK,QACD,MAAO,aACX,IAAK,SACD,MAAO,QACX,IAAK,QACD,MAAO,QACX,QACI,OAAOD,QAAQC,UAO/B,SAASH,IACL,GAAI5G,EAAS0G,OACT,OAAOI,QAAQE,SAASC,KC3RhC,ICCWC,EDDP,EAAwC,WACxC,IAAI7K,EAAgBG,OAAOC,gBACtB,CAAEC,UAAW,cAAgBC,OAAS,SAAUC,EAAGC,GAAKD,EAAEF,UAAYG,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIC,KAAKD,EAAOA,EAAEE,eAAeD,KAAIF,EAAEE,GAAKD,EAAEC,KACzE,OAAO,SAAUF,EAAGC,GAEhB,SAASG,IAAOC,KAAKC,YAAcN,EADnCP,EAAcO,EAAGC,GAEjBD,EAAEO,UAAkB,OAANN,EAAaL,OAAOY,OAAOP,IAAMG,EAAGG,UAAYN,EAAEM,UAAW,IAAIH,IAP3C,GAUxC,EAAsCR,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GAyCPkJ,EAAiC,SAAU7J,GAE3C,SAAS6J,EAAgB3F,GACrB,IAAI/D,EAAQH,EAAOK,KAAKV,OAASA,KAEjC,GADAQ,EAAM+D,OAASA,EACM,oBAAV4F,MAAuB,CAG9B,IAAIC,EAA0D,QAE9D5J,EAAM6J,IAAM,IAAKD,EAAY,gBAAiBE,WAC9C9J,EAAM+J,UAAYH,EAAY,cAG9B5J,EAAM+J,UAAYH,EAAY,eAAZA,CAA4B5J,EAAM+J,UAAW/J,EAAM6J,KAErE7J,EAAMgK,oBAAsBJ,EAAY,yBAGxC5J,EAAM+J,UAAYJ,MAAMM,KAAKrH,MAC7B5C,EAAMgK,oBAAsBE,gBAEhC,OAAOlK,EAyFX,OA9GA,EAAU0J,EAAiB7J,GAwB3B6J,EAAgBhK,UAAU2B,KAAO,SAAU8I,GACvC,OAjE8C7F,EAiE7B9E,KAjEsC+E,OAiEhC,EAjE+CC,EAiE/B,WACnC,IAAI4F,EAAiBjC,EAAOkC,EAAWC,EAAWvF,EAAUwF,EAAcC,EACtExK,EAAQR,KACZ,OA5DoC,SAAU8E,EAASU,GAC/D,IAAsGC,EAAGC,EAAG1E,EAAG2E,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP9E,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAO+E,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEM,KAAMC,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BR,EAAEQ,OAAOC,UAAY,WAAa,OAAOpG,OAAU2F,EACvJ,SAASO,EAAK/E,GAAK,OAAO,SAAUkF,GAAK,OACzC,SAAcC,GACV,GAAIb,EAAG,MAAM,IAAIc,UAAU,mCAC3B,KAAOX,OACH,GAAIH,EAAI,EAAGC,IAAM1E,EAAY,EAARsF,EAAG,GAASZ,EAAU,OAAIY,EAAG,GAAKZ,EAAS,SAAO1E,EAAI0E,EAAU,SAAM1E,EAAEN,KAAKgF,GAAI,GAAKA,EAAEO,SAAWjF,EAAIA,EAAEN,KAAKgF,EAAGY,EAAG,KAAKE,KAAM,OAAOxF,EAE3J,OADI0E,EAAI,EAAG1E,IAAGsF,EAAK,CAAS,EAARA,EAAG,GAAQtF,EAAEqE,QACzBiB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGtF,EAAIsF,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAER,MAAOiB,EAAG,GAAIE,MAAM,GAChD,KAAK,EAAGZ,EAAEC,QAASH,EAAIY,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBzF,GAAZA,EAAI4E,EAAEG,MAAY1E,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAViF,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAActF,GAAMsF,EAAG,GAAKtF,EAAE,IAAMsF,EAAG,GAAKtF,EAAE,IAAM,CAAE4E,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAIA,EAAIsF,EAAI,MAC7D,GAAItF,GAAK4E,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAI4E,EAAEI,IAAIU,KAAKJ,GAAK,MACvDtF,EAAE,IAAI4E,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKd,EAAK9E,KAAKoE,EAASc,GAC1B,MAAOe,GAAKL,EAAK,CAAC,EAAGK,GAAIjB,EAAI,EAAK,QAAUD,EAAIzE,EAAI,EACtD,GAAY,EAARsF,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEjB,MAAOiB,EAAG,GAAKA,EAAG,QAAK,EAAQE,MAAM,GArB9BI,CAAK,CAACzF,EAAGkF,MAyD1C,CAAYrG,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAED,GAAI8E,EAAQM,aAAeN,EAAQM,YAAYC,QAC3C,MAAM,IAAIrK,EAEd,IAAK8J,EAAQ7I,OACT,MAAM,IAAInB,MAAM,sBAEpB,IAAKgK,EAAQhJ,IACT,MAAM,IAAIhB,MAAM,mBAEpBiK,EAAkB,IAAI5K,KAAKwK,oBAEvBG,EAAQM,cACRN,EAAQM,YAAYE,QAAU,WAC1BP,EAAgBQ,QAChBzC,EAAQ,IAAI9H,IAGpBgK,EAAY,KACRF,EAAQU,UACRP,EAAYH,EAAQU,QACpBR,EAAYS,YAAW,WACnBV,EAAgBQ,QAChB5K,EAAM+D,OAAOpC,IAAI9C,EAASyJ,QAAS,8BACnCH,EAAQ,IAAI/H,IACbkK,IAEP7F,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,EAAG,IAChB,CAAC,EAAa1G,KAAKuK,UAAUI,EAAQhJ,IAAK,CACzC6D,KAAMmF,EAAQnJ,QACd+J,MAAO,WACPC,aAAyC,IAA5Bb,EAAQ/F,gBAA2B,UAAY,cAC5DM,QAAS,EAAS,CAAE,eAAgB,2BAA4B,mBAAoB,kBAAoByF,EAAQzF,SAChHpD,OAAQ6I,EAAQ7I,OAChB2J,KAAM,OACNC,SAAU,SACVC,OAAQf,EAAgBe,UAEpC,KAAK,EAED,OADApG,EAAWN,EAAGa,OACP,CAAC,EAAa,GACzB,KAAK,EAED,GADAiF,EAAM9F,EAAGa,OACL6C,EACA,MAAMA,EAGV,MADA3I,KAAKuE,OAAOpC,IAAI9C,EAASyJ,QAAS,4BAA8BiC,EAAM,KAChEA,EACV,KAAK,EAOD,OANIF,GACAe,aAAaf,GAEbF,EAAQM,cACRN,EAAQM,YAAYE,QAAU,MAE3B,CAAC,GACZ,KAAK,EACD,IAAK5F,EAASsG,GACV,MAAM,IAAIzL,EAAUmF,EAAShE,WAAYgE,EAASuG,QAGtD,MAAO,CAAC,EAmBhC,SAA4BvG,EAAUD,GAClC,IAAI9D,EACJ,OAAQ8D,GACJ,IAAK,cACD9D,EAAU+D,EAASwG,cACnB,MACJ,IAAK,OACDvK,EAAU+D,EAASyG,OACnB,MACJ,IAAK,OACL,IAAK,WACL,IAAK,OACD,MAAM,IAAIrL,MAAM2E,EAAe,sBACnC,QACI9D,EAAU+D,EAASyG,OAG3B,OAAOxK,EArCuByK,CAAmB1G,EAAUoF,EAAQrF,eAEnD,KAAK,EAED,OADA0F,EAAU/F,EAAGa,OACN,CAAC,EAAc,IAAIxE,EAAaiE,EAASuG,OAAQvG,EAAShE,WAAYyJ,SAxI1F,KADgE/D,OAiEpC,KAhEjBA,EAAIC,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUhC,GAAS,IAAMuB,EAAK5B,EAAUiB,KAAKZ,IAAW,MAAOsB,GAAKS,EAAOT,IACpF,SAASW,EAASjC,GAAS,IAAMuB,EAAK5B,EAAiB,MAAEK,IAAW,MAAOsB,GAAKS,EAAOT,IACvF,SAASC,EAAKW,GAAUA,EAAOf,KAAOW,EAAQI,EAAOlC,OAAS,IAAI4B,GAAE,SAAUE,GAAWA,EAAQI,EAAOlC,UAAWmC,KAAKH,EAAWC,GACnIV,GAAM5B,EAAYA,EAAUyC,MAAM3C,EAASC,GAAc,KAAKkB,WAL1B,IAAUnB,EAASC,EAAYkC,EAAGjC,GA8I1EkF,EAAgBhK,UAAU+B,gBAAkB,SAAUN,GAClD,IAAIuK,EAAU,GAKd,OAJInJ,EAAS0G,QAAUzJ,KAAKqK,KAExBrK,KAAKqK,IAAI8B,WAAWxK,GAAK,SAAUgF,EAAGyF,GAAK,OAAOF,EAAUE,EAAEC,KAAK,SAEhEH,GAEJhC,EA/GyB,CAgHlCzI,GEzKE,EAAwC,WACxC,IAAIrC,EAAgBG,OAAOC,gBACtB,CAAEC,UAAW,cAAgBC,OAAS,SAAUC,EAAGC,GAAKD,EAAEF,UAAYG,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIC,KAAKD,EAAOA,EAAEE,eAAeD,KAAIF,EAAEE,GAAKD,EAAEC,KACzE,OAAO,SAAUF,EAAGC,GAEhB,SAASG,IAAOC,KAAKC,YAAcN,EADnCP,EAAcO,EAAGC,GAEjBD,EAAEO,UAAkB,OAANN,EAAaL,OAAOY,OAAOP,IAAMG,EAAGG,UAAYN,EAAEM,UAAW,IAAIH,IAP3C,GAaxCuM,EAA+B,SAAUjM,GAEzC,SAASiM,EAAc/H,GACnB,IAAI/D,EAAQH,EAAOK,KAAKV,OAASA,KAEjC,OADAQ,EAAM+D,OAASA,EACR/D,EA+DX,OAnEA,EAAU8L,EAAejM,GAOzBiM,EAAcpM,UAAU2B,KAAO,SAAU8I,GACrC,IAAInK,EAAQR,KAEZ,OAAI2K,EAAQM,aAAeN,EAAQM,YAAYC,QACpChE,QAAQE,OAAO,IAAIvG,GAEzB8J,EAAQ7I,OAGR6I,EAAQhJ,IAGN,IAAIuF,SAAQ,SAAUC,EAASC,GAClC,IAAImF,EAAM,IAAIC,eACdD,EAAIE,KAAK9B,EAAQ7I,OAAQ6I,EAAQhJ,KAAK,GACtC4K,EAAI3H,qBAA8C8H,IAA5B/B,EAAQ/F,iBAAuC+F,EAAQ/F,gBAC7E2H,EAAII,iBAAiB,mBAAoB,kBAEzCJ,EAAII,iBAAiB,eAAgB,4BACrC,IAAIzH,EAAUyF,EAAQzF,QAClBA,GACA3F,OAAOqN,KAAK1H,GACPlB,SAAQ,SAAU6I,GACnBN,EAAII,iBAAiBE,EAAQ3H,EAAQ2H,OAGzClC,EAAQrF,eACRiH,EAAIjH,aAAeqF,EAAQrF,cAE3BqF,EAAQM,cACRN,EAAQM,YAAYE,QAAU,WAC1BoB,EAAInB,QACJhE,EAAO,IAAIvG,KAGf8J,EAAQU,UACRkB,EAAIlB,QAAUV,EAAQU,SAE1BkB,EAAIO,OAAS,WACLnC,EAAQM,cACRN,EAAQM,YAAYE,QAAU,MAE9BoB,EAAIT,QAAU,KAAOS,EAAIT,OAAS,IAClC3E,EAAQ,IAAI7F,EAAaiL,EAAIT,OAAQS,EAAIhL,WAAYgL,EAAIhH,UAAYgH,EAAIQ,eAGzE3F,EAAO,IAAIhH,EAAUmM,EAAIhL,WAAYgL,EAAIT,UAGjDS,EAAIS,QAAU,WACVxM,EAAM+D,OAAOpC,IAAI9C,EAASyJ,QAAS,4BAA8ByD,EAAIT,OAAS,KAAOS,EAAIhL,WAAa,KACtG6F,EAAO,IAAIhH,EAAUmM,EAAIhL,WAAYgL,EAAIT,UAE7CS,EAAIU,UAAY,WACZzM,EAAM+D,OAAOpC,IAAI9C,EAASyJ,QAAS,8BACnC1B,EAAO,IAAIxG,IAEf2L,EAAI1K,KAAK8I,EAAQnJ,SAAW,OA/CrB0F,QAAQE,OAAO,IAAIzG,MAAM,oBAHzBuG,QAAQE,OAAO,IAAIzG,MAAM,wBAqDjC2L,EApEuB,CAqEhC7K,GClFE,EAAwC,WACxC,IAAIrC,EAAgBG,OAAOC,gBACtB,CAAEC,UAAW,cAAgBC,OAAS,SAAUC,EAAGC,GAAKD,EAAEF,UAAYG,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIC,KAAKD,EAAOA,EAAEE,eAAeD,KAAIF,EAAEE,GAAKD,EAAEC,KACzE,OAAO,SAAUF,EAAGC,GAEhB,SAASG,IAAOC,KAAKC,YAAcN,EADnCP,EAAcO,EAAGC,GAEjBD,EAAEO,UAAkB,OAANN,EAAaL,OAAOY,OAAOP,IAAMG,EAAGG,UAAYN,EAAEM,UAAW,IAAIH,IAP3C,GAgBxCmN,EAAmC,SAAU7M,GAG7C,SAAS6M,EAAkB3I,GACvB,IAAI/D,EAAQH,EAAOK,KAAKV,OAASA,KACjC,GAAqB,oBAAVmK,OAAyBpH,EAAS0G,OACzCjJ,EAAMiE,WAAa,IAAIyF,EAAgB3F,OAEtC,IAA8B,oBAAnBiI,eAIZ,MAAM,IAAI7L,MAAM,+BAHhBH,EAAMiE,WAAa,IAAI6H,EAAc/H,GAKzC,OAAO/D,EAmBX,OAhCA,EAAU0M,EAAmB7M,GAgB7B6M,EAAkBhN,UAAU2B,KAAO,SAAU8I,GAEzC,OAAIA,EAAQM,aAAeN,EAAQM,YAAYC,QACpChE,QAAQE,OAAO,IAAIvG,GAEzB8J,EAAQ7I,OAGR6I,EAAQhJ,IAGN3B,KAAKyE,WAAW5C,KAAK8I,GAFjBzD,QAAQE,OAAO,IAAIzG,MAAM,oBAHzBuG,QAAQE,OAAO,IAAIzG,MAAM,wBAOxCuM,EAAkBhN,UAAU+B,gBAAkB,SAAUN,GACpD,OAAO3B,KAAKyE,WAAWxC,gBAAgBN,IAEpCuL,EAjC2B,CAkCpCzL,GChDE0L,EAAmC,WACnC,SAASA,KAeT,OAbAA,EAAkBC,MAAQ,SAAUC,GAChC,MAAO,GAAKA,EAASF,EAAkBG,iBAE3CH,EAAkBI,MAAQ,SAAUC,GAChC,GAAIA,EAAMA,EAAMnM,OAAS,KAAO8L,EAAkBG,gBAC9C,MAAM,IAAI3M,MAAM,0BAEpB,IAAI8M,EAAWD,EAAM5D,MAAMuD,EAAkBG,iBAE7C,OADAG,EAAShH,MACFgH,GAEXN,EAAkBO,oBAAsB,GACxCP,EAAkBG,gBAAkBK,OAAOC,aAAaT,EAAkBO,qBACnEP,EAhB2B,GCClCU,EAAmC,WACnC,SAASA,KA8CT,OA3CAA,EAAkB3N,UAAU4N,sBAAwB,SAAUC,GAC1D,OAAOZ,EAAkBC,MAAMY,KAAKC,UAAUF,KAElDF,EAAkB3N,UAAUgO,uBAAyB,SAAU1K,GAC3D,IACI2K,EACAC,EACJ,GAAIzK,EAAcH,IAA4B,oBAAX6K,QAA0B7K,aAAgB6K,OAAS,CAElF,IAAIC,EAAa,IAAIxK,WAAWN,GAEhC,IAAwB,KADpB+K,EAAiBD,EAAWtG,QAAQmF,EAAkBO,sBAEtD,MAAM,IAAI/M,MAAM,0BAIpB,IAAI6N,EAAiBD,EAAiB,EACtCJ,EAAcR,OAAOC,aAAanG,MAAM,KAAM6G,EAAWG,MAAM,EAAGD,IAClEJ,EAAiBE,EAAW1K,WAAa4K,EAAkBF,EAAWG,MAAMD,GAAgBE,OAAS,SAEpG,CACD,IACIH,EADAI,EAAWnL,EAEf,IAAwB,KADpB+K,EAAiBI,EAAS3G,QAAQmF,EAAkBG,kBAEpD,MAAM,IAAI3M,MAAM,0BAIhB6N,EAAiBD,EAAiB,EACtCJ,EAAcQ,EAASC,UAAU,EAAGJ,GACpCJ,EAAiBO,EAAStN,OAASmN,EAAkBG,EAASC,UAAUJ,GAAkB,KAG9F,IAAIf,EAAWN,EAAkBI,MAAMY,GACnC5I,EAAWyI,KAAKT,MAAME,EAAS,IACnC,GAAIlI,EAASsJ,KACT,MAAM,IAAIlO,MAAM,kDAKpB,MAAO,CAACyN,EAHU7I,IAKfsI,EA/C2B,IJDtC,SAAW5D,GAEPA,EAAYA,EAAwB,WAAI,GAAK,aAE7CA,EAAYA,EAAwB,WAAI,GAAK,aAE7CA,EAAYA,EAAwB,WAAI,GAAK,aAE7CA,EAAYA,EAA8B,iBAAI,GAAK,mBAEnDA,EAAYA,EAA8B,iBAAI,GAAK,mBAEnDA,EAAYA,EAAkB,KAAI,GAAK,OAEvCA,EAAYA,EAAmB,MAAI,GAAK,QAd5C,CAeGA,IAAgBA,EAAc,KKfjC,ICyCW6E,EDzCPC,EAAyB,WACzB,SAASA,IACL/O,KAAK+H,UAAY,GA4BrB,OA1BAgH,EAAQ7O,UAAU+F,KAAO,SAAU+I,GAC/B,IAAK,IAAIC,EAAK,EAAGhK,EAAKjF,KAAK+H,UAAWkH,EAAKhK,EAAG5D,OAAQ4N,IACnChK,EAAGgK,GACThJ,KAAK+I,IAGtBD,EAAQ7O,UAAUyI,MAAQ,SAAUuG,GAChC,IAAK,IAAID,EAAK,EAAGhK,EAAKjF,KAAK+H,UAAWkH,EAAKhK,EAAG5D,OAAQ4N,IAAM,CACxD,IAAIrH,EAAW3C,EAAGgK,GACdrH,EAASe,OACTf,EAASe,MAAMuG,KAI3BH,EAAQ7O,UAAUiP,SAAW,WACzB,IAAK,IAAIF,EAAK,EAAGhK,EAAKjF,KAAK+H,UAAWkH,EAAKhK,EAAG5D,OAAQ4N,IAAM,CACxD,IAAIrH,EAAW3C,EAAGgK,GACdrH,EAASuH,UACTvH,EAASuH,aAIrBJ,EAAQ7O,UAAUkP,UAAY,SAAUxH,GAEpC,OADA5H,KAAK+H,UAAUrB,KAAKkB,GACb,IAAIF,EAAoB1H,KAAM4H,IAElCmH,EA9BiB,GCFxB,EAAwC,SAAUjK,EAASC,EAAYkC,EAAGjC,GAC1E,OAAO,IAAKiC,IAAMA,EAAIC,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUhC,GAAS,IAAMuB,EAAK5B,EAAUiB,KAAKZ,IAAW,MAAOsB,GAAKS,EAAOT,IACpF,SAASW,EAASjC,GAAS,IAAMuB,EAAK5B,EAAiB,MAAEK,IAAW,MAAOsB,GAAKS,EAAOT,IACvF,SAASC,EAAKW,GAAUA,EAAOf,KAAOW,EAAQI,EAAOlC,OAAS,IAAI4B,GAAE,SAAUE,GAAWA,EAAQI,EAAOlC,UAAWmC,KAAKH,EAAWC,GACnIV,GAAM5B,EAAYA,EAAUyC,MAAM3C,EAASC,GAAc,KAAKkB,YAGlE,EAA4C,SAAUnB,EAASU,GAC/D,IAAsGC,EAAGC,EAAG1E,EAAG2E,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP9E,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAO+E,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEM,KAAMC,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BR,EAAEQ,OAAOC,UAAY,WAAa,OAAOpG,OAAU2F,EACvJ,SAASO,EAAK/E,GAAK,OAAO,SAAUkF,GAAK,OACzC,SAAcC,GACV,GAAIb,EAAG,MAAM,IAAIc,UAAU,mCAC3B,KAAOX,OACH,GAAIH,EAAI,EAAGC,IAAM1E,EAAY,EAARsF,EAAG,GAASZ,EAAU,OAAIY,EAAG,GAAKZ,EAAS,SAAO1E,EAAI0E,EAAU,SAAM1E,EAAEN,KAAKgF,GAAI,GAAKA,EAAEO,SAAWjF,EAAIA,EAAEN,KAAKgF,EAAGY,EAAG,KAAKE,KAAM,OAAOxF,EAE3J,OADI0E,EAAI,EAAG1E,IAAGsF,EAAK,CAAS,EAARA,EAAG,GAAQtF,EAAEqE,QACzBiB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGtF,EAAIsF,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAER,MAAOiB,EAAG,GAAIE,MAAM,GAChD,KAAK,EAAGZ,EAAEC,QAASH,EAAIY,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBzF,GAAZA,EAAI4E,EAAEG,MAAY1E,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAViF,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAActF,GAAMsF,EAAG,GAAKtF,EAAE,IAAMsF,EAAG,GAAKtF,EAAE,IAAM,CAAE4E,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAIA,EAAIsF,EAAI,MAC7D,GAAItF,GAAK4E,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAI4E,EAAEI,IAAIU,KAAKJ,GAAK,MACvDtF,EAAE,IAAI4E,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKd,EAAK9E,KAAKoE,EAASc,GAC1B,MAAOe,GAAKL,EAAK,CAAC,EAAGK,GAAIjB,EAAI,EAAK,QAAUD,EAAIzE,EAAI,EACtD,GAAY,EAARsF,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEjB,MAAOiB,EAAG,GAAKA,EAAG,QAAK,EAAQE,MAAM,GArB9BI,CAAK,CAACzF,EAAGkF,QAiC7D,SAAWyI,GAEPA,EAAiC,aAAI,eAErCA,EAA+B,WAAI,aAEnCA,EAA8B,UAAI,YAElCA,EAAkC,cAAI,gBAEtCA,EAAiC,aAAI,eAVzC,CAWGA,IAAuBA,EAAqB,KAE/C,ICvDWO,EAYAC,ED2CPC,EAA+B,WAC/B,SAASA,EAAcC,EAAYjL,EAAQkL,EAAUC,GACjD,IAAIlP,EAAQR,KACZA,KAAK2P,cAAgB,EACrBpN,EAAIC,WAAWgN,EAAY,cAC3BjN,EAAIC,WAAW+B,EAAQ,UACvBhC,EAAIC,WAAWiN,EAAU,YACzBzP,KAAK4P,4BAxBe,IAyBpB5P,KAAK6P,gCAxBqB,KAyB1B7P,KAAKuE,OAASA,EACdvE,KAAKyP,SAAWA,EAChBzP,KAAKwP,WAAaA,EAClBxP,KAAK0P,gBAAkBA,EACvB1P,KAAK8P,kBAAoB,IAAIjC,EAC7B7N,KAAKwP,WAAWO,UAAY,SAAUvM,GAAQ,OAAOhD,EAAMwP,oBAAoBxM,IAC/ExD,KAAKwP,WAAWS,QAAU,SAAUtH,GAAS,OAAOnI,EAAM0P,iBAAiBvH,IAC3E3I,KAAKmQ,UAAY,GACjBnQ,KAAKoQ,QAAU,GACfpQ,KAAKqQ,gBAAkB,GACvBrQ,KAAKsQ,sBAAwB,GAC7BtQ,KAAKuQ,qBAAuB,GAC5BvQ,KAAKwQ,aAAe,EACpBxQ,KAAKyQ,2BAA4B,EACjCzQ,KAAK0Q,gBAAkB5B,EAAmB6B,aAC1C3Q,KAAK4Q,mBAAoB,EACzB5Q,KAAK6Q,kBAAoB7Q,KAAKyP,SAASqB,aAAa,CAAEjC,KAAM5E,EAAY8G,OA82B5E,OAv2BAxB,EAAcpP,OAAS,SAAUqP,EAAYjL,EAAQkL,EAAUC,GAC3D,OAAO,IAAIH,EAAcC,EAAYjL,EAAQkL,EAAUC,IAE3DnQ,OAAOyD,eAAeuM,EAAcrP,UAAW,QAAS,CAEpDwB,IAAK,WACD,OAAO1B,KAAK0Q,iBAEhBxN,YAAY,EACZC,cAAc,IAElB5D,OAAOyD,eAAeuM,EAAcrP,UAAW,eAAgB,CAI3DwB,IAAK,WACD,OAAO1B,KAAKwP,YAAcxP,KAAKwP,WAAWwB,cAAwB,MAEtE9N,YAAY,EACZC,cAAc,IAElB5D,OAAOyD,eAAeuM,EAAcrP,UAAW,UAAW,CAEtDwB,IAAK,WACD,OAAO1B,KAAKwP,WAAWyB,SAAW,IAOtCC,IAAK,SAAUvP,GACX,GAAI3B,KAAK0Q,kBAAoB5B,EAAmB6B,cAAgB3Q,KAAK0Q,kBAAoB5B,EAAmBqC,aACxG,MAAM,IAAIxQ,MAAM,0FAEpB,IAAKgB,EACD,MAAM,IAAIhB,MAAM,8CAEpBX,KAAKwP,WAAWyB,QAAUtP,GAE9BuB,YAAY,EACZC,cAAc,IAMlBoM,EAAcrP,UAAUkR,MAAQ,WAE5B,OADApR,KAAKqR,aAAerR,KAAKsR,4BAClBtR,KAAKqR,cAEhB9B,EAAcrP,UAAUoR,0BAA4B,WAChD,OAAO,EAAUtR,UAAM,OAAQ,GAAQ,WACnC,IAAI+K,EACJ,OAAO,EAAY/K,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EACD,GAAI7F,KAAK0Q,kBAAoB5B,EAAmB6B,aAC5C,MAAO,CAAC,EAAczJ,QAAQE,OAAO,IAAIzG,MAAM,2EAEnDX,KAAK0Q,gBAAkB5B,EAAmByC,WAC1CvR,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,2BAChCvM,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAKyR,iBAC9B,KAAK,EAKD,OAJAxM,EAAGa,OACH9F,KAAK0Q,gBAAkB5B,EAAmB4C,UAC1C1R,KAAK4Q,mBAAoB,EACzB5Q,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,yCACzB,CAAC,EAAa,GACzB,KAAK,EAID,OAHAzG,EAAM9F,EAAGa,OACT9F,KAAK0Q,gBAAkB5B,EAAmB6B,aAC1C3Q,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,gEAAkEzG,EAAM,MACjG,CAAC,EAAc7D,QAAQE,OAAO2D,IACzC,KAAK,EAAG,MAAO,CAAC,WAKhCwE,EAAcrP,UAAUuR,cAAgB,WACpC,OAAO,EAAUzR,UAAM,OAAQ,GAAQ,WACnC,IAAI2R,EAAkB5D,EAAkB6D,EACpCpR,EAAQR,KACZ,OAAO,EAAYA,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAOD,OANA7F,KAAK6R,0BAAuBnF,EAC5B1M,KAAKyQ,2BAA4B,EACjCkB,EAAmB,IAAIzK,SAAQ,SAAUC,EAASC,GAC9C5G,EAAMsR,kBAAoB3K,EAC1B3G,EAAMuR,kBAAoB3K,KAEvB,CAAC,EAAapH,KAAKwP,WAAW4B,MAAMpR,KAAKyP,SAASuC,iBAC7D,KAAK,EACD/M,EAAGa,OACHb,EAAGY,MAAQ,EACf,KAAK,EAOD,OANAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACtBqH,EAAmB,CACf0B,SAAUzP,KAAKyP,SAAS/M,KACxBwG,QAASlJ,KAAKyP,SAASvG,SAE3BlJ,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,8BACzB,CAAC,EAAaxR,KAAKsE,YAAYtE,KAAK8P,kBAAkBhC,sBAAsBC,KACvF,KAAK,EAOD,OANA9I,EAAGa,OACH9F,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,sBAAwBhJ,KAAKyP,SAAS/M,KAAO,MAEnF1C,KAAKiS,iBACLjS,KAAKkS,qBACLlS,KAAKmS,yBACE,CAAC,EAAaR,GACzB,KAAK,EAKD,GAJA1M,EAAGa,OAIC9F,KAAK6R,qBAIL,MAAM7R,KAAK6R,qBAEf,MAAO,CAAC,EAAa,GACzB,KAAK,EAOD,OANAD,EAAM3M,EAAGa,OACT9F,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,oCAAsCI,EAAM,6CAC5E5R,KAAKiS,iBACLjS,KAAKoS,mBAGE,CAAC,EAAapS,KAAKwP,WAAW6C,KAAKT,IAC9C,KAAK,EAID,MADA3M,EAAGa,OACG8L,EACV,KAAK,EAAG,MAAO,CAAC,WAShCrC,EAAcrP,UAAUmS,KAAO,WAC3B,OAAO,EAAUrS,UAAM,OAAQ,GAAQ,WACnC,IAAIqR,EACJ,OAAO,EAAYrR,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAGD,OAFAwL,EAAerR,KAAKqR,aACpBrR,KAAKsS,YAActS,KAAKuS,eACjB,CAAC,EAAavS,KAAKsS,aAC9B,KAAK,EACDrN,EAAGa,OACHb,EAAGY,MAAQ,EACf,KAAK,EAGD,OAFAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IAEf,CAAC,EAAa2K,GACzB,KAAK,EAIL,KAAK,EAED,OADMpM,EAAGa,OACF,CAAC,EAAa,GACzB,KAAK,EAAG,MAAO,CAAC,WAKhCyJ,EAAcrP,UAAUqS,aAAe,SAAU5J,GAC7C,OAAI3I,KAAK0Q,kBAAoB5B,EAAmB6B,cAC5C3Q,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,8BAAgC7I,EAAQ,8DACjEzB,QAAQC,WAEfnH,KAAK0Q,kBAAoB5B,EAAmB0D,eAC5CxS,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,+BAAiC7I,EAAQ,2EAClE3I,KAAKsS,cAEhBtS,KAAK0Q,gBAAkB5B,EAAmB0D,cAC1CxS,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,2BAC5BxR,KAAKyS,sBAILzS,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,iEAChC5F,aAAa5L,KAAKyS,sBAClBzS,KAAKyS,0BAAuB/F,EAC5B1M,KAAK0S,gBACExL,QAAQC,YAEnBnH,KAAKiS,iBACLjS,KAAKoS,mBACLpS,KAAK6R,qBAAuBlJ,GAAS,IAAIhI,MAAM,uEAIxCX,KAAKwP,WAAW6C,KAAK1J,MAShC4G,EAAcrP,UAAUyS,OAAS,SAAUC,GAGvC,IAFA,IAAIpS,EAAQR,KACR6S,EAAO,GACF5D,EAAK,EAAGA,EAAK7N,UAAUC,OAAQ4N,IACpC4D,EAAK5D,EAAK,GAAK7N,UAAU6N,GAE7B,IAEI6D,EAFA7N,EAAKjF,KAAK+S,uBAAuBF,GAAOG,EAAU/N,EAAG,GAAIgO,EAAYhO,EAAG,GACxEiO,EAAuBlT,KAAKmT,uBAAuBP,EAAYC,EAAMI,GAErEtL,EAAU,IAAIoH,EAkClB,OAjCApH,EAAQO,eAAiB,WACrB,IAAIkL,EAAmB5S,EAAM6S,uBAAuBH,EAAqB1C,cAEzE,cADOhQ,EAAM2P,UAAU+C,EAAqB1C,cACrCsC,EAAatL,MAAK,WACrB,OAAOhH,EAAM8S,iBAAiBF,OAGtCpT,KAAKmQ,UAAU+C,EAAqB1C,cAAgB,SAAU+C,EAAiB5K,GACvEA,EACAhB,EAAQgB,MAAMA,GAGT4K,IAEDA,EAAgB1E,OAAS5E,EAAYuJ,WACjCD,EAAgB5K,MAChBhB,EAAQgB,MAAM,IAAIhI,MAAM4S,EAAgB5K,QAGxChB,EAAQwH,WAIZxH,EAAQ1B,KAAMsN,EAAoB,QAI9CT,EAAe9S,KAAKsT,iBAAiBJ,GAChC/K,OAAM,SAAUxB,GACjBgB,EAAQgB,MAAMhC,UACPnG,EAAM2P,UAAU+C,EAAqB1C,iBAEhDxQ,KAAKyT,cAAcT,EAASF,GACrBnL,GAEX4H,EAAcrP,UAAUoE,YAAc,SAAUmE,GAE5C,OADAzI,KAAKmS,yBACEnS,KAAKwP,WAAW3N,KAAK4G,IAMhC8G,EAAcrP,UAAUoT,iBAAmB,SAAU7K,GACjD,OAAOzI,KAAKsE,YAAYtE,KAAKyP,SAASqB,aAAarI,KAWvD8G,EAAcrP,UAAU2B,KAAO,SAAU+Q,GAErC,IADA,IAAIC,EAAO,GACF5D,EAAK,EAAGA,EAAK7N,UAAUC,OAAQ4N,IACpC4D,EAAK5D,EAAK,GAAK7N,UAAU6N,GAE7B,IAAIhK,EAAKjF,KAAK+S,uBAAuBF,GAAOG,EAAU/N,EAAG,GAAIgO,EAAYhO,EAAG,GACxEyO,EAAc1T,KAAKsT,iBAAiBtT,KAAK2T,iBAAiBf,EAAYC,GAAM,EAAMI,IAEtF,OADAjT,KAAKyT,cAAcT,EAASU,GACrBA,GAaXnE,EAAcrP,UAAU0T,OAAS,SAAUhB,GAGvC,IAFA,IAAIpS,EAAQR,KACR6S,EAAO,GACF5D,EAAK,EAAGA,EAAK7N,UAAUC,OAAQ4N,IACpC4D,EAAK5D,EAAK,GAAK7N,UAAU6N,GAE7B,IAAIhK,EAAKjF,KAAK+S,uBAAuBF,GAAOG,EAAU/N,EAAG,GAAIgO,EAAYhO,EAAG,GACxEiO,EAAuBlT,KAAK2T,iBAAiBf,EAAYC,GAAM,EAAOI,GACtEpT,EAAI,IAAIqH,SAAQ,SAAUC,EAASC,GAEnC5G,EAAM2P,UAAU+C,EAAqB1C,cAAgB,SAAU+C,EAAiB5K,GACxEA,EACAvB,EAAOuB,GAGF4K,IAEDA,EAAgB1E,OAAS5E,EAAYuJ,WACjCD,EAAgB5K,MAChBvB,EAAO,IAAIzG,MAAM4S,EAAgB5K,QAGjCxB,EAAQoM,EAAgBhM,QAI5BH,EAAO,IAAIzG,MAAM,4BAA8B4S,EAAgB1E,SAI3E,IAAIiE,EAAetS,EAAM8S,iBAAiBJ,GACrC/K,OAAM,SAAUxB,GACjBS,EAAOT,UAEAnG,EAAM2P,UAAU+C,EAAqB1C,iBAEhDhQ,EAAMiT,cAAcT,EAASF,MAEjC,OAAOjT,GAOX0P,EAAcrP,UAAU2T,GAAK,SAAUjB,EAAYkB,GAC1ClB,GAAekB,IAGpBlB,EAAaA,EAAWmB,cACnB/T,KAAKoQ,QAAQwC,KACd5S,KAAKoQ,QAAQwC,GAAc,KAGsB,IAAjD5S,KAAKoQ,QAAQwC,GAAY5K,QAAQ8L,IAGrC9T,KAAKoQ,QAAQwC,GAAYlM,KAAKoN,KAElCvE,EAAcrP,UAAU8T,IAAM,SAAUpB,EAAY9Q,GAChD,GAAK8Q,EAAL,CAGAA,EAAaA,EAAWmB,cACxB,IAAIE,EAAWjU,KAAKoQ,QAAQwC,GAC5B,GAAKqB,EAGL,GAAInS,EAAQ,CACR,IAAIoS,EAAYD,EAASjM,QAAQlG,IACd,IAAfoS,IACAD,EAAShM,OAAOiM,EAAW,GACH,IAApBD,EAAS5S,eACFrB,KAAKoQ,QAAQwC,gBAKrB5S,KAAKoQ,QAAQwC,KAO5BrD,EAAcrP,UAAU+P,QAAU,SAAUkE,GACpCA,GACAnU,KAAKqQ,gBAAgB3J,KAAKyN,IAOlC5E,EAAcrP,UAAUkU,eAAiB,SAAUD,GAC3CA,GACAnU,KAAKsQ,sBAAsB5J,KAAKyN,IAOxC5E,EAAcrP,UAAUmU,cAAgB,SAAUF,GAC1CA,GACAnU,KAAKuQ,qBAAqB7J,KAAKyN,IAGvC5E,EAAcrP,UAAU8P,oBAAsB,SAAUxM,GAOpD,GANAxD,KAAKiS,iBACAjS,KAAKyQ,4BACNjN,EAAOxD,KAAKsU,yBAAyB9Q,GACrCxD,KAAKyQ,2BAA4B,GAGjCjN,EAGA,IADA,IACSyL,EAAK,EAAGsF,EADFvU,KAAKyP,SAAS+E,cAAchR,EAAMxD,KAAKuE,QACd0K,EAAKsF,EAAWlT,OAAQ4N,IAAM,CAClE,IAAIxG,EAAU8L,EAAWtF,GACzB,OAAQxG,EAAQoG,MACZ,KAAK5E,EAAYwK,WACbzU,KAAK0U,mBAAmBjM,GACxB,MACJ,KAAKwB,EAAY0K,WACjB,KAAK1K,EAAYuJ,WACb,IAAIW,EAAWnU,KAAKmQ,UAAU1H,EAAQ+H,cAClC2D,IACI1L,EAAQoG,OAAS5E,EAAYuJ,mBACtBxT,KAAKmQ,UAAU1H,EAAQ+H,cAElC2D,EAAS1L,IAEb,MACJ,KAAKwB,EAAY8G,KAEb,MACJ,KAAK9G,EAAY2K,MACb5U,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,uCACtC,IAAIL,EAAQF,EAAQE,MAAQ,IAAIhI,MAAM,sCAAwC8H,EAAQE,YAAS+D,GAChE,IAA3BjE,EAAQoM,eAIR7U,KAAKwP,WAAW6C,KAAK1J,GAIrB3I,KAAKsS,YAActS,KAAKuS,aAAa5J,GAEzC,MACJ,QACI3I,KAAKuE,OAAOpC,IAAI9C,EAASyJ,QAAS,yBAA2BL,EAAQoG,KAAO,MAK5F7O,KAAKkS,sBAET3C,EAAcrP,UAAUoU,yBAA2B,SAAU9Q,GACzD,IAAIyB,EACA6P,EACA1G,EACJ,IAC8DA,GAA1DnJ,EAAKjF,KAAK8P,kBAAkB5B,uBAAuB1K,IAA0B,GAAIsR,EAAkB7P,EAAG,GAE1G,MAAO0B,GACH,IAAI8B,EAAU,qCAAuC9B,EACrD3G,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO8H,GAChC,IAAIE,EAAQ,IAAIhI,MAAM8H,GAEtB,MADAzI,KAAK+R,kBAAkBpJ,GACjBA,EAEV,GAAImM,EAAgBnM,MAKhB,MAJIF,EAAU,oCAAsCqM,EAAgBnM,MACpE3I,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO8H,GAC5BE,EAAQ,IAAIhI,MAAM8H,GACtBzI,KAAK+R,kBAAkBpJ,GACjBA,EAMV,OAHI3I,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,8BAEpCxR,KAAK8R,oBACE1D,GAEXmB,EAAcrP,UAAUiS,uBAAyB,WACzCnS,KAAKwP,WAAWuF,SAASC,oBAK7BhV,KAAK2P,eAAgB,IAAI/G,MAAOqM,UAAYjV,KAAK6P,gCACjD7P,KAAKoS,qBAET7C,EAAcrP,UAAUgS,mBAAqB,WACzC,IAAI1R,EAAQR,KACZ,KAAKA,KAAKwP,WAAWuF,UAAa/U,KAAKwP,WAAWuF,SAASC,oBAEvDhV,KAAKkV,cAAgB5J,YAAW,WAAc,OAAO9K,EAAM2U,kBAAoBnV,KAAK4P,kCAEtDlD,IAA1B1M,KAAKoV,mBAAgC,CACrC,IAAIC,EAAWrV,KAAK2P,eAAgB,IAAI/G,MAAOqM,UAC3CI,EAAW,IACXA,EAAW,GAGfrV,KAAKoV,iBAAmB9J,YAAW,WAAc,OAAO,EAAU9K,OAAO,OAAQ,GAAQ,WAErF,OAAO,EAAYR,MAAM,SAAUoF,GAC/B,OAAQA,EAAGS,OACP,KAAK,EACD,GAAM7F,KAAK0Q,kBAAoB5B,EAAmB4C,UAAY,MAAO,CAAC,EAAa,GACnFtM,EAAGS,MAAQ,EACf,KAAK,EAED,OADAT,EAAGW,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAKsE,YAAYtE,KAAK6Q,oBAC/C,KAAK,EAED,OADAzL,EAAGU,OACI,CAAC,EAAa,GACzB,KAAK,EAKD,OAJKV,EAAGU,OAGR9F,KAAKoS,mBACE,CAAC,EAAa,GACzB,KAAK,EAAG,MAAO,CAAC,YAGrBiD,KAInB9F,EAAcrP,UAAUiV,cAAgB,WAIpCnV,KAAKwP,WAAW6C,KAAK,IAAI1R,MAAM,yEAEnC4O,EAAcrP,UAAUwU,mBAAqB,SAAUY,GACnD,IAAI9U,EAAQR,KACRoQ,EAAUpQ,KAAKoQ,QAAQkF,EAAkBC,OAAOxB,eACpD,GAAI3D,EAAS,CACT,IACIA,EAAQpM,SAAQ,SAAUwR,GAAK,OAAOA,EAAE/N,MAAMjH,EAAO8U,EAAkBlU,cAE3E,MAAOuF,GACH3G,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,6BAA+B2U,EAAkBC,OAAOxB,cAAgB,iBAAmBpN,EAAI,MAEnI,GAAI2O,EAAkB9E,aAAc,CAEhC,IAAI/H,EAAU,qFACdzI,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO8H,GAEhCzI,KAAKsS,YAActS,KAAKuS,aAAa,IAAI5R,MAAM8H,UAInDzI,KAAKuE,OAAOpC,IAAI9C,EAASyJ,QAAS,mCAAqCwM,EAAkBC,OAAS,aAG1GhG,EAAcrP,UAAUgQ,iBAAmB,SAAUvH,GACjD3I,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,kCAAoC7I,EAAQ,2BAA6B3I,KAAK0Q,gBAAkB,KAEhI1Q,KAAK6R,qBAAuB7R,KAAK6R,sBAAwBlJ,GAAS,IAAIhI,MAAM,iFAGxEX,KAAK8R,mBACL9R,KAAK8R,oBAET9R,KAAKyV,yBAAyB9M,GAAS,IAAIhI,MAAM,uEACjDX,KAAKiS,iBACLjS,KAAKoS,mBACDpS,KAAK0Q,kBAAoB5B,EAAmB0D,cAC5CxS,KAAK0S,cAAc/J,GAEd3I,KAAK0Q,kBAAoB5B,EAAmB4C,WAAa1R,KAAK0P,gBAEnE1P,KAAK0V,UAAU/M,GAEV3I,KAAK0Q,kBAAoB5B,EAAmB4C,WACjD1R,KAAK0S,cAAc/J,IAQ3B4G,EAAcrP,UAAUwS,cAAgB,SAAU/J,GAC9C,IAAInI,EAAQR,KACZ,GAAIA,KAAK4Q,kBAAmB,CACxB5Q,KAAK0Q,gBAAkB5B,EAAmB6B,aAC1C3Q,KAAK4Q,mBAAoB,EACzB,IACI5Q,KAAKqQ,gBAAgBrM,SAAQ,SAAUoI,GAAK,OAAOA,EAAE3E,MAAMjH,EAAO,CAACmI,OAEvE,MAAOhC,GACH3G,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,0CAA4CgI,EAAQ,kBAAoBhC,EAAI,SAIxH4I,EAAcrP,UAAUwV,UAAY,SAAU/M,GAC1C,OAAO,EAAU3I,UAAM,OAAQ,GAAQ,WACnC,IAAI2V,EAAoBC,EAA2BC,EAAYC,EAAgBC,EAC3EvV,EAAQR,KACZ,OAAO,EAAYA,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAKD,GAJA8P,EAAqB/M,KAAKoN,MAC1BJ,EAA4B,EAC5BC,OAAuBnJ,IAAV/D,EAAsBA,EAAQ,IAAIhI,MAAM,mDAE9B,QADvBmV,EAAiB9V,KAAKiW,kBAAkBL,IAA6B,EAAGC,IAIpE,OAFA7V,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,sGAChCxR,KAAK0S,cAAc/J,GACZ,CAAC,GASZ,GAPA3I,KAAK0Q,gBAAkB5B,EAAmBqC,aACtCxI,EACA3I,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,6CAA+CL,EAAQ,MAG7F3I,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,4BAEtChJ,KAAKoU,eAAgB,CACrB,IACIpU,KAAKsQ,sBAAsBtM,SAAQ,SAAUoI,GAAK,OAAOA,EAAE3E,MAAMjH,EAAO,CAACmI,OAE7E,MAAOhC,GACH3G,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,iDAAmDgI,EAAQ,kBAAoBhC,EAAI,MAGvH,GAAI3G,KAAK0Q,kBAAoB5B,EAAmBqC,aAE5C,OADAnR,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,yFACzB,CAAC,GAGhBvM,EAAGY,MAAQ,EACf,KAAK,EACD,OAAyB,OAAnBiQ,EAAiC,CAAC,EAAa,IACrD9V,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,4BAA8B4M,EAA4B,kBAAoBE,EAAiB,QAC9H,CAAC,EAAa,IAAI5O,SAAQ,SAAUC,GACnC3G,EAAMiS,qBAAuBnH,WAAWnE,EAAS2O,QAE7D,KAAK,EAGD,GAFA7Q,EAAGa,OACH9F,KAAKyS,0BAAuB/F,EACxB1M,KAAK0Q,kBAAoB5B,EAAmBqC,aAE5C,OADAnR,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,qFACzB,CAAC,GAEZvM,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAKyR,iBAC9B,KAAK,EAID,GAHAxM,EAAGa,OACH9F,KAAK0Q,gBAAkB5B,EAAmB4C,UAC1C1R,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,2CAClChJ,KAAKqU,cACL,IACIrU,KAAKuQ,qBAAqBvM,SAAQ,SAAUoI,GAAK,OAAOA,EAAE3E,MAAMjH,EAAO,CAACA,EAAMgP,WAAWwB,kBAE7F,MAAOrK,GACH3G,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,uDAAyDX,KAAKwP,WAAWwB,aAAe,kBAAoBrK,EAAI,MAGxJ,MAAO,CAAC,GACZ,KAAK,EAGD,OAFAoP,EAAM9Q,EAAGa,OACT9F,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,8CAAgD+M,EAAM,MACxF/V,KAAK0Q,kBAAoB5B,EAAmBqC,cAC5CnR,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,4BAA8BxR,KAAK0Q,gBAAkB,8EAEjF1Q,KAAK0Q,kBAAoB5B,EAAmB0D,eAC5CxS,KAAK0S,gBAEF,CAAC,KAEZmD,EAAaE,aAAepV,MAAQoV,EAAM,IAAIpV,MAAMoV,EAAI7R,YACxD4R,EAAiB9V,KAAKiW,kBAAkBL,IAA6BhN,KAAKoN,MAAQL,EAAoBE,GAC/F,CAAC,EAAa,IACzB,KAAK,EAAG,MAAO,CAAC,EAAa,GAC7B,KAAK,EAGD,OAFA7V,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,gDAAkDJ,KAAKoN,MAAQL,GAAsB,WAAaC,EAA4B,+CACpK5V,KAAK0S,gBACE,CAAC,WAK5BnD,EAAcrP,UAAU+V,kBAAoB,SAAUC,EAAoBC,EAAqBC,GAC3F,IACI,OAAOpW,KAAK0P,gBAAgB2G,6BAA6B,CACrDF,oBAAqBA,EACrBD,mBAAoBA,EACpBE,YAAaA,IAGrB,MAAOzP,GAEH,OADA3G,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,6CAA+CuV,EAAqB,KAAOC,EAAsB,kBAAoBxP,EAAI,MAClJ,OAGf4I,EAAcrP,UAAUuV,yBAA2B,SAAU9M,GACzD,IAAIwH,EAAYnQ,KAAKmQ,UACrBnQ,KAAKmQ,UAAY,GACjB5Q,OAAOqN,KAAKuD,GACPnM,SAAQ,SAAUsS,IAEnBnC,EADehE,EAAUmG,IAChB,KAAM3N,OAGvB4G,EAAcrP,UAAUkS,iBAAmB,WACnCpS,KAAKoV,mBACLxJ,aAAa5L,KAAKoV,kBAClBpV,KAAKoV,sBAAmB1I,IAGhC6C,EAAcrP,UAAU+R,eAAiB,WACjCjS,KAAKkV,eACLtJ,aAAa5L,KAAKkV,gBAG1B3F,EAAcrP,UAAUyT,iBAAmB,SAAUf,EAAYC,EAAM0D,EAAatD,GAChF,GAAIsD,EACA,OAAyB,IAArBtD,EAAU5R,OACH,CACHD,UAAWyR,EACXI,UAAWA,EACXsC,OAAQ3C,EACR/D,KAAM5E,EAAYwK,YAIf,CACHrT,UAAWyR,EACX0C,OAAQ3C,EACR/D,KAAM5E,EAAYwK,YAK1B,IAAIjE,EAAexQ,KAAKwQ,aAExB,OADAxQ,KAAKwQ,eACoB,IAArByC,EAAU5R,OACH,CACHD,UAAWyR,EACXrC,aAAcA,EAAatM,WAC3B+O,UAAWA,EACXsC,OAAQ3C,EACR/D,KAAM5E,EAAYwK,YAIf,CACHrT,UAAWyR,EACXrC,aAAcA,EAAatM,WAC3BqR,OAAQ3C,EACR/D,KAAM5E,EAAYwK,aAKlClF,EAAcrP,UAAUuT,cAAgB,SAAUT,EAASF,GACvD,IAAItS,EAAQR,KACZ,GAAuB,IAAnBgT,EAAQ3R,OAAZ,CAIKyR,IACDA,EAAe5L,QAAQC,WAE3B,IAAIqP,EAAU,SAAUC,GACpBzD,EAAQyD,GAAUrH,UAAU,CACxBD,SAAU,WACN2D,EAAeA,EAAatL,MAAK,WAAc,OAAOhH,EAAM8S,iBAAiB9S,EAAMkW,wBAAwBD,QAE/G9N,MAAO,SAAUuG,GACb,IAAIzG,EAEAA,EADAyG,aAAevO,MACLuO,EAAIzG,QAETyG,GAAOA,EAAIhL,SACNgL,EAAIhL,WAGJ,gBAEd4O,EAAeA,EAAatL,MAAK,WAAc,OAAOhH,EAAM8S,iBAAiB9S,EAAMkW,wBAAwBD,EAAUhO,QAEzHxC,KAAM,SAAU+I,GACZ8D,EAAeA,EAAatL,MAAK,WAAc,OAAOhH,EAAM8S,iBAAiB9S,EAAMmW,wBAAwBF,EAAUzH,WAMjI,IAAK,IAAIyH,KAAYzD,EACjBwD,EAAQC,KAGhBlH,EAAcrP,UAAU6S,uBAAyB,SAAUF,GAGvD,IAFA,IAAIG,EAAU,GACVC,EAAY,GACP/R,EAAI,EAAGA,EAAI2R,EAAKxR,OAAQH,IAAK,CAClC,IAAI0V,EAAW/D,EAAK3R,GACpB,GAAIlB,KAAK6W,aAAaD,GAAW,CAC7B,IAAIH,EAAWzW,KAAKwQ,aACpBxQ,KAAKwQ,eAELwC,EAAQyD,GAAYG,EACpB3D,EAAUvM,KAAK+P,EAASvS,YAExB2O,EAAK5K,OAAO/G,EAAG,IAGvB,MAAO,CAAC8R,EAASC,IAErB1D,EAAcrP,UAAU2W,aAAe,SAAUC,GAE7C,OAAOA,GAAOA,EAAI1H,WAAsC,mBAAlB0H,EAAI1H,WAE9CG,EAAcrP,UAAUiT,uBAAyB,SAAUP,EAAYC,EAAMI,GACzE,IAAIzC,EAAexQ,KAAKwQ,aAExB,OADAxQ,KAAKwQ,eACoB,IAArByC,EAAU5R,OACH,CACHD,UAAWyR,EACXrC,aAAcA,EAAatM,WAC3B+O,UAAWA,EACXsC,OAAQ3C,EACR/D,KAAM5E,EAAY8M,kBAIf,CACH3V,UAAWyR,EACXrC,aAAcA,EAAatM,WAC3BqR,OAAQ3C,EACR/D,KAAM5E,EAAY8M,mBAI9BxH,EAAcrP,UAAUmT,uBAAyB,SAAU2D,GACvD,MAAO,CACHxG,aAAcwG,EACdnI,KAAM5E,EAAYgN,mBAG1B1H,EAAcrP,UAAUyW,wBAA0B,SAAUK,EAAIhI,GAC5D,MAAO,CACHwB,aAAcwG,EACdhI,KAAMA,EACNH,KAAM5E,EAAY0K,aAG1BpF,EAAcrP,UAAUwW,wBAA0B,SAAUM,EAAIrO,EAAOpB,GACnE,OAAIoB,EACO,CACHA,MAAOA,EACP6H,aAAcwG,EACdnI,KAAM5E,EAAYuJ,YAGnB,CACHhD,aAAcwG,EACdzP,OAAQA,EACRsH,KAAM5E,EAAYuJ,aAGnBjE,EAv4BuB,GExD9B2H,EAAuC,CAAC,EAAG,IAAM,IAAO,IAAO,MAE/DC,EAAwC,WACxC,SAASA,EAAuBC,GAC5BpX,KAAKoX,iBAA8B1K,IAAhB0K,EAA4BA,EAAYC,OAAO,CAAC,OAASH,EAKhF,OAHAC,EAAuBjX,UAAUmW,6BAA+B,SAAUiB,GACtE,OAAOtX,KAAKoX,YAAYE,EAAapB,qBAElCiB,EAPgC,IDA3C,SAAW9H,GAEPA,EAAkBA,EAAwB,KAAI,GAAK,OAEnDA,EAAkBA,EAA8B,WAAI,GAAK,aAEzDA,EAAkBA,EAAoC,iBAAI,GAAK,mBAE/DA,EAAkBA,EAA+B,YAAI,GAAK,cAR9D,CASGA,IAAsBA,EAAoB,KAG7C,SAAWC,GAEPA,EAAeA,EAAqB,KAAI,GAAK,OAE7CA,EAAeA,EAAuB,OAAI,GAAK,SAJnD,CAKGA,IAAmBA,EAAiB,KEfvC,ICFIiI,EDEA,EAAiC,WACjC,SAAS7M,IACL1K,KAAKwX,WAAY,EACjBxX,KAAKmL,QAAU,KAwBnB,OAtBAT,EAAgBxK,UAAUkL,MAAQ,WACzBpL,KAAKwX,YACNxX,KAAKwX,WAAY,EACbxX,KAAKmL,SACLnL,KAAKmL,YAIjB5L,OAAOyD,eAAe0H,EAAgBxK,UAAW,SAAU,CACvDwB,IAAK,WACD,OAAO1B,MAEXkD,YAAY,EACZC,cAAc,IAElB5D,OAAOyD,eAAe0H,EAAgBxK,UAAW,UAAW,CACxDwB,IAAK,WACD,OAAO1B,KAAKwX,WAEhBtU,YAAY,EACZC,cAAc,IAEXuH,EA3ByB,GELhC,EAAsCnL,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GAEP,EAAwC,SAAU8D,EAASC,EAAYkC,EAAGjC,GAC1E,OAAO,IAAKiC,IAAMA,EAAIC,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUhC,GAAS,IAAMuB,EAAK5B,EAAUiB,KAAKZ,IAAW,MAAOsB,GAAKS,EAAOT,IACpF,SAASW,EAASjC,GAAS,IAAMuB,EAAK5B,EAAiB,MAAEK,IAAW,MAAOsB,GAAKS,EAAOT,IACvF,SAASC,EAAKW,GAAUA,EAAOf,KAAOW,EAAQI,EAAOlC,OAAS,IAAI4B,GAAE,SAAUE,GAAWA,EAAQI,EAAOlC,UAAWmC,KAAKH,EAAWC,GACnIV,GAAM5B,EAAYA,EAAUyC,MAAM3C,EAASC,GAAc,KAAKkB,YAGlE,EAA4C,SAAUnB,EAASU,GAC/D,IAAsGC,EAAGC,EAAG1E,EAAG2E,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP9E,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAO+E,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEM,KAAMC,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BR,EAAEQ,OAAOC,UAAY,WAAa,OAAOpG,OAAU2F,EACvJ,SAASO,EAAK/E,GAAK,OAAO,SAAUkF,GAAK,OACzC,SAAcC,GACV,GAAIb,EAAG,MAAM,IAAIc,UAAU,mCAC3B,KAAOX,OACH,GAAIH,EAAI,EAAGC,IAAM1E,EAAY,EAARsF,EAAG,GAASZ,EAAU,OAAIY,EAAG,GAAKZ,EAAS,SAAO1E,EAAI0E,EAAU,SAAM1E,EAAEN,KAAKgF,GAAI,GAAKA,EAAEO,SAAWjF,EAAIA,EAAEN,KAAKgF,EAAGY,EAAG,KAAKE,KAAM,OAAOxF,EAE3J,OADI0E,EAAI,EAAG1E,IAAGsF,EAAK,CAAS,EAARA,EAAG,GAAQtF,EAAEqE,QACzBiB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGtF,EAAIsF,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAER,MAAOiB,EAAG,GAAIE,MAAM,GAChD,KAAK,EAAGZ,EAAEC,QAASH,EAAIY,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBzF,GAAZA,EAAI4E,EAAEG,MAAY1E,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAViF,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAActF,GAAMsF,EAAG,GAAKtF,EAAE,IAAMsF,EAAG,GAAKtF,EAAE,IAAM,CAAE4E,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAIA,EAAIsF,EAAI,MAC7D,GAAItF,GAAK4E,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAI4E,EAAEI,IAAIU,KAAKJ,GAAK,MACvDtF,EAAE,IAAI4E,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKd,EAAK9E,KAAKoE,EAASc,GAC1B,MAAOe,GAAKL,EAAK,CAAC,EAAGK,GAAIjB,EAAI,EAAK,QAAUD,EAAIzE,EAAI,EACtD,GAAY,EAARsF,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEjB,MAAOiB,EAAG,GAAKA,EAAG,QAAK,EAAQE,MAAM,GArB9BI,CAAK,CAACzF,EAAGkF,OA+BzDoR,EAAsC,WACtC,SAASA,EAAqBhT,EAAYC,EAAoBH,EAAQI,EAAmBC,EAAiBM,GACtGlF,KAAKyE,WAAaA,EAClBzE,KAAK0E,mBAAqBA,EAC1B1E,KAAKuE,OAASA,EACdvE,KAAK0X,UAAY,IAAI,EACrB1X,KAAK2E,kBAAoBA,EACzB3E,KAAK4E,gBAAkBA,EACvB5E,KAAKkF,QAAUA,EACflF,KAAK2X,SAAU,EACf3X,KAAK+P,UAAY,KACjB/P,KAAKiQ,QAAU,KAyOnB,OAvOA1Q,OAAOyD,eAAeyU,EAAqBvX,UAAW,cAAe,CAEjEwB,IAAK,WACD,OAAO1B,KAAK0X,UAAUxM,SAE1BhI,YAAY,EACZC,cAAc,IAElBsU,EAAqBvX,UAAU0X,QAAU,SAAUjW,EAAKqQ,GACpD,OAAO,EAAUhS,UAAM,OAAQ,GAAQ,WACnC,IAAIiF,EAAIG,EAAI1C,EAAM2C,EAAOH,EAAS2S,EAAa1S,EAAO2S,EAASvS,EAC/D,OAAO,EAAYvF,MAAM,SAAU8G,GAC/B,OAAQA,EAAGjB,OACP,KAAK,EAOD,GANAtD,EAAIC,WAAWb,EAAK,OACpBY,EAAIC,WAAWwP,EAAgB,kBAC/BzP,EAAIM,KAAKmP,EAAgB1C,EAAgB,kBACzCtP,KAAK2B,IAAMA,EACX3B,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,uCAE5BgL,IAAmB1C,EAAeyI,QACP,oBAAnBvL,gBAA+E,iBAAtC,IAAIA,gBAAiBlH,aACtE,MAAM,IAAI3E,MAAM,8FAapB,OAXAyE,EAAK2B,IAAsBrE,EAAO0C,EAAG,GAAIC,EAAQD,EAAG,GACpDF,EAAU,IAAUD,EAAK,IAAOvC,GAAQ2C,EAAOJ,GAAKjF,KAAKkF,SACzD2S,EAAc,CACV5M,YAAajL,KAAK0X,UAAU/L,OAC5BzG,QAASA,EACTmG,QAAS,IACTzG,gBAAiB5E,KAAK4E,iBAEtBoN,IAAmB1C,EAAeyI,SAClCF,EAAYvS,aAAe,eAExB,CAAC,EAAatF,KAAKgY,kBAC9B,KAAK,EAKD,OAJA7S,EAAQ2B,EAAGhB,OACX9F,KAAKiY,kBAAkBJ,EAAa1S,GACpC2S,EAAUnW,EAAM,MAAQiH,KAAKoN,MAC7BhW,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,oCAAsC8Q,EAAU,KACzE,CAAC,EAAa9X,KAAKyE,WAAW/C,IAAIoW,EAASD,IACtD,KAAK,EAYD,OAV4B,OAD5BtS,EAAWuB,EAAGhB,QACDvF,YACTP,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,qDAAuD4E,EAAShF,WAAa,KAE7GP,KAAKkY,WAAa,IAAI9X,EAAUmF,EAAShE,YAAc,GAAIgE,EAAShF,YACpEP,KAAK2X,SAAU,GAGf3X,KAAK2X,SAAU,EAEnB3X,KAAKmY,UAAYnY,KAAKoY,KAAKpY,KAAK2B,IAAKkW,GAC9B,CAAC,WAK5BJ,EAAqBvX,UAAU8X,eAAiB,WAC5C,OAAO,EAAUhY,UAAM,OAAQ,GAAQ,WACnC,OAAO,EAAYA,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EACD,OAAK7F,KAAK0E,mBACH,CAAC,EAAa1E,KAAK0E,sBADW,CAAC,EAAa,GAEvD,KAAK,EAAG,MAAO,CAAC,EAAcO,EAAGa,QACjC,KAAK,EAAG,MAAO,CAAC,EAAc,cAK9C2R,EAAqBvX,UAAU+X,kBAAoB,SAAUtN,EAASxF,GAC7DwF,EAAQzF,UACTyF,EAAQzF,QAAU,IAElBC,EAEAwF,EAAQzF,QAAuB,cAAI,UAAYC,EAI/CwF,EAAQzF,QAAuB,sBAExByF,EAAQzF,QAAuB,eAG9CuS,EAAqBvX,UAAUkY,KAAO,SAAUzW,EAAKkW,GACjD,OAAO,EAAU7X,UAAM,OAAQ,GAAQ,WACnC,IAAImF,EAAO2S,EAASvS,EAAUwF,EAC9B,OAAO,EAAY/K,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EACDZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,CAAE,EAAG,IACtBzB,EAAGY,MAAQ,EACf,KAAK,EACD,OAAK7F,KAAK2X,QACH,CAAC,EAAa3X,KAAKgY,kBADA,CAAC,EAAa,GAE5C,KAAK,EACD7S,EAAQF,EAAGa,OACX9F,KAAKiY,kBAAkBJ,EAAa1S,GACpCF,EAAGY,MAAQ,EACf,KAAK,EAID,OAHAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACtBoR,EAAUnW,EAAM,MAAQiH,KAAKoN,MAC7BhW,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,oCAAsC8Q,EAAU,KACzE,CAAC,EAAa9X,KAAKyE,WAAW/C,IAAIoW,EAASD,IACtD,KAAK,EAyBD,OAvB4B,OAD5BtS,EAAWN,EAAGa,QACDvF,YACTP,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,sDACtChJ,KAAK2X,SAAU,GAEc,MAAxBpS,EAAShF,YACdP,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,qDAAuD4E,EAAShF,WAAa,KAE7GP,KAAKkY,WAAa,IAAI9X,EAAUmF,EAAShE,YAAc,GAAIgE,EAAShF,YACpEP,KAAK2X,SAAU,GAIXpS,EAAS/D,SACTxB,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,0CAA4CzD,EAAcgC,EAAS/D,QAASxB,KAAK2E,mBAAqB,KAClI3E,KAAK+P,WACL/P,KAAK+P,UAAUxK,EAAS/D,UAK5BxB,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,sDAGjC,CAAC,EAAa,GACzB,KAAK,EAiBD,OAhBA+D,EAAM9F,EAAGa,OACJ9F,KAAK2X,QAKF5M,aAAenK,EAEfZ,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,uDAIhChH,KAAKkY,WAAanN,EAClB/K,KAAK2X,SAAU,GAVnB3X,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,wDAA0D+D,EAAItC,SAa3F,CAAC,EAAa,GACzB,KAAK,EAAG,MAAO,CAAC,EAAa,GAC7B,KAAK,EAAG,MAAO,CAAC,EAAa,GAC7B,KAAK,EAOD,OANAzI,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,6CAG3BhH,KAAKqY,aACNrY,KAAKsY,eAEF,CAAC,GACZ,KAAK,EAAG,MAAO,CAAC,WAKhCb,EAAqBvX,UAAU2B,KAAO,SAAU2B,GAC5C,OAAO,EAAUxD,UAAM,OAAQ,GAAQ,WACnC,OAAO,EAAYA,MAAM,SAAUiF,GAC/B,OAAKjF,KAAK2X,QAGH,CAAC,EAAcrT,EAAYtE,KAAKuE,OAAQ,cAAevE,KAAKyE,WAAYzE,KAAK2B,IAAK3B,KAAK0E,mBAAoBlB,EAAMxD,KAAK2E,kBAAmB3E,KAAK4E,gBAAiB5E,KAAKkF,UAFhK,CAAC,EAAcgC,QAAQE,OAAO,IAAIzG,MAAM,yDAM/D8W,EAAqBvX,UAAUmS,KAAO,WAClC,OAAO,EAAUrS,UAAM,OAAQ,GAAQ,WACnC,IAAIkF,EAASD,EAAIsT,EAAQlT,EAAOmT,EAAerT,EAC/C,OAAO,EAAYnF,MAAM,SAAUoF,GAC/B,OAAQA,EAAGS,OACP,KAAK,EACD7F,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,6CAEhChH,KAAK2X,SAAU,EACf3X,KAAK0X,UAAUtM,QACfhG,EAAGS,MAAQ,EACf,KAAK,EAED,OADAT,EAAGW,KAAKW,KAAK,CAAC,EAAG,CAAE,EAAG,IACf,CAAC,EAAa1G,KAAKmY,WAC9B,KAAK,EAWD,OAVA/S,EAAGU,OAEH9F,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,qDAAuDhH,KAAK2B,IAAM,KAClGuD,EAAU,GACVD,EAAK8B,IAAsBwR,EAAStT,EAAG,GAAII,EAAQJ,EAAG,GACtDC,EAAQqT,GAAUlT,EAClBmT,EAAgB,CACZtT,QAAS,EAAS,GAAIA,EAASlF,KAAKkF,SACpCN,gBAAiB5E,KAAK4E,iBAEnB,CAAC,EAAa5E,KAAKgY,kBAC9B,KAAK,EAGD,OAFA7S,EAAQC,EAAGU,OACX9F,KAAKiY,kBAAkBO,EAAerT,GAC/B,CAAC,EAAanF,KAAKyE,WAAWzC,OAAOhC,KAAK2B,IAAK6W,IAC1D,KAAK,EAGD,OAFApT,EAAGU,OACH9F,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,gDACzB,CAAC,EAAa,GACzB,KAAK,EAKD,OAJAhH,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,0CAGhChH,KAAKsY,eACE,CAAC,GACZ,KAAK,EAAG,MAAO,CAAC,WAKhCb,EAAqBvX,UAAUoY,aAAe,WAC1C,GAAItY,KAAKiQ,QAAS,CACd,IAAIwI,EAAa,gDACbzY,KAAKkY,aACLO,GAAc,WAAazY,KAAKkY,YAEpClY,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAOyR,GAChCzY,KAAKiQ,QAAQjQ,KAAKkY,cAGnBT,EApP8B,GClDrC,EAAsClY,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GAEP,EAAwC,SAAU8D,EAASC,EAAYkC,EAAGjC,GAC1E,OAAO,IAAKiC,IAAMA,EAAIC,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUhC,GAAS,IAAMuB,EAAK5B,EAAUiB,KAAKZ,IAAW,MAAOsB,GAAKS,EAAOT,IACpF,SAASW,EAASjC,GAAS,IAAMuB,EAAK5B,EAAiB,MAAEK,IAAW,MAAOsB,GAAKS,EAAOT,IACvF,SAASC,EAAKW,GAAUA,EAAOf,KAAOW,EAAQI,EAAOlC,OAAS,IAAI4B,GAAE,SAAUE,GAAWA,EAAQI,EAAOlC,UAAWmC,KAAKH,EAAWC,GACnIV,GAAM5B,EAAYA,EAAUyC,MAAM3C,EAASC,GAAc,KAAKkB,YAGlE,EAA4C,SAAUnB,EAASU,GAC/D,IAAsGC,EAAGC,EAAG1E,EAAG2E,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP9E,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAO+E,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEM,KAAMC,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BR,EAAEQ,OAAOC,UAAY,WAAa,OAAOpG,OAAU2F,EACvJ,SAASO,EAAK/E,GAAK,OAAO,SAAUkF,GAAK,OACzC,SAAcC,GACV,GAAIb,EAAG,MAAM,IAAIc,UAAU,mCAC3B,KAAOX,OACH,GAAIH,EAAI,EAAGC,IAAM1E,EAAY,EAARsF,EAAG,GAASZ,EAAU,OAAIY,EAAG,GAAKZ,EAAS,SAAO1E,EAAI0E,EAAU,SAAM1E,EAAEN,KAAKgF,GAAI,GAAKA,EAAEO,SAAWjF,EAAIA,EAAEN,KAAKgF,EAAGY,EAAG,KAAKE,KAAM,OAAOxF,EAE3J,OADI0E,EAAI,EAAG1E,IAAGsF,EAAK,CAAS,EAARA,EAAG,GAAQtF,EAAEqE,QACzBiB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGtF,EAAIsF,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAER,MAAOiB,EAAG,GAAIE,MAAM,GAChD,KAAK,EAAGZ,EAAEC,QAASH,EAAIY,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBzF,GAAZA,EAAI4E,EAAEG,MAAY1E,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAViF,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAActF,GAAMsF,EAAG,GAAKtF,EAAE,IAAMsF,EAAG,GAAKtF,EAAE,IAAM,CAAE4E,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAIA,EAAIsF,EAAI,MAC7D,GAAItF,GAAK4E,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAI4E,EAAEI,IAAIU,KAAKJ,GAAK,MACvDtF,EAAE,IAAI4E,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKd,EAAK9E,KAAKoE,EAASc,GAC1B,MAAOe,GAAKL,EAAK,CAAC,EAAGK,GAAIjB,EAAI,EAAK,QAAUD,EAAIzE,EAAI,EACtD,GAAY,EAARsF,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEjB,MAAOiB,EAAG,GAAKA,EAAG,QAAK,EAAQE,MAAM,GArB9BI,CAAK,CAACzF,EAAGkF,OA4BzDqS,EAA2C,WAC3C,SAASA,EAA0BjU,EAAYC,EAAoBH,EAAQI,EAAmBgU,EAAwB/T,EAAiBM,GACnIlF,KAAKyE,WAAaA,EAClBzE,KAAK0E,mBAAqBA,EAC1B1E,KAAKuE,OAASA,EACdvE,KAAK2E,kBAAoBA,EACzB3E,KAAK4E,gBAAkBA,EACvB5E,KAAK2Y,uBAAyBA,EAC9B3Y,KAAKkF,QAAUA,EACflF,KAAK+P,UAAY,KACjB/P,KAAKiQ,QAAU,KAuGnB,OArGAyI,EAA0BxY,UAAU0X,QAAU,SAAUjW,EAAKqQ,GACzD,OAAO,EAAUhS,UAAM,OAAQ,GAAQ,WACnC,IAAImF,EACA3E,EAAQR,KACZ,OAAO,EAAYA,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAOD,OANAtD,EAAIC,WAAWb,EAAK,OACpBY,EAAIC,WAAWwP,EAAgB,kBAC/BzP,EAAIM,KAAKmP,EAAgB1C,EAAgB,kBACzCtP,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,+BAEhChH,KAAK2B,IAAMA,EACN3B,KAAK0E,mBACH,CAAC,EAAa1E,KAAK0E,sBADW,CAAC,EAAa,GAEvD,KAAK,GACDS,EAAQF,EAAGa,UAEPnE,IAAQA,EAAIqG,QAAQ,KAAO,EAAI,IAAM,KAAQ,gBAAkB4Q,mBAAmBzT,IAEtFF,EAAGY,MAAQ,EACf,KAAK,EAAG,MAAO,CAAC,EAAc,IAAIqB,SAAQ,SAAUC,EAASC,GACrD,IAAIyR,GAAS,EACb,GAAI7G,IAAmB1C,EAAewJ,KAAtC,CAIA,IAAIC,EACJ,GAAIhW,EAASM,WAAaN,EAASO,YAC/ByV,EAAc,IAAIvY,EAAMmY,uBAAuBhX,EAAK,CAAEiD,gBAAiBpE,EAAMoE,sBAE5E,CAED,IAAIsH,EAAU1L,EAAMiE,WAAWxC,gBAAgBN,GAC3CuD,EAAU,GACdA,EAAQ8T,OAAS9M,EACjB,IAAIjH,EAAK8B,IAAsBwR,EAAStT,EAAG,GAAII,EAAQJ,EAAG,GAC1DC,EAAQqT,GAAUlT,EAClB0T,EAAc,IAAIvY,EAAMmY,uBAAuBhX,EAAK,CAAEiD,gBAAiBpE,EAAMoE,gBAAiBM,QAAS,EAAS,GAAIA,EAAS1E,EAAM0E,WAEvI,IACI6T,EAAYE,UAAY,SAAUtS,GAC9B,GAAInG,EAAMuP,UACN,IACIvP,EAAM+D,OAAOpC,IAAI9C,EAAS2H,MAAO,kCAAoCzD,EAAcoD,EAAEnD,KAAMhD,EAAMmE,mBAAqB,KACtHnE,EAAMuP,UAAUpJ,EAAEnD,MAEtB,MAAOmF,GAEH,YADAnI,EAAM0Y,MAAMvQ,KAKxBoQ,EAAY/L,QAAU,SAAUrG,GAC5B,IAAIgC,EAAQ,IAAIhI,MAAMgG,EAAEnD,MAAQ,kBAC5BqV,EACArY,EAAM0Y,MAAMvQ,GAGZvB,EAAOuB,IAGfoQ,EAAYI,OAAS,WACjB3Y,EAAM+D,OAAOpC,IAAI9C,EAAS2J,YAAa,oBAAsBxI,EAAMmB,KACnEnB,EAAMuY,YAAcA,EACpBF,GAAS,EACT1R,KAGR,MAAOR,GAEH,YADAS,EAAOT,SA9CPS,EAAO,IAAIzG,MAAM,0FAsD7C+X,EAA0BxY,UAAU2B,KAAO,SAAU2B,GACjD,OAAO,EAAUxD,UAAM,OAAQ,GAAQ,WACnC,OAAO,EAAYA,MAAM,SAAUiF,GAC/B,OAAKjF,KAAK+Y,YAGH,CAAC,EAAczU,EAAYtE,KAAKuE,OAAQ,MAAOvE,KAAKyE,WAAYzE,KAAK2B,IAAK3B,KAAK0E,mBAAoBlB,EAAMxD,KAAK2E,kBAAmB3E,KAAK4E,gBAAiB5E,KAAKkF,UAFxJ,CAAC,EAAcgC,QAAQE,OAAO,IAAIzG,MAAM,yDAM/D+X,EAA0BxY,UAAUmS,KAAO,WAEvC,OADArS,KAAKkZ,QACEhS,QAAQC,WAEnBuR,EAA0BxY,UAAUgZ,MAAQ,SAAUvS,GAC9C3G,KAAK+Y,cACL/Y,KAAK+Y,YAAYG,QACjBlZ,KAAK+Y,iBAAcrM,EACf1M,KAAKiQ,SACLjQ,KAAKiQ,QAAQtJ,KAIlB+R,EAjHmC,GC/C1C,EAAsCnZ,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GAyCPoY,EAAoC,WACpC,SAASA,EAAmB3U,EAAYC,EAAoBH,EAAQI,EAAmB0U,EAAsBnU,GACzGlF,KAAKuE,OAASA,EACdvE,KAAK0E,mBAAqBA,EAC1B1E,KAAK2E,kBAAoBA,EACzB3E,KAAKqZ,qBAAuBA,EAC5BrZ,KAAKyE,WAAaA,EAClBzE,KAAK+P,UAAY,KACjB/P,KAAKiQ,QAAU,KACfjQ,KAAKkF,QAAUA,EA4InB,OA1IAkU,EAAmBlZ,UAAU0X,QAAU,SAAUjW,EAAKqQ,GAClD,OAnD8ClN,EAmD7B9E,KAnDsC+E,OAmDhC,EAnD+CC,EAmD/B,WACnC,IAAIG,EACA3E,EAAQR,KACZ,OA9CoC,SAAU8E,EAASU,GAC/D,IAAsGC,EAAGC,EAAG1E,EAAG2E,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP9E,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAO+E,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEM,KAAMC,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BR,EAAEQ,OAAOC,UAAY,WAAa,OAAOpG,OAAU2F,EACvJ,SAASO,EAAK/E,GAAK,OAAO,SAAUkF,GAAK,OACzC,SAAcC,GACV,GAAIb,EAAG,MAAM,IAAIc,UAAU,mCAC3B,KAAOX,OACH,GAAIH,EAAI,EAAGC,IAAM1E,EAAY,EAARsF,EAAG,GAASZ,EAAU,OAAIY,EAAG,GAAKZ,EAAS,SAAO1E,EAAI0E,EAAU,SAAM1E,EAAEN,KAAKgF,GAAI,GAAKA,EAAEO,SAAWjF,EAAIA,EAAEN,KAAKgF,EAAGY,EAAG,KAAKE,KAAM,OAAOxF,EAE3J,OADI0E,EAAI,EAAG1E,IAAGsF,EAAK,CAAS,EAARA,EAAG,GAAQtF,EAAEqE,QACzBiB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGtF,EAAIsF,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAER,MAAOiB,EAAG,GAAIE,MAAM,GAChD,KAAK,EAAGZ,EAAEC,QAASH,EAAIY,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBzF,GAAZA,EAAI4E,EAAEG,MAAY1E,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAViF,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAActF,GAAMsF,EAAG,GAAKtF,EAAE,IAAMsF,EAAG,GAAKtF,EAAE,IAAM,CAAE4E,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAIA,EAAIsF,EAAI,MAC7D,GAAItF,GAAK4E,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAI4E,EAAEI,IAAIU,KAAKJ,GAAK,MACvDtF,EAAE,IAAI4E,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKd,EAAK9E,KAAKoE,EAASc,GAC1B,MAAOe,GAAKL,EAAK,CAAC,EAAGK,GAAIjB,EAAI,EAAK,QAAUD,EAAIzE,EAAI,EACtD,GAAY,EAARsF,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEjB,MAAOiB,EAAG,GAAKA,EAAG,QAAK,EAAQE,MAAM,GArB9BI,CAAK,CAACzF,EAAGkF,MA2C1C,CAAYrG,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAKD,OAJAtD,EAAIC,WAAWb,EAAK,OACpBY,EAAIC,WAAWwP,EAAgB,kBAC/BzP,EAAIM,KAAKmP,EAAgB1C,EAAgB,kBACzCtP,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,sCAC3BhH,KAAK0E,mBACH,CAAC,EAAa1E,KAAK0E,sBADW,CAAC,EAAa,GAEvD,KAAK,GACDS,EAAQF,EAAGa,UAEPnE,IAAQA,EAAIqG,QAAQ,KAAO,EAAI,IAAM,KAAQ,gBAAkB4Q,mBAAmBzT,IAEtFF,EAAGY,MAAQ,EACf,KAAK,EAAG,MAAO,CAAC,EAAc,IAAIqB,SAAQ,SAAUC,EAASC,GAErD,IAAIkS,EADJ3X,EAAMA,EAAI4X,QAAQ,QAAS,MAE3B,IAAIrN,EAAU1L,EAAMiE,WAAWxC,gBAAgBN,GAC3CkX,GAAS,EACb,GAAI9V,EAAS0G,OAAQ,CACjB,IAAIvE,EAAU,GACVD,EAAK8B,IAAsBwR,EAAStT,EAAG,GAAII,EAAQJ,EAAG,GAC1DC,EAAQqT,GAAUlT,EACd6G,IACAhH,EAAgB,OAAI,GAAKgH,GAG7BoN,EAAY,IAAI9Y,EAAM6Y,qBAAqB1X,OAAK+K,EAAW,CACvDxH,QAAS,EAAS,GAAIA,EAAS1E,EAAM0E,WAGxCoU,IAEDA,EAAY,IAAI9Y,EAAM6Y,qBAAqB1X,IAE3CqQ,IAAmB1C,EAAeyI,SAClCuB,EAAUE,WAAa,eAG3BF,EAAUH,OAAS,SAAUM,GACzBjZ,EAAM+D,OAAOpC,IAAI9C,EAAS2J,YAAa,0BAA4BrH,EAAM,KACzEnB,EAAM8Y,UAAYA,EAClBT,GAAS,EACT1R,KAEJmS,EAAUtM,QAAU,SAAU0M,GAC1B,IAAI/Q,EAGAA,EADsB,oBAAfgR,YAA8BD,aAAiBC,WAC9CD,EAAM/Q,MAGN,IAAIhI,MAAM,0CAEtByG,EAAOuB,IAEX2Q,EAAUL,UAAY,SAAUxQ,GAE5B,GADAjI,EAAM+D,OAAOpC,IAAI9C,EAAS2H,MAAO,yCAA2CzD,EAAckF,EAAQjF,KAAMhD,EAAMmE,mBAAqB,KAC/HnE,EAAMuP,UACN,IACIvP,EAAMuP,UAAUtH,EAAQjF,MAE5B,MAAOmF,GAEH,YADAnI,EAAM0Y,MAAMvQ,KAKxB2Q,EAAUrJ,QAAU,SAAUyJ,GAOtB,IAAI/Q,EAJJkQ,EACArY,EAAM0Y,MAAMQ,IAMR/Q,EADsB,oBAAfgR,YAA8BD,aAAiBC,WAC9CD,EAAM/Q,MAGN,IAAIhI,MAAM,0CAEtByG,EAAOuB,cAzIhC,KADgE1B,OAmDpC,KAlDjBA,EAAIC,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUhC,GAAS,IAAMuB,EAAK5B,EAAUiB,KAAKZ,IAAW,MAAOsB,GAAKS,EAAOT,IACpF,SAASW,EAASjC,GAAS,IAAMuB,EAAK5B,EAAiB,MAAEK,IAAW,MAAOsB,GAAKS,EAAOT,IACvF,SAASC,EAAKW,GAAUA,EAAOf,KAAOW,EAAQI,EAAOlC,OAAS,IAAI4B,GAAE,SAAUE,GAAWA,EAAQI,EAAOlC,UAAWmC,KAAKH,EAAWC,GACnIV,GAAM5B,EAAYA,EAAUyC,MAAM3C,EAASC,GAAc,KAAKkB,WAL1B,IAAUnB,EAASC,EAAYkC,EAAGjC,GAkJ1EoU,EAAmBlZ,UAAU2B,KAAO,SAAU2B,GAC1C,OAAIxD,KAAKsZ,WAAatZ,KAAKsZ,UAAUM,aAAe5Z,KAAKqZ,qBAAqBQ,MAC1E7Z,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,wCAA0CzD,EAAcC,EAAMxD,KAAK2E,mBAAqB,KACxH3E,KAAKsZ,UAAUzX,KAAK2B,GACb0D,QAAQC,WAEZD,QAAQE,OAAO,uCAE1BgS,EAAmBlZ,UAAUmS,KAAO,WAMhC,OALIrS,KAAKsZ,WAGLtZ,KAAKkZ,WAAMxM,GAERxF,QAAQC,WAEnBiS,EAAmBlZ,UAAUgZ,MAAQ,SAAUQ,GAEvC1Z,KAAKsZ,YAELtZ,KAAKsZ,UAAUrJ,QAAU,aACzBjQ,KAAKsZ,UAAUL,UAAY,aAC3BjZ,KAAKsZ,UAAUtM,QAAU,aACzBhN,KAAKsZ,UAAUJ,QACflZ,KAAKsZ,eAAY5M,GAErB1M,KAAKuE,OAAOpC,IAAI9C,EAAS2H,MAAO,yCAC5BhH,KAAKiQ,WACDjQ,KAAK8Z,aAAaJ,KAA8B,IAAnBA,EAAMK,UAAqC,MAAfL,EAAMM,KAG1DN,aAAiB/Y,MACtBX,KAAKiQ,QAAQyJ,GAGb1Z,KAAKiQ,UANLjQ,KAAKiQ,QAAQ,IAAItP,MAAM,sCAAwC+Y,EAAMM,KAAO,KAAON,EAAMO,OAAS,SAU9Gb,EAAmBlZ,UAAU4Z,aAAe,SAAUJ,GAClD,OAAOA,GAAmC,kBAAnBA,EAAMK,UAAgD,iBAAfL,EAAMM,MAEjEZ,EArJ4B,GC/CnC,EAAsC7Z,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GAEP,EAAwC,SAAU8D,EAASC,EAAYkC,EAAGjC,GAC1E,OAAO,IAAKiC,IAAMA,EAAIC,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUhC,GAAS,IAAMuB,EAAK5B,EAAUiB,KAAKZ,IAAW,MAAOsB,GAAKS,EAAOT,IACpF,SAASW,EAASjC,GAAS,IAAMuB,EAAK5B,EAAiB,MAAEK,IAAW,MAAOsB,GAAKS,EAAOT,IACvF,SAASC,EAAKW,GAAUA,EAAOf,KAAOW,EAAQI,EAAOlC,OAAS,IAAI4B,GAAE,SAAUE,GAAWA,EAAQI,EAAOlC,UAAWmC,KAAKH,EAAWC,GACnIV,GAAM5B,EAAYA,EAAUyC,MAAM3C,EAASC,GAAc,KAAKkB,YAGlE,GAA4C,SAAUnB,EAASU,GAC/D,IAAsGC,EAAGC,EAAG1E,EAAG2E,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP9E,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAO+E,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEM,KAAMC,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BR,EAAEQ,OAAOC,UAAY,WAAa,OAAOpG,OAAU2F,EACvJ,SAASO,EAAK/E,GAAK,OAAO,SAAUkF,GAAK,OACzC,SAAcC,GACV,GAAIb,EAAG,MAAM,IAAIc,UAAU,mCAC3B,KAAOX,OACH,GAAIH,EAAI,EAAGC,IAAM1E,EAAY,EAARsF,EAAG,GAASZ,EAAU,OAAIY,EAAG,GAAKZ,EAAS,SAAO1E,EAAI0E,EAAU,SAAM1E,EAAEN,KAAKgF,GAAI,GAAKA,EAAEO,SAAWjF,EAAIA,EAAEN,KAAKgF,EAAGY,EAAG,KAAKE,KAAM,OAAOxF,EAE3J,OADI0E,EAAI,EAAG1E,IAAGsF,EAAK,CAAS,EAARA,EAAG,GAAQtF,EAAEqE,QACzBiB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGtF,EAAIsF,EAAI,MACxB,KAAK,EAAc,OAAXV,EAAEC,QAAgB,CAAER,MAAOiB,EAAG,GAAIE,MAAM,GAChD,KAAK,EAAGZ,EAAEC,QAASH,EAAIY,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKV,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,MAAkBzF,GAAZA,EAAI4E,EAAEG,MAAY1E,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAViF,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEV,EAAI,EAAG,SACjG,GAAc,IAAVU,EAAG,MAActF,GAAMsF,EAAG,GAAKtF,EAAE,IAAMsF,EAAG,GAAKtF,EAAE,IAAM,CAAE4E,EAAEC,MAAQS,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYV,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAIA,EAAIsF,EAAI,MAC7D,GAAItF,GAAK4E,EAAEC,MAAQ7E,EAAE,GAAI,CAAE4E,EAAEC,MAAQ7E,EAAE,GAAI4E,EAAEI,IAAIU,KAAKJ,GAAK,MACvDtF,EAAE,IAAI4E,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBH,EAAKd,EAAK9E,KAAKoE,EAASc,GAC1B,MAAOe,GAAKL,EAAK,CAAC,EAAGK,GAAIjB,EAAI,EAAK,QAAUD,EAAIzE,EAAI,EACtD,GAAY,EAARsF,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEjB,MAAOiB,EAAG,GAAKA,EAAG,QAAK,EAAQE,MAAM,GArB9BI,CAAK,CAACzF,EAAGkF,OAiCzD6T,GAAgC,WAChC,SAASA,EAAevY,EAAKC,GhByH1B,IAAsB2C,EgB/GrB,QATgB,IAAZ3C,IAAsBA,EAAU,IACpC5B,KAAKma,oBAAsB,aAC3Bna,KAAK+U,SAAW,GAChB/U,KAAKoa,iBAAmB,EACxB7X,EAAIC,WAAWb,EAAK,OACpB3B,KAAKuE,YhBoHMmI,KADUnI,EgBnHM3C,EAAQ2C,QhBqH5B,IAAI6D,EAAc/I,EAAS2J,aAEvB,OAAXzE,EACOrC,EAAWI,SAElBiC,EAAOpC,IACAoC,EAEJ,IAAI6D,EAAc7D,GgB5HrBvE,KAAKiR,QAAUjR,KAAKqa,WAAW1Y,IAC/BC,EAAUA,GAAW,IACb+C,uBAAkD+H,IAA9B9K,EAAQ+C,mBAA0C/C,EAAQ+C,kBAC/C,kBAA5B/C,EAAQgD,sBAA6D8H,IAA5B9K,EAAQgD,gBAIxD,MAAM,IAAIjE,MAAM,mEAHhBiB,EAAQgD,qBAA8C8H,IAA5B9K,EAAQgD,iBAAuChD,EAAQgD,gBAKrF,IAAI0V,EAAkB,KAClBC,EAAoB,KACxB,GAAIxX,EAAS0G,OAA0C,CAGnD,IAAIW,EAA0D,QAC9DkQ,EAAkBlQ,EAAY,MAC9BmQ,EAAoBnQ,EAAY,eAE/BrH,EAAS0G,QAA+B,oBAAd+Q,WAA8B5Y,EAAQ4Y,UAG5DzX,EAAS0G,SAAW7H,EAAQ4Y,WAC7BF,IACA1Y,EAAQ4Y,UAAYF,GAJxB1Y,EAAQ4Y,UAAYA,UAOnBzX,EAAS0G,QAAiC,oBAAhBgR,aAAgC7Y,EAAQ6Y,YAG9D1X,EAAS0G,SAAW7H,EAAQ6Y,kBACA,IAAtBF,IACP3Y,EAAQ6Y,YAAcF,GAJ1B3Y,EAAQ6Y,YAAcA,YAO1Bza,KAAKyE,WAAa7C,EAAQ6C,YAAc,IAAIyI,EAAkBlN,KAAKuE,QACnEvE,KAAK0Q,gBAAkB,eACvB1Q,KAAK4Q,mBAAoB,EACzB5Q,KAAK4B,QAAUA,EACf5B,KAAK+P,UAAY,KACjB/P,KAAKiQ,QAAU,KAmfnB,OAjfAiK,EAAeha,UAAUkR,MAAQ,SAAUY,GACvC,OAAO,EAAUhS,UAAM,OAAQ,GAAQ,WACnC,IAAayI,EACb,OAAO,GAAYzI,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAID,OAHAmM,EAAiBA,GAAkB1C,EAAeyI,OAClDxV,EAAIM,KAAKmP,EAAgB1C,EAAgB,kBACzCtP,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,6CAA+ClC,EAAe0C,GAAkB,MACnF,iBAAzBhS,KAAK0Q,gBACE,CAAC,EAAcxJ,QAAQE,OAAO,IAAIzG,MAAM,8EAEnDX,KAAK0Q,gBAAkB,aACvB1Q,KAAK0a,qBAAuB1a,KAAKyR,cAAcO,GACxC,CAAC,EAAahS,KAAK0a,uBAC9B,KAAK,EAED,OADAzV,EAAGa,OAC4B,kBAAzB9F,KAAK0Q,gBAAiE,CAAC,EAAa,IAC1FjI,EAAU,+DACVzI,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO8H,GAEzB,CAAC,EAAazI,KAAKsS,cAC9B,KAAK,EAGD,OADArN,EAAGa,OACI,CAAC,EAAcoB,QAAQE,OAAO,IAAIzG,MAAM8H,KACnD,KAAK,EACD,GAA6B,cAAzBzI,KAAK0Q,gBAGL,OAFAjI,EAAU,8GACVzI,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO8H,GACzB,CAAC,EAAcvB,QAAQE,OAAO,IAAIzG,MAAM8H,KAEnDxD,EAAGY,MAAQ,EACf,KAAK,EAED,OADA7F,KAAK4Q,mBAAoB,EAClB,CAAC,WAK5BsJ,EAAeha,UAAU2B,KAAO,SAAU2B,GACtC,MAA6B,cAAzBxD,KAAK0Q,gBACExJ,QAAQE,OAAO,IAAIzG,MAAM,yEAE/BX,KAAK2a,YACN3a,KAAK2a,UAAY,IAAIC,GAAmB5a,KAAK6a,YAG1C7a,KAAK2a,UAAU9Y,KAAK2B,KAE/B0W,EAAeha,UAAUmS,KAAO,SAAU1J,GACtC,OAAO,EAAU3I,UAAM,OAAQ,GAAQ,WACnC,IAAIQ,EAAQR,KACZ,OAAO,GAAYA,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EACD,MAA6B,iBAAzB7F,KAAK0Q,iBACL1Q,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,+BAAiC7I,EAAQ,0EAClE,CAAC,EAAczB,QAAQC,YAEL,kBAAzBnH,KAAK0Q,iBACL1Q,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,+BAAiC7I,EAAQ,2EAClE,CAAC,EAAc3I,KAAKsS,eAE/BtS,KAAK0Q,gBAAkB,gBACvB1Q,KAAKsS,YAAc,IAAIpL,SAAQ,SAAUC,GAErC3G,EAAM2Z,oBAAsBhT,KAGzB,CAAC,EAAanH,KAAKuS,aAAa5J,KAC3C,KAAK,EAGD,OADA1D,EAAGa,OACI,CAAC,EAAa9F,KAAKsS,aAC9B,KAAK,EAED,OADArN,EAAGa,OACI,CAAC,WAK5BoU,EAAeha,UAAUqS,aAAe,SAAU5J,GAC9C,OAAO,EAAU3I,UAAM,OAAQ,GAAQ,WACnC,IAAS4R,EACT,OAAO,GAAY5R,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAID7F,KAAK8a,UAAYnS,EACjB1D,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAK0a,sBAC9B,KAAK,EAGL,KAAK,EAED,OADMzV,EAAGa,OACF,CAAC,EAAa,GACzB,KAAK,EACD,IAAK9F,KAAK6a,UAAW,MAAO,CAAC,EAAa,GAC1C5V,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAK6a,UAAUxI,QACxC,KAAK,EAED,OADApN,EAAGa,OACI,CAAC,EAAa,GACzB,KAAK,EAID,OAHA8L,EAAM3M,EAAGa,OACT9F,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,gDAAkDiR,EAAM,MACxF5R,KAAK+a,iBACE,CAAC,EAAa,GACzB,KAAK,EAED,OADA/a,KAAK6a,eAAYnO,EACV,CAAC,EAAa,IACzB,KAAK,EACD1M,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,0FAChCvM,EAAGY,MAAQ,GACf,KAAK,GAAI,MAAO,CAAC,WAKjCqU,EAAeha,UAAUuR,cAAgB,SAAUO,GAC/C,OAAO,EAAUhS,UAAM,OAAQ,GAAQ,WACnC,IAAI2B,EAAKqZ,EAAmBC,EAAWzE,EAAS0E,EAAQC,EACxD,OAAO,GAAYnb,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EACDlE,EAAM3B,KAAKiR,QACXjR,KAAK0E,mBAAqB1E,KAAK4B,QAAQ8C,mBACvCO,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,GAAI,CAAE,KAClB1G,KAAK4B,QAAQwZ,gBACZpb,KAAK4B,QAAQiZ,YAAcxL,EAAkBgM,WAAoB,CAAC,EAAa,IAErFrb,KAAK6a,UAAY7a,KAAKsb,mBAAmBjM,EAAkBgM,YAGpD,CAAC,EAAarb,KAAKub,eAAe5Z,EAAKqQ,KANJ,CAAC,EAAa,GAO5D,KAAK,EAID,OADA/M,EAAGa,OACI,CAAC,EAAa,GACzB,KAAK,EAAG,MAAM,IAAInF,MAAM,gFACxB,KAAK,EAAG,MAAO,CAAC,EAAa,IAC7B,KAAK,EACDqa,EAAoB,KACpBC,EAAY,EACZzE,EAAU,WACN,IAAIgF,EACJ,OAAO,GAAYxb,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAAG,MAAO,CAAC,EAAaqV,EAAOO,uBAAuB9Z,IAC3D,KAAK,EAGD,GAFAqZ,EAAoB/V,EAAGa,OAEQ,kBAA3BoV,EAAOxK,iBAAsF,iBAA3BwK,EAAOxK,gBACzE,MAAM,IAAI/P,MAAM,kDAEpB,GAAIqa,EAAkBrS,MAClB,MAAM,IAAIhI,MAAMqa,EAAkBrS,OAEtC,GAAIqS,EAAkBU,gBAClB,MAAM,IAAI/a,MAAM,gMAUpB,OARIqa,EAAkBrZ,MAClBA,EAAMqZ,EAAkBrZ,KAExBqZ,EAAkBW,cAClBH,EAAgBR,EAAkBW,YAClCT,EAAOxW,mBAAqB,WAAc,OAAO8W,IAErDP,IACO,CAAC,QAIxBC,EAASlb,KACTiF,EAAGY,MAAQ,EACf,KAAK,EAAG,MAAO,CAAC,EAAc2Q,KAC9B,KAAK,EACDvR,EAAGa,OACHb,EAAGY,MAAQ,EACf,KAAK,EACD,GAAImV,EAAkBrZ,KAAOsZ,EAlPjC,IAkP4D,MAAO,CAAC,EAAa,GAC7EhW,EAAGY,MAAQ,EACf,KAAK,EACD,GArPJ,MAqPQoV,GAA+BD,EAAkBrZ,IACjD,MAAM,IAAIhB,MAAM,yCAEpB,MAAO,CAAC,EAAaX,KAAK4b,gBAAgBja,EAAK3B,KAAK4B,QAAQiZ,UAAWG,EAAmBhJ,IAC9F,KAAK,GACD/M,EAAGa,OACHb,EAAGY,MAAQ,GACf,KAAK,GAUD,OATI7F,KAAK6a,qBAAqBpD,IAC1BzX,KAAK+U,SAASC,mBAAoB,GAET,eAAzBhV,KAAK0Q,kBAGL1Q,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,8CAChCxR,KAAK0Q,gBAAkB,aAEpB,CAAC,EAAa,IACzB,KAAK,GAOD,OANAyK,EAAMlW,EAAGa,OACT9F,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,mCAAqCwa,GACrEnb,KAAK0Q,gBAAkB,eACvB1Q,KAAK6a,eAAYnO,EAEjB1M,KAAKma,sBACE,CAAC,EAAcjT,QAAQE,OAAO+T,IACzC,KAAK,GAAI,MAAO,CAAC,WAKjCjB,EAAeha,UAAUub,uBAAyB,SAAU9Z,GACxD,OAAO,EAAU3B,UAAM,OAAQ,GAAQ,WACnC,IAAIkF,EAASC,EAAOF,EAAIvC,EAAM2C,EAAOwW,EAActW,EAAUyV,EAAmBjF,EAChF,OAAO,GAAY/V,MAAM,SAAUoF,GAC/B,OAAQA,EAAGS,OACP,KAAK,EAED,OADAX,EAAU,GACLlF,KAAK0E,mBACH,CAAC,EAAa1E,KAAK0E,sBADW,CAAC,EAAa,GAEvD,KAAK,GACDS,EAAQC,EAAGU,UAEPZ,EAAuB,cAAI,UAAYC,GAE3CC,EAAGS,MAAQ,EACf,KAAK,EACDZ,EAAK8B,IAAsBrE,EAAOuC,EAAG,GAAII,EAAQJ,EAAG,GACpDC,EAAQxC,GAAQ2C,EAChBwW,EAAe7b,KAAK8b,oBAAoBna,GACxC3B,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,gCAAkCqK,EAAe,KACjFzW,EAAGS,MAAQ,EACf,KAAK,EAED,OADAT,EAAGW,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAKyE,WAAW1C,KAAK8Z,EAAc,CAChDra,QAAS,GACT0D,QAAS,EAAS,GAAIA,EAASlF,KAAK4B,QAAQsD,SAC5CN,gBAAiB5E,KAAK4B,QAAQgD,mBAE1C,KAAK,EAED,OAA4B,OAD5BW,EAAWH,EAAGU,QACDvF,WACF,CAAC,EAAc2G,QAAQE,OAAO,IAAIzG,MAAM,mDAAqD4E,EAAShF,WAAa,WAE9Hya,EAAoBhN,KAAKT,MAAMhI,EAAS/D,UACjB4Y,kBAAoBY,EAAkBZ,iBAAmB,KAG5EY,EAAkBe,gBAAkBf,EAAkBhK,cAEnD,CAAC,EAAcgK,IAC1B,KAAK,EAGD,OAFAjF,EAAM3Q,EAAGU,OACT9F,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,mDAAqDoV,GAC9E,CAAC,EAAc7O,QAAQE,OAAO2O,IACzC,KAAK,EAAG,MAAO,CAAC,WAKhCmE,EAAeha,UAAU8b,iBAAmB,SAAUra,EAAKoa,GACvD,OAAKA,EAGEpa,IAA6B,IAAtBA,EAAIqG,QAAQ,KAAc,IAAM,KAAQ,MAAQ+T,EAFnDpa,GAIfuY,EAAeha,UAAU0b,gBAAkB,SAAUja,EAAKsa,EAAoBjB,EAAmBkB,GAC7F,OAAO,EAAUlc,UAAM,OAAQ,GAAQ,WACnC,IAAImc,EAAYC,EAAqBC,EAAYC,EAAWrN,EAAIsN,EAAcC,EAAUC,EAAkBC,EAAMC,EAAMlU,EACtH,OAAO,GAAYzI,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAED,OADAsW,EAAanc,KAAKgc,iBAAiBra,EAAKqZ,EAAkBe,iBACrD/b,KAAK4c,aAAaX,IACvBjc,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,2EAChCxR,KAAK6a,UAAYoB,EACV,CAAC,EAAajc,KAAKub,eAAeY,EAAYD,KAHF,CAAC,EAAa,GAIrE,KAAK,EAGD,OAFAjX,EAAGa,OACH9F,KAAKgR,aAAegK,EAAkBhK,aAC/B,CAAC,GACZ,KAAK,EACDoL,EAAsB,GACtBC,EAAarB,EAAkB6B,qBAAuB,GACtDP,EAAYtB,EACZ/L,EAAK,EAAGsN,EAAeF,EACvBpX,EAAGY,MAAQ,EACf,KAAK,EACD,OAAMoJ,EAAKsN,EAAalb,QACxBmb,EAAWD,EAAatN,IACxBwN,EAAmBzc,KAAK8c,wBAAwBN,EAAUP,EAAoBC,cAC5Cvb,OAElCyb,EAAoB1V,KAAK8V,EAAS3B,UAAY,YAAc4B,GACrD,CAAC,EAAa,KAH4B,CAAC,EAAa,IAHvB,CAAC,EAAa,IAO1D,KAAK,EACD,IAAKzc,KAAK4c,aAAaH,GAAmB,MAAO,CAAC,EAAa,IAE/D,GADAzc,KAAK6a,UAAY4B,EACXH,EAAW,MAAO,CAAC,EAAa,GACtCrX,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAKyb,uBAAuB9Z,IACrD,KAAK,EAED,OADA2a,EAAYrX,EAAGa,OACR,CAAC,EAAa,GACzB,KAAK,EAED,OADA4W,EAAOzX,EAAGa,OACH,CAAC,EAAcoB,QAAQE,OAAOsV,IACzC,KAAK,EACDP,EAAanc,KAAKgc,iBAAiBra,EAAK2a,EAAUP,iBAClD9W,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,GAAI,CAAE,KAChB,CAAC,EAAa1G,KAAKub,eAAeY,EAAYD,IACzD,KAAK,GAGD,OAFAjX,EAAGa,OACH9F,KAAKgR,aAAesL,EAAUtL,aACvB,CAAC,GACZ,KAAK,GAKD,OAJA2L,EAAO1X,EAAGa,OACV9F,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,kCAAoC6b,EAAS3B,UAAY,MAAQ8B,GACjGL,OAAY5P,EACZ0P,EAAoB1V,KAAK8V,EAAS3B,UAAY,YAAc8B,GAC/B,eAAzB3c,KAAK0Q,iBACLjI,EAAU,uDACVzI,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO/I,GACzB,CAAC,EAAcvB,QAAQE,OAAO,IAAIzG,MAAM8H,MAE5C,CAAC,EAAa,IACzB,KAAK,GAED,OADAwG,IACO,CAAC,EAAa,GACzB,KAAK,GACD,OAAImN,EAAoB/a,OAAS,EACtB,CAAC,EAAc6F,QAAQE,OAAO,IAAIzG,MAAM,yEAA2Eyb,EAAoB/P,KAAK,QAEhJ,CAAC,EAAcnF,QAAQE,OAAO,IAAIzG,MAAM,yFAKnEuZ,EAAeha,UAAUob,mBAAqB,SAAUT,GACpD,OAAQA,GACJ,KAAKxL,EAAkBgM,WACnB,IAAKrb,KAAK4B,QAAQ4Y,UACd,MAAM,IAAI7Z,MAAM,qDAEpB,OAAO,IAAIyY,EAAmBpZ,KAAKyE,WAAYzE,KAAK0E,mBAAoB1E,KAAKuE,OAAQvE,KAAK4B,QAAQ+C,oBAAqB,EAAO3E,KAAK4B,QAAQ4Y,UAAWxa,KAAK4B,QAAQsD,SAAW,IAClL,KAAKmK,EAAkB0N,iBACnB,IAAK/c,KAAK4B,QAAQ6Y,YACd,MAAM,IAAI9Z,MAAM,uDAEpB,OAAO,IAAI+X,EAA0B1Y,KAAKyE,WAAYzE,KAAK0E,mBAAoB1E,KAAKuE,OAAQvE,KAAK4B,QAAQ+C,oBAAqB,EAAO3E,KAAK4B,QAAQ6Y,YAAaza,KAAK4B,QAAQgD,gBAAiB5E,KAAK4B,QAAQsD,SAAW,IACzN,KAAKmK,EAAkB2N,YACnB,OAAO,IAAIvF,EAAqBzX,KAAKyE,WAAYzE,KAAK0E,mBAAoB1E,KAAKuE,OAAQvE,KAAK4B,QAAQ+C,oBAAqB,EAAO3E,KAAK4B,QAAQgD,gBAAiB5E,KAAK4B,QAAQsD,SAAW,IAC1L,QACI,MAAM,IAAIvE,MAAM,sBAAwBka,EAAY,OAGhEX,EAAeha,UAAUqb,eAAiB,SAAU5Z,EAAKqQ,GACrD,IAAIxR,EAAQR,KAGZ,OAFAA,KAAK6a,UAAU9K,UAAY/P,KAAK+P,UAChC/P,KAAK6a,UAAU5K,QAAU,SAAUtJ,GAAK,OAAOnG,EAAMua,eAAepU,IAC7D3G,KAAK6a,UAAUjD,QAAQjW,EAAKqQ,IAEvCkI,EAAeha,UAAU4c,wBAA0B,SAAUN,EAAUP,EAAoBC,GACvF,IAAIrB,EAAYxL,EAAkBmN,EAAS3B,WAC3C,GAAIA,QAEA,OADA7a,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,uBAAyBgL,EAAS3B,UAAY,iDACvE,IAAIla,MAAM,uBAAyB6b,EAAS3B,UAAY,iDAG/D,IAiHZ,SAA0BoB,EAAoBgB,GAC1C,OAAQhB,GAAkE,IAA1CgB,EAAkBhB,GAlHtCiB,CAAiBjB,EAAoBpB,GAyBrC,OADA7a,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,uBAAyBnC,EAAkBwL,GAAa,4CACjF,IAAIla,MAAM,IAAM0O,EAAkBwL,GAAa,gCAvBtD,KADsB2B,EAASW,gBAAgBC,KAAI,SAAUnc,GAAK,OAAOqO,EAAerO,MACpE+G,QAAQkU,IAA4B,GAkBpD,OADAlc,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,uBAAyBnC,EAAkBwL,GAAa,gEAAkEvL,EAAe4M,GAA2B,MAC7L,IAAIvb,MAAM,IAAM0O,EAAkBwL,GAAa,sBAAwBvL,EAAe4M,GAA2B,KAjBxH,GAAKrB,IAAcxL,EAAkBgM,aAAerb,KAAK4B,QAAQ4Y,WAC5DK,IAAcxL,EAAkB0N,mBAAqB/c,KAAK4B,QAAQ6Y,YAEnE,OADAza,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,uBAAyBnC,EAAkBwL,GAAa,uDACjF,IAAIla,MAAM,IAAM0O,EAAkBwL,GAAa,2CAGtD7a,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,wBAA0BnC,EAAkBwL,GAAa,MACzF,IACI,OAAO7a,KAAKsb,mBAAmBT,GAEnC,MAAOwC,GACH,OAAOA,IAe/BnD,EAAeha,UAAU0c,aAAe,SAAU/B,GAC9C,OAAOA,GAAoC,iBAAhB,GAA4B,YAAaA,GAExEX,EAAeha,UAAU6a,eAAiB,SAAUpS,GAChD,IAAInI,EAAQR,KAMZ,GALAA,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,iCAAmC7I,EAAQ,2BAA6B3I,KAAK0Q,gBAAkB,KAC/H1Q,KAAK6a,eAAYnO,EAEjB/D,EAAQ3I,KAAK8a,WAAanS,EAC1B3I,KAAK8a,eAAYpO,EACY,iBAAzB1M,KAAK0Q,gBAAT,CAIA,GAA6B,eAAzB1Q,KAAK0Q,gBAEL,MADA1Q,KAAKuE,OAAOpC,IAAI9C,EAASyJ,QAAS,yCAA2CH,EAAQ,0EAC/E,IAAIhI,MAAM,iCAAmCgI,EAAQ,uEAqB/D,GAnB6B,kBAAzB3I,KAAK0Q,iBAGL1Q,KAAKma,sBAELxR,EACA3I,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,uCAAyCgI,EAAQ,MAGjF3I,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,4BAEtChJ,KAAK2a,YACL3a,KAAK2a,UAAUtI,OAAOlK,OAAM,SAAUxB,GAClCnG,EAAM+D,OAAOpC,IAAI9C,EAASsB,MAAO,0CAA4CgG,EAAI,SAErF3G,KAAK2a,eAAYjO,GAErB1M,KAAKgR,kBAAetE,EACpB1M,KAAK0Q,gBAAkB,eACnB1Q,KAAK4Q,kBAAmB,CACxB5Q,KAAK4Q,mBAAoB,EACzB,IACQ5Q,KAAKiQ,SACLjQ,KAAKiQ,QAAQtH,GAGrB,MAAOhC,GACH3G,KAAKuE,OAAOpC,IAAI9C,EAASsB,MAAO,0BAA4BgI,EAAQ,kBAAoBhC,EAAI,aAlChG3G,KAAKuE,OAAOpC,IAAI9C,EAASmS,MAAO,yCAA2C7I,EAAQ,+EAsC3FuR,EAAeha,UAAUma,WAAa,SAAU1Y,GAE5C,GAAuC,IAAnCA,EAAI2b,YAAY,WAAY,IAA8C,IAAlC3b,EAAI2b,YAAY,UAAW,GACnE,OAAO3b,EAEX,IAAKoB,EAASM,YAAcJ,OAAOsa,SAC/B,MAAM,IAAI5c,MAAM,mBAAqBgB,EAAM,MAO/C,IAAI6b,EAAOva,OAAOsa,SAASE,cAAc,KAGzC,OAFAD,EAAKE,KAAO/b,EACZ3B,KAAKuE,OAAOpC,IAAI9C,EAAS2J,YAAa,gBAAkBrH,EAAM,SAAW6b,EAAKE,KAAO,MAC9EF,EAAKE,MAEhBxD,EAAeha,UAAU4b,oBAAsB,SAAUna,GACrD,IAAImG,EAAQnG,EAAIqG,QAAQ,KACpB6T,EAAela,EAAIiN,UAAU,GAAc,IAAX9G,EAAenG,EAAIN,OAASyG,GAUhE,MAT8C,MAA1C+T,EAAaA,EAAaxa,OAAS,KACnCwa,GAAgB,KAEpBA,GAAgB,aAEkC,KADlDA,IAA2B,IAAX/T,EAAe,GAAKnG,EAAIiN,UAAU9G,IACjCE,QAAQ,sBACrB6T,IAA2B,IAAX/T,EAAe,IAAM,IACrC+T,GAAgB,oBAAsB7b,KAAKoa,kBAExCyB,GAEJ3B,EAliBwB,GAyiB/BU,GAAoC,WACpC,SAASA,EAAmBC,GACxB7a,KAAK6a,UAAYA,EACjB7a,KAAK0O,OAAS,GACd1O,KAAK2d,WAAY,EACjB3d,KAAK4d,iBAAmB,IAAIC,GAC5B7d,KAAK8d,gBAAkB,IAAID,GAC3B7d,KAAK+d,gBAAkB/d,KAAKge,WAyEhC,OAvEApD,EAAmB1a,UAAU2B,KAAO,SAAU2B,GAK1C,OAJAxD,KAAKie,WAAWza,GACXxD,KAAK8d,kBACN9d,KAAK8d,gBAAkB,IAAID,IAExB7d,KAAK8d,gBAAgBI,SAEhCtD,EAAmB1a,UAAUmS,KAAO,WAGhC,OAFArS,KAAK2d,WAAY,EACjB3d,KAAK4d,iBAAiBzW,UACfnH,KAAK+d,iBAEhBnD,EAAmB1a,UAAU+d,WAAa,SAAUza,GAChD,GAAIxD,KAAK0O,OAAOrN,eAAkBrB,KAAK0O,OAAO,WAAe,EACzD,MAAM,IAAI/N,MAAM,sCAAyCX,KAAW,OAAI,2BAA6B,GAEzGA,KAAK0O,OAAOhI,KAAKlD,GACjBxD,KAAK4d,iBAAiBzW,WAE1ByT,EAAmB1a,UAAU8d,SAAW,WACpC,OAAO,EAAUhe,UAAM,OAAQ,GAAQ,WACnC,IAAI8d,EAAiBta,EAAM2a,EAC3B,OAAO,GAAYne,MAAM,SAAUiF,GAC/B,OAAQA,EAAGY,OACP,KAAK,EAED,MAAO,CAAC,EAAa7F,KAAK4d,iBAAiBM,SAC/C,KAAK,EAED,GADAjZ,EAAGa,QACE9F,KAAK2d,UAIN,OAHI3d,KAAK8d,iBACL9d,KAAK8d,gBAAgB1W,OAAO,uBAEzB,CAAC,EAAa,GAEzBpH,KAAK4d,iBAAmB,IAAIC,GAC5BC,EAAkB9d,KAAK8d,gBACvB9d,KAAK8d,qBAAkBpR,EACvBlJ,EAAmC,iBAApBxD,KAAK0O,OAAO,GACvB1O,KAAK0O,OAAOrC,KAAK,IACjBuO,EAAmBwD,cAAcpe,KAAK0O,QAC1C1O,KAAK0O,OAAOrN,OAAS,EACrB4D,EAAGY,MAAQ,EACf,KAAK,EAED,OADAZ,EAAGc,KAAKW,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,EAAa1G,KAAK6a,UAAUhZ,KAAK2B,IAC7C,KAAK,EAGD,OAFAyB,EAAGa,OACHgY,EAAgB3W,UACT,CAAC,EAAa,GACzB,KAAK,EAGD,OAFAgX,EAAUlZ,EAAGa,OACbgY,EAAgB1W,OAAO+W,GAChB,CAAC,EAAa,GACzB,KAAK,EAAG,MAAO,CAAC,EAAa,GAC7B,KAAK,EAAG,MAAO,CAAC,WAKhCvD,EAAmBwD,cAAgB,SAAUC,GAIzC,IAHA,IAAIC,EAAcD,EAAajB,KAAI,SAAUxd,GAAK,OAAOA,EAAEgE,cAAe2a,QAAO,SAAUC,EAAG5e,GAAK,OAAO4e,EAAI5e,KAC1G2H,EAAS,IAAIzD,WAAWwa,GACxBG,EAAS,EACJxP,EAAK,EAAGyP,EAAiBL,EAAcpP,EAAKyP,EAAerd,OAAQ4N,IAAM,CAC9E,IAAID,EAAO0P,EAAezP,GAC1B1H,EAAO2J,IAAI,IAAIpN,WAAWkL,GAAOyP,GACjCA,GAAUzP,EAAKpL,WAEnB,OAAO2D,EAAOmH,QAEXkM,EAhF4B,GAmFnCiD,GAA+B,WAC/B,SAASA,IACL,IAAIrd,EAAQR,KACZA,KAAKke,QAAU,IAAIhX,SAAQ,SAAUC,EAASC,GAC1C,IAAInC,EACJ,OAAOA,EAAK,CAACkC,EAASC,GAAS5G,EAAMme,SAAW1Z,EAAG,GAAIzE,EAAMoe,SAAW3Z,EAAG,GAAIA,KASvF,OANA4Y,EAAc3d,UAAUiH,QAAU,WAC9BnH,KAAK2e,YAETd,EAAc3d,UAAUkH,OAAS,SAAU6S,GACvCja,KAAK4e,SAAS3E,IAEX4D,EAduB,GCzqB9BgB,GAAiC,WACjC,SAASA,IAEL7e,KAAK0C,KALgB,OAOrB1C,KAAKkJ,QAAU,EAEflJ,KAAKgS,eAAiB1C,EAAewJ,KAsFzC,OA/EA+F,EAAgB3e,UAAUsU,cAAgB,SAAUhH,EAAOjJ,GAEvD,GAAqB,iBAAViJ,EACP,MAAM,IAAI7M,MAAM,2DAEpB,IAAK6M,EACD,MAAO,GAEI,OAAXjJ,IACAA,EAASrC,EAAWI,UAKxB,IAFA,IACIwc,EAAc,GACT7P,EAAK,EAAGsF,EAFFpH,EAAkBI,MAAMC,GAECyB,EAAKsF,EAAWlT,OAAQ4N,IAAM,CAClE,IAAIxG,EAAU8L,EAAWtF,GACrB8P,EAAgB/Q,KAAKT,MAAM9E,GAC/B,GAAkC,iBAAvBsW,EAAclQ,KACrB,MAAM,IAAIlO,MAAM,oBAEpB,OAAQoe,EAAclQ,MAClB,KAAK5E,EAAYwK,WACbzU,KAAKgf,oBAAoBD,GACzB,MACJ,KAAK9U,EAAY0K,WACb3U,KAAKif,oBAAoBF,GACzB,MACJ,KAAK9U,EAAYuJ,WACbxT,KAAKkf,oBAAoBH,GACzB,MACJ,KAAK9U,EAAY8G,KAGjB,KAAK9G,EAAY2K,MAEb,MACJ,QAEIrQ,EAAOpC,IAAI9C,EAAS2J,YAAa,yBAA2B+V,EAAclQ,KAAO,cACjF,SAERiQ,EAAYpY,KAAKqY,GAErB,OAAOD,GAOXD,EAAgB3e,UAAU4Q,aAAe,SAAUrI,GAC/C,OAAO0E,EAAkBC,MAAMY,KAAKC,UAAUxF,KAElDoW,EAAgB3e,UAAU8e,oBAAsB,SAAUvW,GACtDzI,KAAKmf,qBAAqB1W,EAAQ8M,OAAQ,gDACb7I,IAAzBjE,EAAQ+H,cACRxQ,KAAKmf,qBAAqB1W,EAAQ+H,aAAc,4CAGxDqO,EAAgB3e,UAAU+e,oBAAsB,SAAUxW,GAEtD,GADAzI,KAAKmf,qBAAqB1W,EAAQ+H,aAAc,gDAC3B9D,IAAjBjE,EAAQuG,KACR,MAAM,IAAIrO,MAAM,4CAGxBke,EAAgB3e,UAAUgf,oBAAsB,SAAUzW,GACtD,GAAIA,EAAQlB,QAAUkB,EAAQE,MAC1B,MAAM,IAAIhI,MAAM,4CAEf8H,EAAQlB,QAAUkB,EAAQE,OAC3B3I,KAAKmf,qBAAqB1W,EAAQE,MAAO,2CAE7C3I,KAAKmf,qBAAqB1W,EAAQ+H,aAAc,4CAEpDqO,EAAgB3e,UAAUif,qBAAuB,SAAU9Z,EAAO/E,GAC9D,GAAqB,iBAAV+E,GAAgC,KAAVA,EAC7B,MAAM,IAAI1E,MAAML,IAGjBue,EA7FyB,GCPhC,GAAsCtf,OAAOwB,QAAU,SAASC,GAChE,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIrB,KADToB,EAAIG,UAAUF,GACO3B,OAAOW,UAAUJ,eAAeY,KAAKO,EAAGpB,KACzDmB,EAAEnB,GAAKoB,EAAEpB,IAEjB,OAAOmB,GAUPoe,GAAsB,CACtBC,MAAOhgB,EAAS2H,MAChBsY,MAAOjgB,EAASmS,MAChBvI,KAAM5J,EAAS2J,YACfuW,YAAalgB,EAAS2J,YACtBD,KAAM1J,EAASyJ,QACf0W,QAASngB,EAASyJ,QAClBH,MAAOtJ,EAASsB,MAChB8e,SAAUpgB,EAASqJ,SACnBgX,KAAMrgB,EAASsgB,MAefC,GAAsC,WACtC,SAASA,KA0ET,OAxEAA,EAAqB1f,UAAU2f,iBAAmB,SAAUC,GAExD,GADAvd,EAAIC,WAAWsd,EAAS,gBA2ENpT,IA1ELoT,EA0EH3d,IAzENnC,KAAKuE,OAASub,OAEb,GAAuB,iBAAZA,EAAsB,CAClC,IAAItX,EAtBhB,SAAuB9F,GAInB,IAAIqd,EAAUX,GAAoB1c,EAAKqR,eACvC,QAAuB,IAAZgM,EACP,OAAOA,EAGP,MAAM,IAAIpf,MAAM,sBAAwB+B,GAarBsd,CAAcF,GAC7B9f,KAAKuE,OAAS,IAAI6D,EAAcI,QAGhCxI,KAAKuE,OAAS,IAAI6D,EAAc0X,GAEpC,OAAO9f,MAEX4f,EAAqB1f,UAAU+f,QAAU,SAAUte,EAAKue,GAYpD,OAXA3d,EAAIC,WAAWb,EAAK,OACpBY,EAAII,WAAWhB,EAAK,OACpB3B,KAAK2B,IAAMA,EAIP3B,KAAKmgB,sBAAwB,GAAS,GAAIngB,KAAKmgB,sBADb,iBAA3BD,EAC+DA,EAGA,CAAErF,UAAWqF,IAEhFlgB,MAMX4f,EAAqB1f,UAAUkgB,gBAAkB,SAAU3Q,GAGvD,OAFAlN,EAAIC,WAAWiN,EAAU,YACzBzP,KAAKyP,SAAWA,EACTzP,MAEX4f,EAAqB1f,UAAUmgB,uBAAyB,SAAUC,GAC9D,GAAItgB,KAAK0P,gBACL,MAAM,IAAI/O,MAAM,2CAWpB,OATK2f,EAGI5gB,MAAM6gB,QAAQD,GACnBtgB,KAAK0P,gBAAkB,IAAIyH,EAAuBmJ,GAGlDtgB,KAAK0P,gBAAkB4Q,EANvBtgB,KAAK0P,gBAAkB,IAAIyH,EAQxBnX,MAMX4f,EAAqB1f,UAAUsgB,MAAQ,WAGnC,IAAIL,EAAwBngB,KAAKmgB,uBAAyB,GAO1D,QALqCzT,IAAjCyT,EAAsB5b,SAEtB4b,EAAsB5b,OAASvE,KAAKuE,SAGnCvE,KAAK2B,IACN,MAAM,IAAIhB,MAAM,4FAEpB,IAAI6O,EAAa,IAAI0K,GAAela,KAAK2B,IAAKwe,GAC9C,OAAO5Q,EAAcpP,OAAOqP,EAAYxP,KAAKuE,QAAUrC,EAAWI,SAAUtC,KAAKyP,UAAY,IAAIoP,GAAmB7e,KAAK0P,kBAEtHkQ,EA3E8B,G,uKNpCzC,IAAMa,GAAS,I,WOFX,c,4FAAa,SACTzgB,KAAKwP,YAAc,IAAIkR,IAClBb,iBAAiBa,SACjBT,QAAQ,gCAAiC,CAEtC7E,iBAAiB,EACjBP,UAAW6F,eAEdL,yBACAG,Q,kDAQT,WAAkB,OAAOxgB,KAAKwP,a,mBAQ9B,SAAMmR,EAAWC,GACb5gB,KAAKwP,WAAW4B,QAAQ5J,MAAM,WAC1BmZ,OACDxY,OAAQ,SAAA+G,GACP0R,EAAQ1R,Q,mBAUhB,SAAMqI,EAAUsJ,GACZ7gB,KAAKwP,WAAWoE,OAAO,QAAQ2D,EAASsJ,GACnC1Y,OAAM,SAAA+G,GAAG,OAAI3G,QAAQI,MAAMuG,EAAIhL,iB,sBAMxC,WAEIlE,KAAKwP,WAAWoE,OAAO,YAClBzL,OAAM,SAAA+G,GAAG,OAAI3G,QAAQI,MAAMuG,EAAIhL,iB,6BAOxC,SAAgBqT,GACZvX,KAAKwP,WAAWoE,OAAO,kBAAkB2D,GACpCpP,OAAM,SAAA+G,GAAG,OAAI3G,QAAQI,MAAMuG,EAAIhL,iB,2BAUxC,SAAcyc,EAAWC,GACrB5gB,KAAKwP,WAAWqE,GAAG,eAAe,SAAS/H,GAEnCA,EACA6U,IAGAC,S,mCAUZ,SAAsBE,GAClB9gB,KAAKwP,WAAWqE,GAAG,kBAAkB,SAAUkN,EAAaC,GAExDF,EAAQC,EAAYC,EAAK,c,qCASjC,SAAwBF,GACpB9gB,KAAKwP,WAAWqE,GAAG,yBAAyB,SAAUkN,EAAaC,GAE/DF,EAAQC,EAAYC,EAAK,a,gCASjC,SAAmBF,GACf9gB,KAAKwP,WAAWqE,GAAG,mBAAmB,SAAAmN,GAClCF,EAAQE,Q,iCAShB,SAAoBF,GAChB9gB,KAAKwP,WAAWqE,GAAG,oBAAoB,SAAAmN,GACnCF,EAAQE,Q,mCAShB,SAAsBF,GAClB9gB,KAAKwP,WAAWqE,GAAG,0BAA0B,SAAAmN,GACzCF,EAAQE,Q,8BAYhB,SAAiBzJ,EAAUwJ,EAAatY,EAASoG,GAC7C7O,KAAKwP,WAAWoE,OAAO,qBAAsB2D,EAAUwJ,EAAatY,EAASoG,GACxE1G,OAAM,SAAC+G,GAAD,OAAS3G,QAAQI,MAAMuG,EAAIhL,iB,gCAW1C,SAAmBqT,EAAUwJ,EAAatY,EAASoG,GAC/C7O,KAAKwP,WAAWoE,OAAO,qBAAsB2D,EAAUwJ,EAAatY,EAASoG,GAC5E1G,OAAM,SAAC+G,GAAD,OAAS3G,QAAQI,MAAMuG,EAAIhL,iB,iCAQtC,SAAoBqT,EAAU0J,GAC1BjhB,KAAKwP,WAAWoE,OAAO,sBAAuB2D,EAAU0J,GACnD9Y,OAAM,SAAA+G,GAAG,OAAI3G,QAAQI,MAAMuG,EAAIhL,iB,4BAUxC,SAAeqT,EAAU0J,GACrBjhB,KAAKwP,WAAWoE,OAAO,iBAAkB2D,EAAU0J,GAC9C9Y,OAAM,SAAA+G,GAAG,OAAI3G,QAAQI,MAAMuG,EAAIhL,iB,gCASxC,SAAmBgd,EAASrS,GACxB7O,KAAKwP,WAAWoE,OAAO,qBAAsBsN,EAAUrS,GAClD1G,OAAM,SAAA+G,GAAG,OAAI3G,QAAQI,MAAMuG,EAAIhL,oB,wBP9LtCid,GAAS,CAAEC,KAAM,GAAIvS,KAAM,IAC3BwS,GAAW,CAAErS,KAAM,OAAQH,KAAM,QAEjCyS,GAAW/D,SAASgE,cAAc,aAElCC,GAAS,IAAIC,IAEF,IAAIA,IA8BrBH,GAASI,UAAW,EAGpBjB,GAAOrP,OAAM,WACTkQ,GAASI,UAAW,EACpBnZ,QAAQpG,IAAI,qBACZmf,GAASK,MAAMC,MAAQ,QACvBN,GAASjc,MAAQ,WAClB,SAAC6J,GAGA,OAFAoS,GAASK,MAAMC,MAAQ,MACvBN,GAASjc,MAAQ,aACVkD,QAAQI,MAAMuG,EAAIhL,eAK7Bod,GAASO,iBAAiB,SAAS,SAACnI,GAEhCnC,EAAWgG,SAASgE,cAAc,kBAAkBlc,MACpDob,GAAOqB,MAAMvK,EAAUgG,SAASgE,cAAc,kBAAkBlc,OAChEqU,EAAMqI,oBAIVxE,SAASgE,cAAc,kBAAkBM,iBAAiB,SAAS,SAACnI,GAE9C,UAAdA,EAAMpD,MACNoD,EAAMqI,iBACNT,GAASU,YAKjBvB,GAAOwB,eAAc,WACjBC,KACAzB,GAAO0B,WACP1B,GAAO2B,gBAAgB7K,MACxB,WACC+J,GAASK,MAAMC,MAAQ,MACvBN,GAASjc,MAAQ,QACjBkY,SAASgE,cAAc,kBAAkBM,iBAAiB,SAAS,WAC/DP,GAASK,MAAMC,MAAQ,QACvBN,GAASjc,MAAQ,cAczB,IAAM6c,GAAgB,WAEDxiB,MAAMQ,UAAUuO,MAAM/N,KAAK4gB,GAASe,WAAWC,UACvDte,SAAQ,SAAAue,GAAE,OAAIA,EAAGC,YAE1B,IAAMC,EAAYlF,SAASgE,cAAc,cACzCkB,EAAUD,SAEV,IAAME,EAAWnF,SAASE,cAAc,OAElCkF,EAAapF,SAASE,cAAc,OACpCmF,EAAYrF,SAASE,cAAc,OAEnCoF,EAAetF,SAASE,cAAc,OACtCqF,EAAevF,SAASE,cAAc,SACtCsF,EAAaxF,SAASE,cAAc,SACpCnZ,EAAciZ,SAASE,cAAc,OACrCuF,EAAYzF,SAASE,cAAc,OACnCpR,EAAOkR,SAASE,cAAc,OAE9BwF,EAAO1F,SAASE,cAAc,OAC9ByF,EAAO3F,SAASE,cAAc,OAC9B0F,EAAO5F,SAASE,cAAc,OAC9B2F,EAAS7F,SAASE,cAAc,OAEtCwF,EAAKtB,MAAM0B,MAAQ,OACnBJ,EAAKtB,MAAM2B,QAAU,OACrBJ,EAAKvB,MAAM0B,MAAQ,OAEnBX,EAASa,UAAUC,IAAI,YAEvBb,EAAWY,UAAUC,IAAI,aACzBb,EAAW3L,GAAK,aAChB2L,EAAWhB,MAAM8B,OAAS,QAE1Bb,EAAUW,UAAUC,IAAI,aACxBZ,EAAU5L,GAAK,YAEf+L,EAAWQ,UAAUC,IAAI,cACzBX,EAAaU,UAAUC,IAAI,gBAC3BV,EAAaS,UAAUC,IAAI,gBAC3Blf,EAAYif,UAAUC,IAAI,eAC1BR,EAAUO,UAAUC,IAAI,SACxBnX,EAAKkX,UAAUC,IAAI,WACnBJ,EAAOG,UAAUC,IAAI,YAGrBlf,EAAYof,UAAY,cACxBrX,EAAKqX,UAAY,cAGjBX,EAAWlU,KAAO,OAClBkU,EAAWY,OAAS,mBAGpBP,EAAOQ,YAAYb,GACnBN,EAAUmB,YAAYf,GACtBJ,EAAUmB,YAAYZ,GACtBP,EAAUmB,YAAYX,GACtBA,EAAKW,YAAYV,GACjBA,EAAKU,YAAYd,GACjBG,EAAKW,YAAYR,GACjBH,EAAKW,YAAYtf,GAEjB6e,EAAKS,YAAYjB,GACjBQ,EAAKS,YAAYvX,GAEjBqW,EAASkB,YAAYT,GACrBT,EAASkB,YAAYnB,GACrBC,EAASkB,YAAYhB,GAErBrF,SAASgE,cAAc,YAAYqC,YAAYlB,GAK/CK,EAAWlB,iBAAiB,UAAU,SAAAlb,GAClC,IAAMkd,EAAOld,EAAE4O,OAAOuO,MAAM,GAC5B3C,GAAOtS,KAAOgV,EAAKhV,KAAKD,UAAU,EAAG,GACrCrG,QAAQpG,IAAI,+DACZoG,QAAQpG,IAAI,aAAcgf,GAAOtS,MACjCtG,QAAQpG,IAAI,+DACZ4hB,GAASF,MAGbpD,GAAOuD,sBAAsBC,IAE7BxD,GAAOyD,wBAAwBD,IAE/BxD,GAAO0D,mBAAmBC,IAE1B3D,GAAO4D,oBAAoBC,IAE3B7D,GAAO8D,uBAAuB,SAACvD,GAC3B,IAAMwD,EAAOxW,KAAKT,MAAMyT,GACxBzY,QAAQkc,IAAID,GACZE,GAAaF,MAMjBnY,EAAKwV,iBAAiB,QAAS8C,IAE/BpH,SAASgE,cAAc,gBAAgBM,iBAAiB,SAAS,SAACnI,GAC9D,IAAMjR,EAAU8U,SAASgE,cAAc,iBAAiBlc,MACxDkY,SAASgE,cAAc,iBAAiBlc,MAAQ,GACG,IAA/CkY,SAASgE,cAAc,eAAelc,OAEhB,SAAlBgc,GAASxS,KACT4R,GAAOmE,mBAAmBrN,EAAU8J,GAASrS,KAAMmS,GAAOC,KAAMD,GAAOtS,MAIvE4R,GAAOoE,iBAAiBtN,EAAU8J,GAASrS,KAAMmS,GAAOC,KAAMD,GAAOtS,MAGzE0O,SAASgE,cAAc,eAAelc,MAAQ,IAGxB,SAAlBgc,GAASrS,MACTzG,QAAQpG,IAAI,2BACZob,SAASgE,cAAc,iBAAiBlc,MAAQoD,GAGzB,SAAlB4Y,GAASxS,MAEd4R,GAAOmE,mBAAmBrN,EAAU8J,GAASrS,KAAMvG,EAAS,QAE5DF,QAAQpG,IAAI,wBAGZse,GAAOoE,iBAAiBtN,EAAU8J,GAASrS,KAAMvG,EAAS,QAE1DF,QAAQpG,IAAI,0BAOxB2gB,EAAajB,iBAAiB,SAAS,SAACnI,GAClB,UAAdA,EAAMpD,MACNoD,EAAMqI,iBACNzd,EAAY0d,aAMlBoC,GAAiB,SAAUpD,GAE7BzY,QAAQpG,IAAI,WACZ,IAMI2iB,EANElC,EAAYrF,SAASgE,cAAc,cAExB7hB,MAAMQ,UAAUuO,MAAM/N,KAAKkiB,EAAUN,UAC7Cte,SAAQ,SAAAue,GAAE,OAAIA,EAAGC,YAE1Bja,QAAQpG,IAAI,WAEZ,IAAM4iB,EAAQ/W,KAAKT,MAAMyT,GACzBzY,QAAQkc,IAAIM,GACZA,EAAM/gB,SAAQ,SAAAue,IACVuC,EAAOvH,SAASE,cAAc,MACzBiG,UAAYnB,EAAG7f,KACpBoiB,EAAK9N,GAAKuL,EAAG7f,KACT8e,GAAOwD,IAAIzC,EAAG7f,OACdoiB,EAAKvB,UAAUC,IAAI,UAEH,SAAhBjB,EAAG0C,SACHH,EAAKnD,MAAMC,MAAQ,UAEnBkD,EAAKnD,MAAMC,MAAQ,QAInBW,EAAG7f,OAAS2e,GAASrS,MACrB8V,EAAKvB,UAAUC,IAAI,YAGvBsB,EAAKjD,iBAAiB,QAASqD,IAC/BtC,EAAUgB,YAAYkB,MAK1BxZ,YAAW,WACPmV,GAAO0B,WACP1B,GAAO2B,gBAAgB7K,KACxB,OAGD+M,GAAkB,SAAUtD,GAE9B,IAAM4B,EAAYrF,SAASgE,cAAc,eAExB7hB,MAAMQ,UAAUuO,MAAM/N,KAAKkiB,EAAUN,UAC7Cte,SAAQ,SAAAue,GAAE,OAAIA,EAAGC,YAE1Bja,QAAQpG,IAAI,SACZ,IACI8e,EADAkE,GAAO,EAELC,EAASpX,KAAKT,MAAMyT,GAC1BzY,QAAQkc,IAAIW,GACZA,EAAOphB,SAAQ,SAAAue,IACXtB,EAAQ1D,SAASE,cAAc,MACzBiG,UAAYnB,EAClBha,QAAQpG,IAAI,cAAgBogB,GAC5BtB,EAAMjK,GAAKuL,EAAK,GAChBtB,EAAMU,MAAMC,MAAQ,QAChBJ,GAAOwD,IAAIzC,IACXtB,EAAMsC,UAAUC,IAAI,UAEpBjB,IAAOlB,GAASrS,OAChBmW,GAAO,EACPlE,EAAMsC,UAAUC,IAAI,aAExBvC,EAAMY,iBAAiB,QAASqD,IAChCtC,EAAUgB,YAAY3C,MAG1B1Y,QAAQpG,IAAI,OAAQgjB,EAAM,QAAS9D,GAASxS,OAC/B,IAATsW,GAAmC,SAAlB9D,GAASxS,MAC1BwW,MAIFH,GAAc,WAEhB3H,SAASgE,cAAc,YAAYmC,UAAY,cAEzB,SAAlBrC,GAASrS,OACTzG,QAAQpG,IAAI,8BACZob,SAAS+H,eAAejE,GAASrS,MAAMuU,UAAUf,OAAO,UACxDja,QAAQkc,IAAIlH,SAAS+H,eAAejE,GAASrS,OAC7CwS,GAAOxf,OAAOqf,GAASrS,OAM3B,IAAMuW,EAAMhI,SAASgE,cAAc,aAE/BgE,GACAA,EAAIhC,UAAUf,OAAO,YAGrBnB,GAASrS,OAAShP,KAAK0jB,WAEvB1jB,KAAK4hB,MAAQ,QACbP,GAASrS,KAAO,OAChBqS,GAASxS,KAAO,SAGhBwS,GAASrS,KAAOhP,KAAK0jB,UACM,cAAvB1jB,KAAKqiB,WAAWrL,IAChBwO,GAAkBnE,GAASrS,KAAM,WACjCqS,GAASxS,KAAO,SAEhB0O,SAASgE,cAAc,YAAYmC,UAAY,eAC/C8B,GAAkBnE,GAASrS,KAAM,UACjCqS,GAASxS,KAAO,SAEpB7O,KAAKujB,UAAUC,IAAI,aAEvBjb,QAAQkc,IAAIpD,KAOVsD,GAAa,WAEf,GAAsB,UAAlBtD,GAASxS,KAET4R,GAAOgF,oBAAoBlO,EAAU8J,GAASrS,MAE9CqS,GAASrS,KAAO,OAChBqS,GAASxS,KAAO,OAChB0O,SAASgE,cAAc,YAAYmC,UAAY,kBAE5C,CACH,IAAMzgB,EAASsa,SAASE,cAAc,OAChCiI,EAAanI,SAASE,cAAc,SACpCkI,EAAUpI,SAASE,cAAc,OAEvCiI,EAAWnC,UAAUC,IAAI,cACzBmC,EAAQpC,UAAUC,IAAI,kBACtBvgB,EAAOsgB,UAAUC,IAAI,cAErBkC,EAAWE,YAAc,YACzBD,EAAQjC,UAAY,cAEpBzgB,EAAO2gB,YAAY8B,GACnBziB,EAAO2gB,YAAY+B,GAEnBpI,SAASgE,cAAc,QAAQqC,YAAY3gB,GAE3CyiB,EAAW7D,iBAAiB,SAAS,WACR,KAArB6D,EAAWrgB,MACXsgB,EAAQjC,UAAY,cAEpBiC,EAAQjC,UAAY,iBAM5BiC,EAAQ9D,iBAAiB,SAAS,WACL,KAArB6D,EAAWrgB,OAIXob,GAAOoF,eAAetO,EAAUmO,EAAWrgB,OAH3CpC,EAAOuf,cAYjBgD,GAAoB,SAAUtE,EAAUrS,GAE1C4R,GAAOqF,mBAAmB5E,EAAUrS,GAEpCwW,MAEEpB,GAAgB,SAAUlD,EAAaC,EAAMnS,GAC/C,IAAMgU,EAAetF,SAASgE,cAAc,iBACtC9Y,EAAUuF,KAAKT,MAAMyT,GAErB+E,EAAMxI,SAASE,cAAc,KAC/B4D,GAASrS,OAAS+R,GAAeM,GAASxS,OAASA,GACnDgU,EAAae,YAAYmC,GACrBtd,EAAQud,SAAWzO,GACnB9O,EAAQud,OAAS,MACjBD,EAAIpE,MAAM0B,MAAQ,MAClB0C,EAAIpE,MAAMsE,MAAQ,QAClBF,EAAIpE,MAAMuE,UAAY,QACtBH,EAAIpE,MAAMwE,YAAc,MACxBJ,EAAIpE,MAAMC,MAAQ,YAElBmE,EAAIpE,MAAM0B,MAAQ,MAClB0C,EAAIpE,MAAMsE,MAAQ,OAClBF,EAAIpE,MAAMuE,UAAY,OACtBH,EAAIpE,MAAMyE,WAAa,MACvBL,EAAIpE,MAAMC,MAAQ,SAItBiB,EAAawD,UAAYxD,EAAayD,aAElB,SAAhB7d,EAAQoG,KACRkX,EAAIrC,UAAJ,wCAAiDjb,EAAQud,OAAzD,6BAAoFvd,EAAQsd,IAA5F,YACuB,SAAhBtd,EAAQoG,KACfkX,EAAIrC,UAAJ,wCAAiDjb,EAAQud,OAAzD,iDAAwGvd,EAAQsd,IAAhH,cAEAA,EAAIrC,UAAJ,wCAAiDjb,EAAQud,OAAzD,yBAAgFvd,EAAQsd,IAAxF,aAGSxI,SAAS+H,eAAevE,GAChCwC,UAAUC,IAAI,UACnBhC,GAAOgC,IAAIzC,KAKb2D,GAAe,SAAUF,GAC3Bjc,QAAQpG,IAAI,iBACZ,IAAM0gB,EAAetF,SAASgE,cAAc,iBAC5ChZ,QAAQpG,IAAI,iBACZqiB,EAAKhjB,QAAQwC,SAAQ,SAAAue,GACjB,IAAMwD,EAAMxI,SAASE,cAAc,KACnClV,QAAQpG,IAAI,iBACZ0gB,EAAae,YAAYmC,GACzBxd,QAAQpG,IAAI,iBACRogB,EAAGyD,SAAWzO,GACdhP,QAAQpG,IAAI,kBACZogB,EAAGyD,OAAS,MACZD,EAAIpE,MAAM0B,MAAQ,MAClB0C,EAAIpE,MAAMsE,MAAQ,QAClBF,EAAIpE,MAAMuE,UAAY,QACtBH,EAAIpE,MAAMwE,YAAc,MACxBJ,EAAIpE,MAAMC,MAAQ,YAElBrZ,QAAQpG,IAAI,kBACZ4jB,EAAIpE,MAAM0B,MAAQ,MAClB0C,EAAIpE,MAAMsE,MAAQ,OAClBF,EAAIpE,MAAMuE,UAAY,OACtBH,EAAIpE,MAAMyE,WAAa,MACvBL,EAAIpE,MAAMC,MAAQ,SAEtBrZ,QAAQpG,IAAI,uBAAwBogB,EAAG1T,MACxB,SAAX0T,EAAG1T,KACHkX,EAAIrC,UAAJ,wCAAiDnB,EAAGyD,OAApD,6BAA+EzD,EAAGwD,IAAlF,YACkB,SAAXxD,EAAG1T,KACVkX,EAAIrC,UAAJ,wCAAiDnB,EAAGyD,OAApD,iDAAmGzD,EAAGwD,IAAtG,cAEAA,EAAIrC,UAAJ,wCAAiDnB,EAAGyD,OAApD,yBAA2EzD,EAAGwD,IAA9E,cAKRlD,EAAawD,UAAYxD,EAAayD,cAMpCjB,GAAW,WACb,IAAMxC,EAAetF,SAASgE,cAAc,iBAC3B7hB,MAAMQ,UAAUuO,MAAM/N,KAAKmiB,EAAaP,UAChDte,SAAQ,SAAAue,GAAE,OAAIA,EAAGC,aAIxBuB,GAAW,SAAUF,GAGvB,IAAM0C,EAAS,IAAIC,WACnBD,EAAOE,UAAY,WAGftF,GAAOC,KAAOmF,EAAOhf,QAGzBgB,QAAQpG,IAAIgf,GAAOC,MACnBmF,EAAOG,cAAc7C,I","file":"bundle.min.js","sourcesContent":["// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\n/** Error thrown when an HTTP request fails. */\r\nvar HttpError = /** @class */ (function (_super) {\r\n    __extends(HttpError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     * @param {number} statusCode The HTTP status code represented by this error.\r\n     */\r\n    function HttpError(errorMessage, statusCode) {\r\n        var _newTarget = this.constructor;\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        _this.statusCode = statusCode;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return HttpError;\r\n}(Error));\r\nexport { HttpError };\r\n/** Error thrown when a timeout elapses. */\r\nvar TimeoutError = /** @class */ (function (_super) {\r\n    __extends(TimeoutError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function TimeoutError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"A timeout occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return TimeoutError;\r\n}(Error));\r\nexport { TimeoutError };\r\n/** Error thrown when an action is aborted. */\r\nvar AbortError = /** @class */ (function (_super) {\r\n    __extends(AbortError, _super);\r\n    /** Constructs a new instance of {@link AbortError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function AbortError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"An abort occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return AbortError;\r\n}(Error));\r\nexport { AbortError };\r\n//# sourceMappingURL=Errors.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.\r\n/** Indicates the severity of a log message.\r\n *\r\n * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.\r\n */\r\nexport var LogLevel;\r\n(function (LogLevel) {\r\n    /** Log level for very low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Trace\"] = 0] = \"Trace\";\r\n    /** Log level for low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Debug\"] = 1] = \"Debug\";\r\n    /** Log level for informational diagnostic messages. */\r\n    LogLevel[LogLevel[\"Information\"] = 2] = \"Information\";\r\n    /** Log level for diagnostic messages that indicate a non-fatal problem. */\r\n    LogLevel[LogLevel[\"Warning\"] = 3] = \"Warning\";\r\n    /** Log level for diagnostic messages that indicate a failure in the current operation. */\r\n    LogLevel[LogLevel[\"Error\"] = 4] = \"Error\";\r\n    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */\r\n    LogLevel[LogLevel[\"Critical\"] = 5] = \"Critical\";\r\n    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */\r\n    LogLevel[LogLevel[\"None\"] = 6] = \"None\";\r\n})(LogLevel || (LogLevel = {}));\r\n//# sourceMappingURL=ILogger.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\n/** Represents an HTTP response. */\r\nvar HttpResponse = /** @class */ (function () {\r\n    function HttpResponse(statusCode, statusText, content) {\r\n        this.statusCode = statusCode;\r\n        this.statusText = statusText;\r\n        this.content = content;\r\n    }\r\n    return HttpResponse;\r\n}());\r\nexport { HttpResponse };\r\n/** Abstraction over an HTTP client.\r\n *\r\n * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.\r\n */\r\nvar HttpClient = /** @class */ (function () {\r\n    function HttpClient() {\r\n    }\r\n    HttpClient.prototype.get = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"GET\", url: url }));\r\n    };\r\n    HttpClient.prototype.post = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"POST\", url: url }));\r\n    };\r\n    HttpClient.prototype.delete = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"DELETE\", url: url }));\r\n    };\r\n    /** Gets all cookies that apply to the specified URL.\r\n     *\r\n     * @param url The URL that the cookies are valid for.\r\n     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.\r\n     */\r\n    // @ts-ignore\r\n    HttpClient.prototype.getCookieString = function (url) {\r\n        return \"\";\r\n    };\r\n    return HttpClient;\r\n}());\r\nexport { HttpClient };\r\n//# sourceMappingURL=HttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** A logger that does nothing when log messages are sent to it. */\r\nvar NullLogger = /** @class */ (function () {\r\n    function NullLogger() {\r\n    }\r\n    /** @inheritDoc */\r\n    // tslint:disable-next-line\r\n    NullLogger.prototype.log = function (_logLevel, _message) {\r\n    };\r\n    /** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */\r\n    NullLogger.instance = new NullLogger();\r\n    return NullLogger;\r\n}());\r\nexport { NullLogger };\r\n//# sourceMappingURL=Loggers.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\nexport var VERSION = \"5.0.7\";\r\n/** @private */\r\nvar Arg = /** @class */ (function () {\r\n    function Arg() {\r\n    }\r\n    Arg.isRequired = function (val, name) {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(\"The '\" + name + \"' argument is required.\");\r\n        }\r\n    };\r\n    Arg.isNotEmpty = function (val, name) {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(\"The '\" + name + \"' argument should not be empty.\");\r\n        }\r\n    };\r\n    Arg.isIn = function (val, values, name) {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(\"Unknown \" + name + \" value: \" + val + \".\");\r\n        }\r\n    };\r\n    return Arg;\r\n}());\r\nexport { Arg };\r\n/** @private */\r\nvar Platform = /** @class */ (function () {\r\n    function Platform() {\r\n    }\r\n    Object.defineProperty(Platform, \"isBrowser\", {\r\n        get: function () {\r\n            return typeof window === \"object\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isWebWorker\", {\r\n        get: function () {\r\n            return typeof self === \"object\" && \"importScripts\" in self;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isNode\", {\r\n        get: function () {\r\n            return !this.isBrowser && !this.isWebWorker;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Platform;\r\n}());\r\nexport { Platform };\r\n/** @private */\r\nexport function getDataDetail(data, includeContent) {\r\n    var detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = \"Binary data of length \" + data.byteLength;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + formatArrayBuffer(data) + \"'\";\r\n        }\r\n    }\r\n    else if (typeof data === \"string\") {\r\n        detail = \"String data of length \" + data.length;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + data + \"'\";\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n/** @private */\r\nexport function formatArrayBuffer(data) {\r\n    var view = new Uint8Array(data);\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    var str = \"\";\r\n    view.forEach(function (num) {\r\n        var pad = num < 16 ? \"0\" : \"\";\r\n        str += \"0x\" + pad + num.toString(16) + \" \";\r\n    });\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val) {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n/** @private */\r\nexport function sendMessage(logger, transportName, httpClient, url, accessTokenFactory, content, logMessageContent, withCredentials, defaultHeaders) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, headers, token, _b, name, value, responseType, response;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    headers = {};\r\n                    if (!accessTokenFactory) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, accessTokenFactory()];\r\n                case 1:\r\n                    token = _c.sent();\r\n                    if (token) {\r\n                        headers = (_a = {},\r\n                            _a[\"Authorization\"] = \"Bearer \" + token,\r\n                            _a);\r\n                    }\r\n                    _c.label = 2;\r\n                case 2:\r\n                    _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                    headers[name] = value;\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) sending data. \" + getDataDetail(content, logMessageContent) + \".\");\r\n                    responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n                    return [4 /*yield*/, httpClient.post(url, {\r\n                            content: content,\r\n                            headers: __assign({}, headers, defaultHeaders),\r\n                            responseType: responseType,\r\n                            withCredentials: withCredentials,\r\n                        })];\r\n                case 3:\r\n                    response = _c.sent();\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) request complete. Response status: \" + response.statusCode + \".\");\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** @private */\r\nexport function createLogger(logger) {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n    if (logger.log) {\r\n        return logger;\r\n    }\r\n    return new ConsoleLogger(logger);\r\n}\r\n/** @private */\r\nvar SubjectSubscription = /** @class */ (function () {\r\n    function SubjectSubscription(subject, observer) {\r\n        this.subject = subject;\r\n        this.observer = observer;\r\n    }\r\n    SubjectSubscription.prototype.dispose = function () {\r\n        var index = this.subject.observers.indexOf(this.observer);\r\n        if (index > -1) {\r\n            this.subject.observers.splice(index, 1);\r\n        }\r\n        if (this.subject.observers.length === 0 && this.subject.cancelCallback) {\r\n            this.subject.cancelCallback().catch(function (_) { });\r\n        }\r\n    };\r\n    return SubjectSubscription;\r\n}());\r\nexport { SubjectSubscription };\r\n/** @private */\r\nvar ConsoleLogger = /** @class */ (function () {\r\n    function ConsoleLogger(minimumLogLevel) {\r\n        this.minimumLogLevel = minimumLogLevel;\r\n        this.outputConsole = console;\r\n    }\r\n    ConsoleLogger.prototype.log = function (logLevel, message) {\r\n        if (logLevel >= this.minimumLogLevel) {\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.outputConsole.error(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.outputConsole.warn(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.outputConsole.info(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.outputConsole.log(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    return ConsoleLogger;\r\n}());\r\nexport { ConsoleLogger };\r\n/** @private */\r\nexport function getUserAgentHeader() {\r\n    var userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion())];\r\n}\r\n/** @private */\r\nexport function constructUserAgent(version, os, runtime, runtimeVersion) {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    var userAgent = \"Microsoft SignalR/\";\r\n    var majorAndMinor = version.split(\".\");\r\n    userAgent += majorAndMinor[0] + \".\" + majorAndMinor[1];\r\n    userAgent += \" (\" + version + \"; \";\r\n    if (os && os !== \"\") {\r\n        userAgent += os + \"; \";\r\n    }\r\n    else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n    userAgent += \"\" + runtime;\r\n    if (runtimeVersion) {\r\n        userAgent += \"; \" + runtimeVersion;\r\n    }\r\n    else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\nfunction getOsName() {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    }\r\n    else {\r\n        return \"\";\r\n    }\r\n}\r\nfunction getRuntimeVersion() {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\nfunction getRuntime() {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    }\r\n    else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n//# sourceMappingURL=Utils.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Platform } from \"./Utils\";\r\nvar FetchHttpClient = /** @class */ (function (_super) {\r\n    __extends(FetchHttpClient, _super);\r\n    function FetchHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        if (typeof fetch === \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests\r\n            _this.jar = new (requireFunc(\"tough-cookie\")).CookieJar();\r\n            _this.fetchType = requireFunc(\"node-fetch\");\r\n            // node-fetch doesn't have a nice API for getting and setting cookies\r\n            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one\r\n            _this.fetchType = requireFunc(\"fetch-cookie\")(_this.fetchType, _this.jar);\r\n            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide\r\n            _this.abortControllerType = requireFunc(\"abort-controller\");\r\n        }\r\n        else {\r\n            _this.fetchType = fetch.bind(self);\r\n            _this.abortControllerType = AbortController;\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    FetchHttpClient.prototype.send = function (request) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var abortController, error, timeoutId, msTimeout, response, e_1, content, payload;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Check that abort was not signaled before calling send\r\n                        if (request.abortSignal && request.abortSignal.aborted) {\r\n                            throw new AbortError();\r\n                        }\r\n                        if (!request.method) {\r\n                            throw new Error(\"No method defined.\");\r\n                        }\r\n                        if (!request.url) {\r\n                            throw new Error(\"No url defined.\");\r\n                        }\r\n                        abortController = new this.abortControllerType();\r\n                        // Hook our abortSignal into the abort controller\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = function () {\r\n                                abortController.abort();\r\n                                error = new AbortError();\r\n                            };\r\n                        }\r\n                        timeoutId = null;\r\n                        if (request.timeout) {\r\n                            msTimeout = request.timeout;\r\n                            timeoutId = setTimeout(function () {\r\n                                abortController.abort();\r\n                                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                                error = new TimeoutError();\r\n                            }, msTimeout);\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, 4, 5]);\r\n                        return [4 /*yield*/, this.fetchType(request.url, {\r\n                                body: request.content,\r\n                                cache: \"no-cache\",\r\n                                credentials: request.withCredentials === true ? \"include\" : \"same-origin\",\r\n                                headers: __assign({ \"Content-Type\": \"text/plain;charset=UTF-8\", \"X-Requested-With\": \"XMLHttpRequest\" }, request.headers),\r\n                                method: request.method,\r\n                                mode: \"cors\",\r\n                                redirect: \"manual\",\r\n                                signal: abortController.signal,\r\n                            })];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        if (error) {\r\n                            throw error;\r\n                        }\r\n                        this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + e_1 + \".\");\r\n                        throw e_1;\r\n                    case 4:\r\n                        if (timeoutId) {\r\n                            clearTimeout(timeoutId);\r\n                        }\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = null;\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 5:\r\n                        if (!response.ok) {\r\n                            throw new HttpError(response.statusText, response.status);\r\n                        }\r\n                        content = deserializeContent(response, request.responseType);\r\n                        return [4 /*yield*/, content];\r\n                    case 6:\r\n                        payload = _a.sent();\r\n                        return [2 /*return*/, new HttpResponse(response.status, response.statusText, payload)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    FetchHttpClient.prototype.getCookieString = function (url) {\r\n        var cookies = \"\";\r\n        if (Platform.isNode && this.jar) {\r\n            // @ts-ignore: unused variable\r\n            this.jar.getCookies(url, function (e, c) { return cookies = c.join(\"; \"); });\r\n        }\r\n        return cookies;\r\n    };\r\n    return FetchHttpClient;\r\n}(HttpClient));\r\nexport { FetchHttpClient };\r\nfunction deserializeContent(response, responseType) {\r\n    var content;\r\n    switch (responseType) {\r\n        case \"arraybuffer\":\r\n            content = response.arrayBuffer();\r\n            break;\r\n        case \"text\":\r\n            content = response.text();\r\n            break;\r\n        case \"blob\":\r\n        case \"document\":\r\n        case \"json\":\r\n            throw new Error(responseType + \" is not supported.\");\r\n        default:\r\n            content = response.text();\r\n            break;\r\n    }\r\n    return content;\r\n}\r\n//# sourceMappingURL=FetchHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** Defines the type of a Hub Message. */\r\nexport var MessageType;\r\n(function (MessageType) {\r\n    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */\r\n    MessageType[MessageType[\"Invocation\"] = 1] = \"Invocation\";\r\n    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */\r\n    MessageType[MessageType[\"StreamItem\"] = 2] = \"StreamItem\";\r\n    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */\r\n    MessageType[MessageType[\"Completion\"] = 3] = \"Completion\";\r\n    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */\r\n    MessageType[MessageType[\"StreamInvocation\"] = 4] = \"StreamInvocation\";\r\n    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */\r\n    MessageType[MessageType[\"CancelInvocation\"] = 5] = \"CancelInvocation\";\r\n    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */\r\n    MessageType[MessageType[\"Ping\"] = 6] = \"Ping\";\r\n    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */\r\n    MessageType[MessageType[\"Close\"] = 7] = \"Close\";\r\n})(MessageType || (MessageType = {}));\r\n//# sourceMappingURL=IHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nvar XhrHttpClient = /** @class */ (function (_super) {\r\n    __extends(XhrHttpClient, _super);\r\n    function XhrHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    XhrHttpClient.prototype.send = function (request) {\r\n        var _this = this;\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open(request.method, request.url, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            // Explicitly setting the Content-Type header for React Native on Android platform.\r\n            xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n            var headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach(function (header) {\r\n                    xhr.setRequestHeader(header, headers[header]);\r\n                });\r\n            }\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = function () {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n            xhr.onload = function () {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                }\r\n                else {\r\n                    reject(new HttpError(xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n            xhr.onerror = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + xhr.status + \": \" + xhr.statusText + \".\");\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n            xhr.ontimeout = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                reject(new TimeoutError());\r\n            };\r\n            xhr.send(request.content || \"\");\r\n        });\r\n    };\r\n    return XhrHttpClient;\r\n}(HttpClient));\r\nexport { XhrHttpClient };\r\n//# sourceMappingURL=XhrHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError } from \"./Errors\";\r\nimport { FetchHttpClient } from \"./FetchHttpClient\";\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { Platform } from \"./Utils\";\r\nimport { XhrHttpClient } from \"./XhrHttpClient\";\r\n/** Default implementation of {@link @microsoft/signalr.HttpClient}. */\r\nvar DefaultHttpClient = /** @class */ (function (_super) {\r\n    __extends(DefaultHttpClient, _super);\r\n    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */\r\n    function DefaultHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        if (typeof fetch !== \"undefined\" || Platform.isNode) {\r\n            _this.httpClient = new FetchHttpClient(logger);\r\n        }\r\n        else if (typeof XMLHttpRequest !== \"undefined\") {\r\n            _this.httpClient = new XhrHttpClient(logger);\r\n        }\r\n        else {\r\n            throw new Error(\"No usable HttpClient found.\");\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    DefaultHttpClient.prototype.send = function (request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return this.httpClient.send(request);\r\n    };\r\n    DefaultHttpClient.prototype.getCookieString = function (url) {\r\n        return this.httpClient.getCookieString(url);\r\n    };\r\n    return DefaultHttpClient;\r\n}(HttpClient));\r\nexport { DefaultHttpClient };\r\n//# sourceMappingURL=DefaultHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Not exported from index\r\n/** @private */\r\nvar TextMessageFormat = /** @class */ (function () {\r\n    function TextMessageFormat() {\r\n    }\r\n    TextMessageFormat.write = function (output) {\r\n        return \"\" + output + TextMessageFormat.RecordSeparator;\r\n    };\r\n    TextMessageFormat.parse = function (input) {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error(\"Message is incomplete.\");\r\n        }\r\n        var messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    };\r\n    TextMessageFormat.RecordSeparatorCode = 0x1e;\r\n    TextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n    return TextMessageFormat;\r\n}());\r\nexport { TextMessageFormat };\r\n//# sourceMappingURL=TextMessageFormat.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nvar HandshakeProtocol = /** @class */ (function () {\r\n    function HandshakeProtocol() {\r\n    }\r\n    // Handshake request is always JSON\r\n    HandshakeProtocol.prototype.writeHandshakeRequest = function (handshakeRequest) {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    };\r\n    HandshakeProtocol.prototype.parseHandshakeResponse = function (data) {\r\n        var responseMessage;\r\n        var messageData;\r\n        var remainingData;\r\n        if (isArrayBuffer(data) || (typeof Buffer !== \"undefined\" && data instanceof Buffer)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            var binaryData = new Uint8Array(data);\r\n            var separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, binaryData.slice(0, responseLength));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        }\r\n        else {\r\n            var textData = data;\r\n            var separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n        // At this point we should have just the single handshake message\r\n        var messages = TextMessageFormat.parse(messageData);\r\n        var response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        responseMessage = response;\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    };\r\n    return HandshakeProtocol;\r\n}());\r\nexport { HandshakeProtocol };\r\n//# sourceMappingURL=HandshakeProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { SubjectSubscription } from \"./Utils\";\r\n/** Stream implementation to stream items to the server. */\r\nvar Subject = /** @class */ (function () {\r\n    function Subject() {\r\n        this.observers = [];\r\n    }\r\n    Subject.prototype.next = function (item) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            observer.next(item);\r\n        }\r\n    };\r\n    Subject.prototype.error = function (err) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.complete = function () {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.subscribe = function (observer) {\r\n        this.observers.push(observer);\r\n        return new SubjectSubscription(this, observer);\r\n    };\r\n    return Subject;\r\n}());\r\nexport { Subject };\r\n//# sourceMappingURL=Subject.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { HandshakeProtocol } from \"./HandshakeProtocol\";\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Subject } from \"./Subject\";\r\nimport { Arg } from \"./Utils\";\r\nvar DEFAULT_TIMEOUT_IN_MS = 30 * 1000;\r\nvar DEFAULT_PING_INTERVAL_IN_MS = 15 * 1000;\r\n/** Describes the current state of the {@link HubConnection} to the server. */\r\nexport var HubConnectionState;\r\n(function (HubConnectionState) {\r\n    /** The hub connection is disconnected. */\r\n    HubConnectionState[\"Disconnected\"] = \"Disconnected\";\r\n    /** The hub connection is connecting. */\r\n    HubConnectionState[\"Connecting\"] = \"Connecting\";\r\n    /** The hub connection is connected. */\r\n    HubConnectionState[\"Connected\"] = \"Connected\";\r\n    /** The hub connection is disconnecting. */\r\n    HubConnectionState[\"Disconnecting\"] = \"Disconnecting\";\r\n    /** The hub connection is reconnecting. */\r\n    HubConnectionState[\"Reconnecting\"] = \"Reconnecting\";\r\n})(HubConnectionState || (HubConnectionState = {}));\r\n/** Represents a connection to a SignalR Hub. */\r\nvar HubConnection = /** @class */ (function () {\r\n    function HubConnection(connection, logger, protocol, reconnectPolicy) {\r\n        var _this = this;\r\n        this.nextKeepAlive = 0;\r\n        Arg.isRequired(connection, \"connection\");\r\n        Arg.isRequired(logger, \"logger\");\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.serverTimeoutInMilliseconds = DEFAULT_TIMEOUT_IN_MS;\r\n        this.keepAliveIntervalInMilliseconds = DEFAULT_PING_INTERVAL_IN_MS;\r\n        this.logger = logger;\r\n        this.protocol = protocol;\r\n        this.connection = connection;\r\n        this.reconnectPolicy = reconnectPolicy;\r\n        this.handshakeProtocol = new HandshakeProtocol();\r\n        this.connection.onreceive = function (data) { return _this.processIncomingData(data); };\r\n        this.connection.onclose = function (error) { return _this.connectionClosed(error); };\r\n        this.callbacks = {};\r\n        this.methods = {};\r\n        this.closedCallbacks = [];\r\n        this.reconnectingCallbacks = [];\r\n        this.reconnectedCallbacks = [];\r\n        this.invocationId = 0;\r\n        this.receivedHandshakeResponse = false;\r\n        this.connectionState = HubConnectionState.Disconnected;\r\n        this.connectionStarted = false;\r\n        this.cachedPingMessage = this.protocol.writeMessage({ type: MessageType.Ping });\r\n    }\r\n    /** @internal */\r\n    // Using a public static factory method means we can have a private constructor and an _internal_\r\n    // create method that can be used by HubConnectionBuilder. An \"internal\" constructor would just\r\n    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a\r\n    // public parameter-less constructor.\r\n    HubConnection.create = function (connection, logger, protocol, reconnectPolicy) {\r\n        return new HubConnection(connection, logger, protocol, reconnectPolicy);\r\n    };\r\n    Object.defineProperty(HubConnection.prototype, \"state\", {\r\n        /** Indicates the state of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connectionState;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"connectionId\", {\r\n        /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either\r\n         *  in the disconnected state or if the negotiation step was skipped.\r\n         */\r\n        get: function () {\r\n            return this.connection ? (this.connection.connectionId || null) : null;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"baseUrl\", {\r\n        /** Indicates the url of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connection.baseUrl || \"\";\r\n        },\r\n        /**\r\n         * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or\r\n         * Reconnecting states.\r\n         * @param {string} url The url to connect to.\r\n         */\r\n        set: function (url) {\r\n            if (this.connectionState !== HubConnectionState.Disconnected && this.connectionState !== HubConnectionState.Reconnecting) {\r\n                throw new Error(\"The HubConnection must be in the Disconnected or Reconnecting state to change the url.\");\r\n            }\r\n            if (!url) {\r\n                throw new Error(\"The HubConnection url must be a valid url.\");\r\n            }\r\n            this.connection.baseUrl = url;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** Starts the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.start = function () {\r\n        this.startPromise = this.startWithStateTransitions();\r\n        return this.startPromise;\r\n    };\r\n    HubConnection.prototype.startWithStateTransitions = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState !== HubConnectionState.Disconnected) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start a HubConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Connecting;\r\n                        this.logger.log(LogLevel.Debug, \"Starting HubConnection.\");\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.connectionStarted = true;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection connected successfully.\");\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        this.connectionState = HubConnectionState.Disconnected;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection failed to start successfully because of error '\" + e_1 + \"'.\");\r\n                        return [2 /*return*/, Promise.reject(e_1)];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.startInternal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var handshakePromise, handshakeRequest, e_2;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.stopDuringStartError = undefined;\r\n                        this.receivedHandshakeResponse = false;\r\n                        handshakePromise = new Promise(function (resolve, reject) {\r\n                            _this.handshakeResolver = resolve;\r\n                            _this.handshakeRejecter = reject;\r\n                        });\r\n                        return [4 /*yield*/, this.connection.start(this.protocol.transferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 7]);\r\n                        handshakeRequest = {\r\n                            protocol: this.protocol.name,\r\n                            version: this.protocol.version,\r\n                        };\r\n                        this.logger.log(LogLevel.Debug, \"Sending handshake request.\");\r\n                        return [4 /*yield*/, this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(handshakeRequest))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Using HubProtocol '\" + this.protocol.name + \"'.\");\r\n                        // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n                        this.cleanupTimeout();\r\n                        this.resetTimeoutPeriod();\r\n                        this.resetKeepAliveInterval();\r\n                        return [4 /*yield*/, handshakePromise];\r\n                    case 4:\r\n                        _a.sent();\r\n                        // It's important to check the stopDuringStartError instead of just relying on the handshakePromise\r\n                        // being rejected on close, because this continuation can run after both the handshake completed successfully\r\n                        // and the connection was closed.\r\n                        if (this.stopDuringStartError) {\r\n                            // It's important to throw instead of returning a rejected promise, because we don't want to allow any state\r\n                            // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise\r\n                            // will cause the calling continuation to get scheduled to run later.\r\n                            throw this.stopDuringStartError;\r\n                        }\r\n                        return [3 /*break*/, 7];\r\n                    case 5:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Debug, \"Hub handshake failed with error '\" + e_2 + \"' during start(). Stopping HubConnection.\");\r\n                        this.cleanupTimeout();\r\n                        this.cleanupPingTimer();\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        return [4 /*yield*/, this.connection.stop(e_2)];\r\n                    case 6:\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        _a.sent();\r\n                        throw e_2;\r\n                    case 7: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /** Stops the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var startPromise, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        startPromise = this.startPromise;\r\n                        this.stopPromise = this.stopInternal();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        // Awaiting undefined continues immediately\r\n                        return [4 /*yield*/, startPromise];\r\n                    case 3:\r\n                        // Awaiting undefined continues immediately\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        e_3 = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.stopInternal = function (error) {\r\n        if (this.connectionState === HubConnectionState.Disconnected) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HubConnection.stop(\" + error + \") ignored because it is already in the disconnected state.\");\r\n            return Promise.resolve();\r\n        }\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n            return this.stopPromise;\r\n        }\r\n        this.connectionState = HubConnectionState.Disconnecting;\r\n        this.logger.log(LogLevel.Debug, \"Stopping HubConnection.\");\r\n        if (this.reconnectDelayHandle) {\r\n            // We're in a reconnect delay which means the underlying connection is currently already stopped.\r\n            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and\r\n            // fire the onclose callbacks.\r\n            this.logger.log(LogLevel.Debug, \"Connection stopped during reconnect delay. Done reconnecting.\");\r\n            clearTimeout(this.reconnectDelayHandle);\r\n            this.reconnectDelayHandle = undefined;\r\n            this.completeClose();\r\n            return Promise.resolve();\r\n        }\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        this.stopDuringStartError = error || new Error(\"The connection was stopped before the hub handshake could complete.\");\r\n        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails\r\n        // or the onclose callback is invoked. The onclose callback will transition the HubConnection\r\n        // to the disconnected state if need be before HttpConnection.stop() completes.\r\n        return this.connection.stop(error);\r\n    };\r\n    /** Invokes a streaming hub method on the server using the specified name and arguments.\r\n     *\r\n     * @typeparam T The type of the items returned by the server.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.\r\n     */\r\n    HubConnection.prototype.stream = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createStreamInvocation(methodName, args, streamIds);\r\n        var promiseQueue;\r\n        var subject = new Subject();\r\n        subject.cancelCallback = function () {\r\n            var cancelInvocation = _this.createCancelInvocation(invocationDescriptor.invocationId);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n            return promiseQueue.then(function () {\r\n                return _this.sendWithProtocol(cancelInvocation);\r\n            });\r\n        };\r\n        this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            }\r\n            else if (invocationEvent) {\r\n                // invocationEvent will not be null when an error is not passed to the callback\r\n                if (invocationEvent.type === MessageType.Completion) {\r\n                    if (invocationEvent.error) {\r\n                        subject.error(new Error(invocationEvent.error));\r\n                    }\r\n                    else {\r\n                        subject.complete();\r\n                    }\r\n                }\r\n                else {\r\n                    subject.next((invocationEvent.item));\r\n                }\r\n            }\r\n        };\r\n        promiseQueue = this.sendWithProtocol(invocationDescriptor)\r\n            .catch(function (e) {\r\n            subject.error(e);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n        });\r\n        this.launchStreams(streams, promiseQueue);\r\n        return subject;\r\n    };\r\n    HubConnection.prototype.sendMessage = function (message) {\r\n        this.resetKeepAliveInterval();\r\n        return this.connection.send(message);\r\n    };\r\n    /**\r\n     * Sends a js object to the server.\r\n     * @param message The js object to serialize and send.\r\n     */\r\n    HubConnection.prototype.sendWithProtocol = function (message) {\r\n        return this.sendMessage(this.protocol.writeMessage(message));\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.\r\n     *\r\n     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still\r\n     * be processing the invocation.\r\n     *\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.send = function (methodName) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var sendPromise = this.sendWithProtocol(this.createInvocation(methodName, args, true, streamIds));\r\n        this.launchStreams(streams, sendPromise);\r\n        return sendPromise;\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments.\r\n     *\r\n     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise\r\n     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of\r\n     * resolving the Promise.\r\n     *\r\n     * @typeparam T The expected return type.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.\r\n     */\r\n    HubConnection.prototype.invoke = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createInvocation(methodName, args, false, streamIds);\r\n        var p = new Promise(function (resolve, reject) {\r\n            // invocationId will always have a value for a non-blocking invocation\r\n            _this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n                else if (invocationEvent) {\r\n                    // invocationEvent will not be null when an error is not passed to the callback\r\n                    if (invocationEvent.type === MessageType.Completion) {\r\n                        if (invocationEvent.error) {\r\n                            reject(new Error(invocationEvent.error));\r\n                        }\r\n                        else {\r\n                            resolve(invocationEvent.result);\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(new Error(\"Unexpected message type: \" + invocationEvent.type));\r\n                    }\r\n                }\r\n            };\r\n            var promiseQueue = _this.sendWithProtocol(invocationDescriptor)\r\n                .catch(function (e) {\r\n                reject(e);\r\n                // invocationId will always have a value for a non-blocking invocation\r\n                delete _this.callbacks[invocationDescriptor.invocationId];\r\n            });\r\n            _this.launchStreams(streams, promiseQueue);\r\n        });\r\n        return p;\r\n    };\r\n    /** Registers a handler that will be invoked when the hub method with the specified method name is invoked.\r\n     *\r\n     * @param {string} methodName The name of the hub method to define.\r\n     * @param {Function} newMethod The handler that will be raised when the hub method is invoked.\r\n     */\r\n    HubConnection.prototype.on = function (methodName, newMethod) {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        if (!this.methods[methodName]) {\r\n            this.methods[methodName] = [];\r\n        }\r\n        // Preventing adding the same handler multiple times.\r\n        if (this.methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n        this.methods[methodName].push(newMethod);\r\n    };\r\n    HubConnection.prototype.off = function (methodName, method) {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        var handlers = this.methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            var removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this.methods[methodName];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            delete this.methods[methodName];\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection is closed.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).\r\n     */\r\n    HubConnection.prototype.onclose = function (callback) {\r\n        if (callback) {\r\n            this.closedCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection starts reconnecting.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).\r\n     */\r\n    HubConnection.prototype.onreconnecting = function (callback) {\r\n        if (callback) {\r\n            this.reconnectingCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection successfully reconnects.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.\r\n     */\r\n    HubConnection.prototype.onreconnected = function (callback) {\r\n        if (callback) {\r\n            this.reconnectedCallbacks.push(callback);\r\n        }\r\n    };\r\n    HubConnection.prototype.processIncomingData = function (data) {\r\n        this.cleanupTimeout();\r\n        if (!this.receivedHandshakeResponse) {\r\n            data = this.processHandshakeResponse(data);\r\n            this.receivedHandshakeResponse = true;\r\n        }\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            var messages = this.protocol.parseMessages(data, this.logger);\r\n            for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n                var message = messages_1[_i];\r\n                switch (message.type) {\r\n                    case MessageType.Invocation:\r\n                        this.invokeClientMethod(message);\r\n                        break;\r\n                    case MessageType.StreamItem:\r\n                    case MessageType.Completion:\r\n                        var callback = this.callbacks[message.invocationId];\r\n                        if (callback) {\r\n                            if (message.type === MessageType.Completion) {\r\n                                delete this.callbacks[message.invocationId];\r\n                            }\r\n                            callback(message);\r\n                        }\r\n                        break;\r\n                    case MessageType.Ping:\r\n                        // Don't care about pings\r\n                        break;\r\n                    case MessageType.Close:\r\n                        this.logger.log(LogLevel.Information, \"Close message received from server.\");\r\n                        var error = message.error ? new Error(\"Server returned an error on close: \" + message.error) : undefined;\r\n                        if (message.allowReconnect === true) {\r\n                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,\r\n                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.\r\n                            // tslint:disable-next-line:no-floating-promises\r\n                            this.connection.stop(error);\r\n                        }\r\n                        else {\r\n                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.\r\n                            this.stopPromise = this.stopInternal(error);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        this.logger.log(LogLevel.Warning, \"Invalid message type: \" + message.type + \".\");\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this.resetTimeoutPeriod();\r\n    };\r\n    HubConnection.prototype.processHandshakeResponse = function (data) {\r\n        var _a;\r\n        var responseMessage;\r\n        var remainingData;\r\n        try {\r\n            _a = this.handshakeProtocol.parseHandshakeResponse(data), remainingData = _a[0], responseMessage = _a[1];\r\n        }\r\n        catch (e) {\r\n            var message = \"Error parsing handshake response: \" + e;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            var message = \"Server returned handshake error: \" + responseMessage.error;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Debug, \"Server handshake complete.\");\r\n        }\r\n        this.handshakeResolver();\r\n        return remainingData;\r\n    };\r\n    HubConnection.prototype.resetKeepAliveInterval = function () {\r\n        if (this.connection.features.inherentKeepAlive) {\r\n            return;\r\n        }\r\n        // Set the time we want the next keep alive to be sent\r\n        // Timer will be setup on next message receive\r\n        this.nextKeepAlive = new Date().getTime() + this.keepAliveIntervalInMilliseconds;\r\n        this.cleanupPingTimer();\r\n    };\r\n    HubConnection.prototype.resetTimeoutPeriod = function () {\r\n        var _this = this;\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this.timeoutHandle = setTimeout(function () { return _this.serverTimeout(); }, this.serverTimeoutInMilliseconds);\r\n            // Set keepAlive timer if there isn't one\r\n            if (this.pingServerHandle === undefined) {\r\n                var nextPing = this.nextKeepAlive - new Date().getTime();\r\n                if (nextPing < 0) {\r\n                    nextPing = 0;\r\n                }\r\n                // The timer needs to be set from a networking callback to avoid Chrome timer throttling from causing timers to run once a minute\r\n                this.pingServerHandle = setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                    var _a;\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (!(this.connectionState === HubConnectionState.Connected)) return [3 /*break*/, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4 /*yield*/, this.sendMessage(this.cachedPingMessage)];\r\n                            case 2:\r\n                                _b.sent();\r\n                                return [3 /*break*/, 4];\r\n                            case 3:\r\n                                _a = _b.sent();\r\n                                // We don't care about the error. It should be seen elsewhere in the client.\r\n                                // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering\r\n                                this.cleanupPingTimer();\r\n                                return [3 /*break*/, 4];\r\n                            case 4: return [2 /*return*/];\r\n                        }\r\n                    });\r\n                }); }, nextPing);\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.serverTimeout = function () {\r\n        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(\r\n        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.\r\n        // tslint:disable-next-line:no-floating-promises\r\n        this.connection.stop(new Error(\"Server timeout elapsed without receiving a message from the server.\"));\r\n    };\r\n    HubConnection.prototype.invokeClientMethod = function (invocationMessage) {\r\n        var _this = this;\r\n        var methods = this.methods[invocationMessage.target.toLowerCase()];\r\n        if (methods) {\r\n            try {\r\n                methods.forEach(function (m) { return m.apply(_this, invocationMessage.arguments); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"A callback for the method \" + invocationMessage.target.toLowerCase() + \" threw error '\" + e + \"'.\");\r\n            }\r\n            if (invocationMessage.invocationId) {\r\n                // This is not supported in v1. So we return an error to avoid blocking the server waiting for the response.\r\n                var message = \"Server requested a response, which is not supported in this version of the client.\";\r\n                this.logger.log(LogLevel.Error, message);\r\n                // We don't want to wait on the stop itself.\r\n                this.stopPromise = this.stopInternal(new Error(message));\r\n            }\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Warning, \"No client method with the name '\" + invocationMessage.target + \"' found.\");\r\n        }\r\n    };\r\n    HubConnection.prototype.connectionClosed = function (error) {\r\n        this.logger.log(LogLevel.Debug, \"HubConnection.connectionClosed(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.\r\n        this.stopDuringStartError = this.stopDuringStartError || error || new Error(\"The underlying connection was closed before the hub handshake could complete.\");\r\n        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.\r\n        // If it has already completed, this should just noop.\r\n        if (this.handshakeResolver) {\r\n            this.handshakeResolver();\r\n        }\r\n        this.cancelCallbacksWithError(error || new Error(\"Invocation canceled due to the underlying connection being closed.\"));\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.completeClose(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected && this.reconnectPolicy) {\r\n            // tslint:disable-next-line:no-floating-promises\r\n            this.reconnect(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected) {\r\n            this.completeClose(error);\r\n        }\r\n        // If none of the above if conditions were true were called the HubConnection must be in either:\r\n        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.\r\n        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt\r\n        //    and potentially continue the reconnect() loop.\r\n        // 3. The Disconnected state in which case we're already done.\r\n    };\r\n    HubConnection.prototype.completeClose = function (error) {\r\n        var _this = this;\r\n        if (this.connectionStarted) {\r\n            this.connectionState = HubConnectionState.Disconnected;\r\n            this.connectionStarted = false;\r\n            try {\r\n                this.closedCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"An onclose callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.reconnect = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var reconnectStartTime, previousReconnectAttempts, retryError, nextRetryDelay, e_4;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        reconnectStartTime = Date.now();\r\n                        previousReconnectAttempts = 0;\r\n                        retryError = error !== undefined ? error : new Error(\"Attempting to reconnect due to a unknown error.\");\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, 0, retryError);\r\n                        if (nextRetryDelay === null) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.\");\r\n                            this.completeClose(error);\r\n                            return [2 /*return*/];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Reconnecting;\r\n                        if (error) {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting because of error '\" + error + \"'.\");\r\n                        }\r\n                        else {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting.\");\r\n                        }\r\n                        if (this.onreconnecting) {\r\n                            try {\r\n                                this.reconnectingCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnecting callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n                            }\r\n                            // Exit early if an onreconnecting callback called connection.stop().\r\n                            if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                                this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.\");\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(nextRetryDelay !== null)) return [3 /*break*/, 7];\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt number \" + previousReconnectAttempts + \" will start in \" + nextRetryDelay + \" ms.\");\r\n                        return [4 /*yield*/, new Promise(function (resolve) {\r\n                                _this.reconnectDelayHandle = setTimeout(resolve, nextRetryDelay);\r\n                            })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.reconnectDelayHandle = undefined;\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state during reconnect delay. Done reconnecting.\");\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.logger.log(LogLevel.Information, \"HubConnection reconnected successfully.\");\r\n                        if (this.onreconnected) {\r\n                            try {\r\n                                this.reconnectedCallbacks.forEach(function (c) { return c.apply(_this, [_this.connection.connectionId]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnected callback called with connectionId '\" + this.connection.connectionId + \"; threw error '\" + e + \"'.\");\r\n                            }\r\n                        }\r\n                        return [2 /*return*/];\r\n                    case 5:\r\n                        e_4 = _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt failed because of error '\" + e_4 + \"'.\");\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection moved to the '\" + this.connectionState + \"' from the reconnecting state during reconnect attempt. Done reconnecting.\");\r\n                            // The TypeScript compiler thinks that connectionState must be Connected here. The TypeScript compiler is wrong.\r\n                            if (this.connectionState === HubConnectionState.Disconnecting) {\r\n                                this.completeClose();\r\n                            }\r\n                            return [2 /*return*/];\r\n                        }\r\n                        retryError = e_4 instanceof Error ? e_4 : new Error(e_4.toString());\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7:\r\n                        this.logger.log(LogLevel.Information, \"Reconnect retries have been exhausted after \" + (Date.now() - reconnectStartTime) + \" ms and \" + previousReconnectAttempts + \" failed attempts. Connection disconnecting.\");\r\n                        this.completeClose();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.getNextRetryDelay = function (previousRetryCount, elapsedMilliseconds, retryReason) {\r\n        try {\r\n            return this.reconnectPolicy.nextRetryDelayInMilliseconds({\r\n                elapsedMilliseconds: elapsedMilliseconds,\r\n                previousRetryCount: previousRetryCount,\r\n                retryReason: retryReason,\r\n            });\r\n        }\r\n        catch (e) {\r\n            this.logger.log(LogLevel.Error, \"IRetryPolicy.nextRetryDelayInMilliseconds(\" + previousRetryCount + \", \" + elapsedMilliseconds + \") threw error '\" + e + \"'.\");\r\n            return null;\r\n        }\r\n    };\r\n    HubConnection.prototype.cancelCallbacksWithError = function (error) {\r\n        var callbacks = this.callbacks;\r\n        this.callbacks = {};\r\n        Object.keys(callbacks)\r\n            .forEach(function (key) {\r\n            var callback = callbacks[key];\r\n            callback(null, error);\r\n        });\r\n    };\r\n    HubConnection.prototype.cleanupPingTimer = function () {\r\n        if (this.pingServerHandle) {\r\n            clearTimeout(this.pingServerHandle);\r\n            this.pingServerHandle = undefined;\r\n        }\r\n    };\r\n    HubConnection.prototype.cleanupTimeout = function () {\r\n        if (this.timeoutHandle) {\r\n            clearTimeout(this.timeoutHandle);\r\n        }\r\n    };\r\n    HubConnection.prototype.createInvocation = function (methodName, args, nonblocking, streamIds) {\r\n        if (nonblocking) {\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            var invocationId = this.invocationId;\r\n            this.invocationId++;\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.launchStreams = function (streams, promiseQueue) {\r\n        var _this = this;\r\n        if (streams.length === 0) {\r\n            return;\r\n        }\r\n        // Synchronize stream data so they arrive in-order on the server\r\n        if (!promiseQueue) {\r\n            promiseQueue = Promise.resolve();\r\n        }\r\n        var _loop_1 = function (streamId) {\r\n            streams[streamId].subscribe({\r\n                complete: function () {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId)); });\r\n                },\r\n                error: function (err) {\r\n                    var message;\r\n                    if (err instanceof Error) {\r\n                        message = err.message;\r\n                    }\r\n                    else if (err && err.toString) {\r\n                        message = err.toString();\r\n                    }\r\n                    else {\r\n                        message = \"Unknown error\";\r\n                    }\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId, message)); });\r\n                },\r\n                next: function (item) {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createStreamItemMessage(streamId, item)); });\r\n                },\r\n            });\r\n        };\r\n        // We want to iterate over the keys, since the keys are the stream ids\r\n        // tslint:disable-next-line:forin\r\n        for (var streamId in streams) {\r\n            _loop_1(streamId);\r\n        }\r\n    };\r\n    HubConnection.prototype.replaceStreamingParams = function (args) {\r\n        var streams = [];\r\n        var streamIds = [];\r\n        for (var i = 0; i < args.length; i++) {\r\n            var argument = args[i];\r\n            if (this.isObservable(argument)) {\r\n                var streamId = this.invocationId;\r\n                this.invocationId++;\r\n                // Store the stream for later use\r\n                streams[streamId] = argument;\r\n                streamIds.push(streamId.toString());\r\n                // remove stream from args\r\n                args.splice(i, 1);\r\n            }\r\n        }\r\n        return [streams, streamIds];\r\n    };\r\n    HubConnection.prototype.isObservable = function (arg) {\r\n        // This allows other stream implementations to just work (like rxjs)\r\n        return arg && arg.subscribe && typeof arg.subscribe === \"function\";\r\n    };\r\n    HubConnection.prototype.createStreamInvocation = function (methodName, args, streamIds) {\r\n        var invocationId = this.invocationId;\r\n        this.invocationId++;\r\n        if (streamIds.length !== 0) {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                streamIds: streamIds,\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n    };\r\n    HubConnection.prototype.createCancelInvocation = function (id) {\r\n        return {\r\n            invocationId: id,\r\n            type: MessageType.CancelInvocation,\r\n        };\r\n    };\r\n    HubConnection.prototype.createStreamItemMessage = function (id, item) {\r\n        return {\r\n            invocationId: id,\r\n            item: item,\r\n            type: MessageType.StreamItem,\r\n        };\r\n    };\r\n    HubConnection.prototype.createCompletionMessage = function (id, error, result) {\r\n        if (error) {\r\n            return {\r\n                error: error,\r\n                invocationId: id,\r\n                type: MessageType.Completion,\r\n            };\r\n        }\r\n        return {\r\n            invocationId: id,\r\n            result: result,\r\n            type: MessageType.Completion,\r\n        };\r\n    };\r\n    return HubConnection;\r\n}());\r\nexport { HubConnection };\r\n//# sourceMappingURL=HubConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// This will be treated as a bit flag in the future, so we keep it using power-of-two values.\r\n/** Specifies a specific HTTP transport type. */\r\nexport var HttpTransportType;\r\n(function (HttpTransportType) {\r\n    /** Specifies no transport preference. */\r\n    HttpTransportType[HttpTransportType[\"None\"] = 0] = \"None\";\r\n    /** Specifies the WebSockets transport. */\r\n    HttpTransportType[HttpTransportType[\"WebSockets\"] = 1] = \"WebSockets\";\r\n    /** Specifies the Server-Sent Events transport. */\r\n    HttpTransportType[HttpTransportType[\"ServerSentEvents\"] = 2] = \"ServerSentEvents\";\r\n    /** Specifies the Long Polling transport. */\r\n    HttpTransportType[HttpTransportType[\"LongPolling\"] = 4] = \"LongPolling\";\r\n})(HttpTransportType || (HttpTransportType = {}));\r\n/** Specifies the transfer format for a connection. */\r\nexport var TransferFormat;\r\n(function (TransferFormat) {\r\n    /** Specifies that only text data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Text\"] = 1] = \"Text\";\r\n    /** Specifies that binary data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Binary\"] = 2] = \"Binary\";\r\n})(TransferFormat || (TransferFormat = {}));\r\n//# sourceMappingURL=ITransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// 0, 2, 10, 30 second delays before reconnect attempts.\r\nvar DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];\r\n/** @private */\r\nvar DefaultReconnectPolicy = /** @class */ (function () {\r\n    function DefaultReconnectPolicy(retryDelays) {\r\n        this.retryDelays = retryDelays !== undefined ? retryDelays.concat([null]) : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;\r\n    }\r\n    DefaultReconnectPolicy.prototype.nextRetryDelayInMilliseconds = function (retryContext) {\r\n        return this.retryDelays[retryContext.previousRetryCount];\r\n    };\r\n    return DefaultReconnectPolicy;\r\n}());\r\nexport { DefaultReconnectPolicy };\r\n//# sourceMappingURL=DefaultReconnectPolicy.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don't actually ever use the API being polyfilled, we always use the polyfill because\r\n// it's a very new API right now.\r\n// Not exported from index.\r\n/** @private */\r\nvar AbortController = /** @class */ (function () {\r\n    function AbortController() {\r\n        this.isAborted = false;\r\n        this.onabort = null;\r\n    }\r\n    AbortController.prototype.abort = function () {\r\n        if (!this.isAborted) {\r\n            this.isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    };\r\n    Object.defineProperty(AbortController.prototype, \"signal\", {\r\n        get: function () {\r\n            return this;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbortController.prototype, \"aborted\", {\r\n        get: function () {\r\n            return this.isAborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return AbortController;\r\n}());\r\nexport { AbortController };\r\n//# sourceMappingURL=AbortController.js.map","\r\nimport * as signalR from \"@microsoft/signalr\";\r\nimport { serverConn } from \"./serverConn.js\";\r\n\r\n\r\nlet username;\r\nconst server = new serverConn();\r\n\r\nconst base64 = { byte: \"\", type: \"\" };\r\nconst selected = { item: \"none\", type: \"none\" };\r\nlet activeUsers;\r\nconst loginBtn = document.querySelector(\".loginBtn\");\r\n\r\nconst unseen = new Set();\r\n//zbior konwersacji\r\nconst messages = new Set();\r\n//konwersacja \r\nclass conversation {\r\n\r\n    constructor(groupname, type) {\r\n        this.groupName = groupname;\r\n        this.type = type;\r\n        this.content = new Set();\r\n    }\r\n    addMessage(message) {\r\n        this.content.add(message);\r\n    }\r\n}\r\n//wiadomosc\r\nclass message {\r\n    constructor(sender, time, message) {\r\n        this.sender = sender;\r\n        this.time = time;\r\n        this.message = message;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n//var connection = server.getConnection();\r\n\r\n\r\n// wyłączenie przycisku do momentu połączenia \r\nloginBtn.disabled = true;\r\n\r\n//nawiązywanie połączenia \r\nserver.start(() => {\r\n    loginBtn.disabled = false;\r\n    console.log(\"Działam z obiektu\");\r\n    loginBtn.style.color = \"white\";\r\n    loginBtn.value = \"Start\";\r\n}, (err) => {\r\n    loginBtn.style.color = \"red\";\r\n    loginBtn.value = \"Conn.ERROR\";\r\n    return console.error(err.toString());\r\n});\r\n\r\n\r\n\r\nloginBtn.addEventListener(\"click\", (event) => {\r\n\r\n    username = document.querySelector(\".userNameInput\").value;\r\n    server.login(username, document.querySelector(\".passwordInput\").value);\r\n    event.preventDefault();\r\n});\r\n\r\n// klawisz enter aktywuje przycisk Start\r\ndocument.querySelector(\".userNameInput\").addEventListener(\"keyup\", (event) => {\r\n\r\n    if (event.key === 'Enter') {\r\n        event.preventDefault();\r\n        loginBtn.click();\r\n    }\r\n})\r\n\r\n//nasłuchowanie statusu\r\nserver.onLoginStatus(function() {\r\n    prepareWindow();\r\n    server.getUsers();\r\n    server.getGroupsByUser(username);\r\n}, () => {\r\n    loginBtn.style.color = \"red\";\r\n    loginBtn.value = \"ERROR\";\r\n    document.querySelector(\".passwordInput\").addEventListener(\"input\", () => {\r\n        loginBtn.style.color = \"white\";\r\n        loginBtn.value = \"LOGIN\";\r\n    });\r\n})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// tworzenie okna po zalogowaniu  \r\nconst prepareWindow = function () {\r\n\r\n    const children = Array.prototype.slice.call(loginBtn.parentNode.children);\r\n    children.forEach(el => el.remove());\r\n\r\n    const container = document.querySelector(\".container\");\r\n    container.remove();\r\n\r\n    const appPanel = document.createElement(\"div\");\r\n\r\n    const groupsList = document.createElement(\"div\");\r\n    const usersList = document.createElement(\"div\");\r\n\r\n    const messagesView = document.createElement(\"div\");\r\n    const messageInput = document.createElement(\"input\");\r\n    const imageInput = document.createElement(\"input\");\r\n    const sendMessage = document.createElement(\"div\");\r\n    const breakLine = document.createElement(\"div\");\r\n    const join = document.createElement(\"div\");\r\n\r\n    const div1 = document.createElement(\"div\");\r\n    const div2 = document.createElement(\"div\");\r\n    const div3 = document.createElement(\"div\");\r\n    const divBox = document.createElement(\"div\");\r\n\r\n    div1.style.width = \"100%\";\r\n    div1.style.display = \"flex\";\r\n    div2.style.width = \"100%\";\r\n\r\n    appPanel.classList.add(\"appPanel\");\r\n\r\n    groupsList.classList.add(\"listPanel\");\r\n    groupsList.id = \"groupsList\";\r\n    groupsList.style.height = \"400px\";\r\n\r\n    usersList.classList.add(\"listPanel\");\r\n    usersList.id = \"usersList\";\r\n\r\n    imageInput.classList.add(\"imageInput\");\r\n    messagesView.classList.add(\"messagesView\");\r\n    messageInput.classList.add(\"messageInput\");\r\n    sendMessage.classList.add(\"sendMessage\");\r\n    breakLine.classList.add(\"break\");\r\n    join.classList.add(\"joinBTN\");\r\n    divBox.classList.add(\"inputBox\");\r\n\r\n\r\n    sendMessage.innerHTML = \"<p>SEND</p>\";\r\n    join.innerHTML = \"<p>JOIN</p>\";\r\n    //divBox.innerHTML = \"<p>M</p>\";\r\n\r\n    imageInput.type = \"file\";\r\n    imageInput.accept = \"image/*, audio/*\";\r\n\r\n\r\n    divBox.appendChild(imageInput);\r\n    container.appendChild(messagesView);\r\n    container.appendChild(breakLine);\r\n    container.appendChild(div1);\r\n    div1.appendChild(div2);\r\n    div2.appendChild(messageInput);\r\n    div1.appendChild(divBox);\r\n    div1.appendChild(sendMessage);\r\n\r\n    div3.appendChild(groupsList);\r\n    div3.appendChild(join);\r\n\r\n    appPanel.appendChild(div3);\r\n    appPanel.appendChild(container);\r\n    appPanel.appendChild(usersList);\r\n\r\n    document.querySelector(\".content\").appendChild(appPanel);\r\n    //container.appendChild(appPanel);\r\n    //container.appendChild(messegeInput);\r\n    //container.appendChild(sendMessege);\r\n\r\n    imageInput.addEventListener(\"change\", e => {\r\n        const file = e.target.files[0];\r\n        base64.type = file.type.substring(0, 5);\r\n        console.log(\"===========================================================\");\r\n        console.log(\"Typ piku :\", base64.type);\r\n        console.log(\"===========================================================\");\r\n        toBase64(file);\r\n    });\r\n\r\n    server.onReceiveGroupMessage(appendMessage);\r\n\r\n    server.onReceivePrivateMessage(appendMessage);   \r\n    \r\n    server.onReceiveUsersList(buildUsersList);\r\n    \r\n    server.onReceiveGroupsList(buildGroupsList);\r\n    \r\n    server.onReceiveMessagesPack( (json) => {\r\n        const conv = JSON.parse(json);\r\n        console.dir(conv);\r\n        showMessages(conv);\r\n    });\r\n    \r\n\r\n\r\n\r\n    join.addEventListener(\"click\", addToGroup);\r\n\r\n    document.querySelector(\".sendMessage\").addEventListener(\"click\", (event) => {\r\n        const message = document.querySelector(\".messageInput\").value;\r\n        document.querySelector(\".messageInput\").value = \"\";\r\n        if (document.querySelector(\".imageInput\").value != \"\") {\r\n\r\n            if (selected.type === \"user\") {\r\n                server.sendPrivateMessage(username, selected.item, base64.byte, base64.type);\r\n                \r\n            } else {\r\n\r\n                server.sendGroupMessage(username, selected.item, base64.byte, base64.type);\r\n                \r\n            }\r\n            document.querySelector(\".imageInput\").value = \"\";\r\n        }\r\n        else {\r\n            if (selected.item === \"none\") {\r\n                console.log(\"No destination selected\");\r\n                document.querySelector(\".messageInput\").value = message;\r\n            }\r\n\r\n            else if (selected.type === \"user\") {\r\n\r\n                server.sendPrivateMessage(username, selected.item, message, \"Text\");\r\n                \r\n                console.log(\"wiadomość prywatna\");\r\n                \r\n            } else {\r\n                server.sendGroupMessage(username, selected.item, message, \"Text\");\r\n                \r\n                console.log(\"wiadomość do grupy\");\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    // klawisz enter aktywuje przycisk sendsendMessage\r\n    messageInput.addEventListener(\"keyup\", (event) => {\r\n        if (event.key === 'Enter') {\r\n            event.preventDefault();\r\n            sendMessage.click();\r\n        }\r\n    });\r\n    \r\n};\r\n\r\nconst buildUsersList = function (json) {\r\n\r\n    console.log(\"działam\");\r\n    const usersList = document.querySelector(\"#usersList\");\r\n\r\n    const children = Array.prototype.slice.call(usersList.children);\r\n    children.forEach(el => el.remove());\r\n\r\n    console.log(\"działam\");\r\n    let user;\r\n    const Users = JSON.parse(json);\r\n    console.dir(Users);\r\n    Users.forEach(el => {\r\n        user = document.createElement(\"p\");\r\n        user.innerHTML = el.name;\r\n        user.id = el.name;\r\n        if (unseen.has(el.name)) {\r\n            user.classList.add(\"unseen\");\r\n        }\r\n        if (el.isActive === \"True\") {\r\n            user.style.color = \"#03A062\";\r\n        } else {\r\n            user.style.color = \"white\";\r\n        }\r\n\r\n\r\n        if (el.name === selected.item) {\r\n            user.classList.add(\"selected\");\r\n        }\r\n\r\n        user.addEventListener(\"click\", getSelected);\r\n        usersList.appendChild(user);\r\n    });\r\n\r\n\r\n\r\n    setTimeout(() => {\r\n        server.getUsers();\r\n        server.getGroupsByUser(username);\r\n    }, 15000);\r\n}\r\n\r\nconst buildGroupsList = function (json) {\r\n\r\n    const usersList = document.querySelector(\"#groupsList\");\r\n\r\n    const children = Array.prototype.slice.call(usersList.children);\r\n    children.forEach(el => el.remove());\r\n\r\n    console.log(\"grupy\");\r\n    let flag = true;\r\n    let group;\r\n    const Groups = JSON.parse(json);\r\n    console.dir(Groups);\r\n    Groups.forEach(el => {\r\n        group = document.createElement(\"p\");\r\n        group.innerHTML = el;\r\n        console.log(\"Nazwa :::::\" + el);\r\n        group.id = el + \"\";\r\n        group.style.color = \"white\";\r\n        if (unseen.has(el)) {\r\n            group.classList.add(\"unseen\");\r\n        }\r\n        if (el === selected.item) {\r\n            flag = false;\r\n            group.classList.add(\"selected\");\r\n        }\r\n        group.addEventListener(\"click\", getSelected);\r\n        usersList.appendChild(group);\r\n\r\n    });\r\n    console.log(\"flag\", flag, \" type\", selected.type);\r\n    if (flag === true && selected.type !== \"user\") {\r\n        abortion();\r\n    }\r\n}\r\n\r\nconst getSelected = function () {\r\n\r\n    document.querySelector(\".joinBTN\").innerHTML = \"<p>JOIN</p>\";\r\n\r\n    if (selected.item !== \"none\") {\r\n        console.log(\"działam tutaj przy zmianie\");\r\n        document.getElementById(selected.item).classList.remove(\"unseen\");\r\n        console.dir(document.getElementById(selected.item));\r\n        unseen.delete(selected.item);\r\n    }\r\n\r\n    //console.dir(this);\r\n    //this.classList.remove(\"unseen\");\r\n\r\n    const sel = document.querySelector(\".selected\");\r\n\r\n    if (sel) {\r\n        sel.classList.remove(\"selected\");\r\n    }\r\n    ;\r\n    if (selected.item === this.innerHTML) {\r\n\r\n        this.color = \"white\";\r\n        selected.item = \"none\";\r\n        selected.type = \"none\";\r\n    } else {\r\n\r\n        selected.item = this.innerHTML;\r\n        if (this.parentNode.id === \"usersList\") {\r\n            buildConversation(selected.item, \"Private\");\r\n            selected.type = \"user\";\r\n        } else {\r\n            document.querySelector(\".joinBTN\").innerHTML = \"<p>LEAVE</p>\";\r\n            buildConversation(selected.item, \"Public\");\r\n            selected.type = \"group\";\r\n        }\r\n        this.classList.add(\"selected\");\r\n    }\r\n    console.dir(selected);\r\n\r\n\r\n\r\n\r\n}\r\n\r\nconst addToGroup = function () {\r\n\r\n    if (selected.type === \"group\") {\r\n\r\n        server.removeUserFromGroup(username, selected.item);\r\n\r\n        selected.item = \"none\";\r\n        selected.type = \"none\";\r\n        document.querySelector(\".joinBTN\").innerHTML = \"<p>JOIN</p>\";\r\n\r\n    } else {\r\n        const window = document.createElement(\"div\");\r\n        const groupInput = document.createElement(\"input\");\r\n        const joinBTN = document.createElement(\"div\");\r\n\r\n        groupInput.classList.add(\"groupInput\");\r\n        joinBTN.classList.add(\"joinTogroupBTN\");\r\n        window.classList.add(\"addToGroup\");\r\n\r\n        groupInput.placeholder = \"Groupname\";\r\n        joinBTN.innerHTML = \"<p>EXIT</p>\";\r\n\r\n        window.appendChild(groupInput);\r\n        window.appendChild(joinBTN);\r\n\r\n        document.querySelector(\"body\").appendChild(window);\r\n        // zmiana wartości przycisku w zależności od wartości pola\r\n        groupInput.addEventListener(\"input\", () => {\r\n            if (groupInput.value === \"\") {\r\n                joinBTN.innerHTML = \"<p>EXIT</p>\";\r\n            } else {\r\n                joinBTN.innerHTML = \"<p>JOIN</p>\";\r\n            }\r\n\r\n        })\r\n\r\n        //dodawanie do grupy\r\n        joinBTN.addEventListener(\"click\", () => {\r\n            if (groupInput.value === \"\") {\r\n                window.remove();\r\n            } else {\r\n\r\n                server.addUserToGroup(username, groupInput.value);\r\n                \r\n                window.remove();\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n\r\nconst buildConversation = function (convName, type) {\r\n\r\n    server.getMessagesByGroup(convName, type);\r\n    \r\n    abortion();\r\n}\r\nconst appendMessage = function (destination, json, type) {\r\n    const messagesView = document.querySelector(\".messagesView\");\r\n    const message = JSON.parse(json);\r\n    //console.dir(message);\r\n    const msg = document.createElement(\"p\");\r\n    if (selected.item === destination && selected.type === type) {\r\n        messagesView.appendChild(msg);\r\n        if (message.sender === username) {\r\n            message.sender = \"You\";\r\n            msg.style.width = \"80%\";\r\n            msg.style.float = \"right\";\r\n            msg.style.textAlign = \"right\";\r\n            msg.style.marginRight = \"3px\";\r\n            msg.style.color = \"#03A062\";\r\n        } else {\r\n            msg.style.width = \"80%\";\r\n            msg.style.float = \"left\";\r\n            msg.style.textAlign = \"left\";\r\n            msg.style.marginLeft = \"3px\";\r\n            msg.style.color = \"white\";\r\n        }\r\n\r\n        //skrolowanie listy wiadomości do dołu \r\n        messagesView.scrollTop = messagesView.scrollHeight;\r\n\r\n        if (message.type == \"image\") {\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${message.sender}:</span><img src=\"${message.msg}\"></img>`;\r\n        } else if (message.type == \"audio\") {\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${message.sender}:</span><audio controls ><source src=\"${message.msg}\"></audio>`;\r\n        } else {\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${message.sender}:</span><span>${message.msg}</span>`;\r\n        }\r\n    } else {\r\n        const name = document.getElementById(destination);\r\n        name.classList.add(\"unseen\");\r\n        unseen.add(destination);\r\n\r\n    }\r\n}\r\n\r\nconst showMessages = function (conv) {\r\n    console.log(\"Działam tutaj\");\r\n    const messagesView = document.querySelector(\".messagesView\");\r\n    console.log(\"Działam tutaj\");\r\n    conv.content.forEach(el => {\r\n        const msg = document.createElement(\"p\");\r\n        console.log(\"Działam tutaj\");\r\n        messagesView.appendChild(msg);\r\n        console.log(\"Działam tutaj\");\r\n        if (el.sender === username) {\r\n            console.log(\"Działam tutaj1\");\r\n            el.sender = \"You\";\r\n            msg.style.width = \"80%\";\r\n            msg.style.float = \"right\";\r\n            msg.style.textAlign = \"right\";\r\n            msg.style.marginRight = \"3px\";\r\n            msg.style.color = \"#03A062\";\r\n        } else {\r\n            console.log(\"Działam tutaj2\");\r\n            msg.style.width = \"80%\";\r\n            msg.style.float = \"left\";\r\n            msg.style.textAlign = \"left\";\r\n            msg.style.marginLeft = \"3px\";\r\n            msg.style.color = \"white\";\r\n        }\r\n        console.log(\"Działam tutaj2 Type \", el.type);\r\n        if (el.type == \"image\") {\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${el.sender}:</span><img src=\"${el.msg}\"></img>`;\r\n        } else if (el.type == \"audio\") {\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${el.sender}:</span><audio controls ><source src=\"${el.msg}\"></audio>`;\r\n        } else {\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${el.sender}:</span><span>${el.msg}</span>`;\r\n        }\r\n\r\n    });\r\n    //skrolowanie listy wiadomości do dołu \r\n    messagesView.scrollTop = messagesView.scrollHeight;\r\n\r\n\r\n\r\n\r\n}\r\nconst abortion = function () {\r\n    const messagesView = document.querySelector(\".messagesView\");\r\n    const children = Array.prototype.slice.call(messagesView.children);\r\n    children.forEach(el => el.remove());\r\n}\r\n\r\n\r\nconst toBase64 = function (file) {\r\n\r\n    //let base64 ;\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n        // log to console\r\n        // logs data:<type>;base64,wL2dvYWwgbW9yZ...\r\n        base64.byte = reader.result;\r\n        //console.log(reader.result);\r\n    };\r\n    console.log(base64.byte);\r\n    reader.readAsDataURL(file);\r\n\r\n}","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortController } from \"./AbortController\";\r\nimport { HttpError, TimeoutError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, sendMessage } from \"./Utils\";\r\n// Not exported from 'index', this type is internal.\r\n/** @private */\r\nvar LongPollingTransport = /** @class */ (function () {\r\n    function LongPollingTransport(httpClient, accessTokenFactory, logger, logMessageContent, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.pollAbort = new AbortController();\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.headers = headers;\r\n        this.running = false;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    Object.defineProperty(LongPollingTransport.prototype, \"pollAborted\", {\r\n        // This is an internal type, not exported from 'index' so this is really just internal.\r\n        get: function () {\r\n            return this.pollAbort.aborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LongPollingTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, _b, name, value, headers, pollOptions, token, pollUrl, response;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.url = url;\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Connecting.\");\r\n                        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)\r\n                        if (transferFormat === TransferFormat.Binary &&\r\n                            (typeof XMLHttpRequest !== \"undefined\" && typeof new XMLHttpRequest().responseType !== \"string\")) {\r\n                            throw new Error(\"Binary protocols over XmlHttpRequest not implementing advanced features are not supported.\");\r\n                        }\r\n                        _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                        headers = __assign((_a = {}, _a[name] = value, _a), this.headers);\r\n                        pollOptions = {\r\n                            abortSignal: this.pollAbort.signal,\r\n                            headers: headers,\r\n                            timeout: 100000,\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        if (transferFormat === TransferFormat.Binary) {\r\n                            pollOptions.responseType = \"arraybuffer\";\r\n                        }\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 1:\r\n                        token = _c.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 2:\r\n                        response = _c.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Mark running as false so that the poll immediately ends and runs the close logic\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            this.running = true;\r\n                        }\r\n                        this.receiving = this.poll(this.url, pollOptions);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.getAccessToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1: return [2 /*return*/, _a.sent()];\r\n                    case 2: return [2 /*return*/, null];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.updateHeaderToken = function (request, token) {\r\n        if (!request.headers) {\r\n            request.headers = {};\r\n        }\r\n        if (token) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            request.headers[\"Authorization\"] = \"Bearer \" + token;\r\n            return;\r\n        }\r\n        // tslint:disable-next-line:no-string-literal\r\n        if (request.headers[\"Authorization\"]) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            delete request.headers[\"Authorization\"];\r\n        }\r\n    };\r\n    LongPollingTransport.prototype.poll = function (url, pollOptions) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token, pollUrl, response, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, , 8, 9]);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!this.running) return [3 /*break*/, 7];\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 2:\r\n                        token = _a.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 4:\r\n                        response = _a.sent();\r\n                        if (response.statusCode === 204) {\r\n                            this.logger.log(LogLevel.Information, \"(LongPolling transport) Poll terminated by server.\");\r\n                            this.running = false;\r\n                        }\r\n                        else if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Unexpected status code\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            // Process the response\r\n                            if (response.content) {\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) data received. \" + getDataDetail(response.content, this.logMessageContent) + \".\");\r\n                                if (this.onreceive) {\r\n                                    this.onreceive(response.content);\r\n                                }\r\n                            }\r\n                            else {\r\n                                // This is another way timeout manifest.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        e_1 = _a.sent();\r\n                        if (!this.running) {\r\n                            // Log but disregard errors that occur after stopping\r\n                            this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll errored after shutdown: \" + e_1.message);\r\n                        }\r\n                        else {\r\n                            if (e_1 instanceof TimeoutError) {\r\n                                // Ignore timeouts and reissue the poll.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                            else {\r\n                                // Close the connection with the error as the result.\r\n                                this.closeError = e_1;\r\n                                this.running = false;\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7: return [3 /*break*/, 9];\r\n                    case 8:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Polling complete.\");\r\n                        // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.\r\n                        // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.\r\n                        if (!this.pollAborted) {\r\n                            this.raiseOnClose();\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 9: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.running) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"LongPolling\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, _a, name_1, value, deleteOptions, token;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stopping polling.\");\r\n                        // Tell receiving loop to stop, abort any current request, and then wait for it to finish\r\n                        this.running = false;\r\n                        this.pollAbort.abort();\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, , 5, 6]);\r\n                        return [4 /*yield*/, this.receiving];\r\n                    case 2:\r\n                        _b.sent();\r\n                        // Send DELETE to clean up long polling on the server\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) sending DELETE request to \" + this.url + \".\");\r\n                        headers = {};\r\n                        _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                        headers[name_1] = value;\r\n                        deleteOptions = {\r\n                            headers: __assign({}, headers, this.headers),\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 3:\r\n                        token = _b.sent();\r\n                        this.updateHeaderToken(deleteOptions, token);\r\n                        return [4 /*yield*/, this.httpClient.delete(this.url, deleteOptions)];\r\n                    case 4:\r\n                        _b.sent();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) DELETE request sent.\");\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stop finished.\");\r\n                        // Raise close event here instead of in polling\r\n                        // It needs to happen after the DELETE request is sent\r\n                        this.raiseOnClose();\r\n                        return [7 /*endfinally*/];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.raiseOnClose = function () {\r\n        if (this.onclose) {\r\n            var logMessage = \"(LongPolling transport) Firing onclose event.\";\r\n            if (this.closeError) {\r\n                logMessage += \" Error: \" + this.closeError;\r\n            }\r\n            this.logger.log(LogLevel.Trace, logMessage);\r\n            this.onclose(this.closeError);\r\n        }\r\n    };\r\n    return LongPollingTransport;\r\n}());\r\nexport { LongPollingTransport };\r\n//# sourceMappingURL=LongPollingTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform, sendMessage } from \"./Utils\";\r\n/** @private */\r\nvar ServerSentEventsTransport = /** @class */ (function () {\r\n    function ServerSentEventsTransport(httpClient, accessTokenFactory, logger, logMessageContent, eventSourceConstructor, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.eventSourceConstructor = eventSourceConstructor;\r\n        this.headers = headers;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    ServerSentEventsTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(SSE transport) Connecting.\");\r\n                        // set url before accessTokenFactory because this.url is only for send and we set the auth header instead of the query string for send\r\n                        this.url = url;\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            var opened = false;\r\n                            if (transferFormat !== TransferFormat.Text) {\r\n                                reject(new Error(\"The Server-Sent Events transport only supports the 'Text' transfer format\"));\r\n                                return;\r\n                            }\r\n                            var eventSource;\r\n                            if (Platform.isBrowser || Platform.isWebWorker) {\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials });\r\n                            }\r\n                            else {\r\n                                // Non-browser passes cookies via the dictionary\r\n                                var cookies = _this.httpClient.getCookieString(url);\r\n                                var headers = {};\r\n                                headers.Cookie = cookies;\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials, headers: __assign({}, headers, _this.headers) });\r\n                            }\r\n                            try {\r\n                                eventSource.onmessage = function (e) {\r\n                                    if (_this.onreceive) {\r\n                                        try {\r\n                                            _this.logger.log(LogLevel.Trace, \"(SSE transport) data received. \" + getDataDetail(e.data, _this.logMessageContent) + \".\");\r\n                                            _this.onreceive(e.data);\r\n                                        }\r\n                                        catch (error) {\r\n                                            _this.close(error);\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                };\r\n                                eventSource.onerror = function (e) {\r\n                                    var error = new Error(e.data || \"Error occurred\");\r\n                                    if (opened) {\r\n                                        _this.close(error);\r\n                                    }\r\n                                    else {\r\n                                        reject(error);\r\n                                    }\r\n                                };\r\n                                eventSource.onopen = function () {\r\n                                    _this.logger.log(LogLevel.Information, \"SSE connected to \" + _this.url);\r\n                                    _this.eventSource = eventSource;\r\n                                    opened = true;\r\n                                    resolve();\r\n                                };\r\n                            }\r\n                            catch (e) {\r\n                                reject(e);\r\n                                return;\r\n                            }\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.eventSource) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"SSE\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.stop = function () {\r\n        this.close();\r\n        return Promise.resolve();\r\n    };\r\n    ServerSentEventsTransport.prototype.close = function (e) {\r\n        if (this.eventSource) {\r\n            this.eventSource.close();\r\n            this.eventSource = undefined;\r\n            if (this.onclose) {\r\n                this.onclose(e);\r\n            }\r\n        }\r\n    };\r\n    return ServerSentEventsTransport;\r\n}());\r\nexport { ServerSentEventsTransport };\r\n//# sourceMappingURL=ServerSentEventsTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform } from \"./Utils\";\r\n/** @private */\r\nvar WebSocketTransport = /** @class */ (function () {\r\n    function WebSocketTransport(httpClient, accessTokenFactory, logger, logMessageContent, webSocketConstructor, headers) {\r\n        this.logger = logger;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logMessageContent = logMessageContent;\r\n        this.webSocketConstructor = webSocketConstructor;\r\n        this.httpClient = httpClient;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n        this.headers = headers;\r\n    }\r\n    WebSocketTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(WebSockets transport) Connecting.\");\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            url = url.replace(/^http/, \"ws\");\r\n                            var webSocket;\r\n                            var cookies = _this.httpClient.getCookieString(url);\r\n                            var opened = false;\r\n                            if (Platform.isNode) {\r\n                                var headers = {};\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                if (cookies) {\r\n                                    headers[\"Cookie\"] = \"\" + cookies;\r\n                                }\r\n                                // Only pass headers when in non-browser environments\r\n                                webSocket = new _this.webSocketConstructor(url, undefined, {\r\n                                    headers: __assign({}, headers, _this.headers),\r\n                                });\r\n                            }\r\n                            if (!webSocket) {\r\n                                // Chrome is not happy with passing 'undefined' as protocol\r\n                                webSocket = new _this.webSocketConstructor(url);\r\n                            }\r\n                            if (transferFormat === TransferFormat.Binary) {\r\n                                webSocket.binaryType = \"arraybuffer\";\r\n                            }\r\n                            // tslint:disable-next-line:variable-name\r\n                            webSocket.onopen = function (_event) {\r\n                                _this.logger.log(LogLevel.Information, \"WebSocket connected to \" + url + \".\");\r\n                                _this.webSocket = webSocket;\r\n                                opened = true;\r\n                                resolve();\r\n                            };\r\n                            webSocket.onerror = function (event) {\r\n                                var error = null;\r\n                                // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                    error = event.error;\r\n                                }\r\n                                else {\r\n                                    error = new Error(\"There was an error with the transport.\");\r\n                                }\r\n                                reject(error);\r\n                            };\r\n                            webSocket.onmessage = function (message) {\r\n                                _this.logger.log(LogLevel.Trace, \"(WebSockets transport) data received. \" + getDataDetail(message.data, _this.logMessageContent) + \".\");\r\n                                if (_this.onreceive) {\r\n                                    try {\r\n                                        _this.onreceive(message.data);\r\n                                    }\r\n                                    catch (error) {\r\n                                        _this.close(error);\r\n                                        return;\r\n                                    }\r\n                                }\r\n                            };\r\n                            webSocket.onclose = function (event) {\r\n                                // Don't call close handler if connection was never established\r\n                                // We'll reject the connect call instead\r\n                                if (opened) {\r\n                                    _this.close(event);\r\n                                }\r\n                                else {\r\n                                    var error = null;\r\n                                    // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                    if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                        error = event.error;\r\n                                    }\r\n                                    else {\r\n                                        error = new Error(\"There was an error with the transport.\");\r\n                                    }\r\n                                    reject(error);\r\n                                }\r\n                            };\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WebSocketTransport.prototype.send = function (data) {\r\n        if (this.webSocket && this.webSocket.readyState === this.webSocketConstructor.OPEN) {\r\n            this.logger.log(LogLevel.Trace, \"(WebSockets transport) sending data. \" + getDataDetail(data, this.logMessageContent) + \".\");\r\n            this.webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n        return Promise.reject(\"WebSocket is not in the OPEN state\");\r\n    };\r\n    WebSocketTransport.prototype.stop = function () {\r\n        if (this.webSocket) {\r\n            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning\r\n            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects\r\n            this.close(undefined);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WebSocketTransport.prototype.close = function (event) {\r\n        // webSocket will be null if the transport did not start successfully\r\n        if (this.webSocket) {\r\n            // Clear websocket handlers because we are considering the socket closed now\r\n            this.webSocket.onclose = function () { };\r\n            this.webSocket.onmessage = function () { };\r\n            this.webSocket.onerror = function () { };\r\n            this.webSocket.close();\r\n            this.webSocket = undefined;\r\n        }\r\n        this.logger.log(LogLevel.Trace, \"(WebSockets transport) socket closed.\");\r\n        if (this.onclose) {\r\n            if (this.isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {\r\n                this.onclose(new Error(\"WebSocket closed with status code: \" + event.code + \" (\" + event.reason + \").\"));\r\n            }\r\n            else if (event instanceof Error) {\r\n                this.onclose(event);\r\n            }\r\n            else {\r\n                this.onclose();\r\n            }\r\n        }\r\n    };\r\n    WebSocketTransport.prototype.isCloseEvent = function (event) {\r\n        return event && typeof event.wasClean === \"boolean\" && typeof event.code === \"number\";\r\n    };\r\n    return WebSocketTransport;\r\n}());\r\nexport { WebSocketTransport };\r\n//# sourceMappingURL=WebSocketTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger, getUserAgentHeader, Platform } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nvar MAX_REDIRECTS = 100;\r\n/** @private */\r\nvar HttpConnection = /** @class */ (function () {\r\n    function HttpConnection(url, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.stopPromiseResolver = function () { };\r\n        this.features = {};\r\n        this.negotiateVersion = 1;\r\n        Arg.isRequired(url, \"url\");\r\n        this.logger = createLogger(options.logger);\r\n        this.baseUrl = this.resolveUrl(url);\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;\r\n        if (typeof options.withCredentials === \"boolean\" || options.withCredentials === undefined) {\r\n            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;\r\n        }\r\n        else {\r\n            throw new Error(\"withCredentials option was not a 'boolean' or 'undefined' value\");\r\n        }\r\n        var webSocketModule = null;\r\n        var eventSourceModule = null;\r\n        if (Platform.isNode && typeof require !== \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            webSocketModule = requireFunc(\"ws\");\r\n            eventSourceModule = requireFunc(\"eventsource\");\r\n        }\r\n        if (!Platform.isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        }\r\n        else if (Platform.isNode && !options.WebSocket) {\r\n            if (webSocketModule) {\r\n                options.WebSocket = webSocketModule;\r\n            }\r\n        }\r\n        if (!Platform.isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        }\r\n        else if (Platform.isNode && !options.EventSource) {\r\n            if (typeof eventSourceModule !== \"undefined\") {\r\n                options.EventSource = eventSourceModule;\r\n            }\r\n        }\r\n        this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        this.connectionStarted = false;\r\n        this.options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    HttpConnection.prototype.start = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var message, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        transferFormat = transferFormat || TransferFormat.Binary;\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\r\n                        if (this.connectionState !== \"Disconnected\" /* Disconnected */) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start an HttpConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = \"Connecting\" /* Connecting */;\r\n                        this.startInternalPromise = this.startInternal(transferFormat);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!(this.connectionState === \"Disconnecting\" /* Disconnecting */)) return [3 /*break*/, 3];\r\n                        message = \"Failed to start the HttpConnection before stop() was called.\";\r\n                        this.logger.log(LogLevel.Error, message);\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        _a.sent();\r\n                        return [2 /*return*/, Promise.reject(new Error(message))];\r\n                    case 3:\r\n                        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n                            message = \"HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!\";\r\n                            this.logger.log(LogLevel.Error, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        this.connectionStarted = true;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.send = function (data) {\r\n        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n            return Promise.reject(new Error(\"Cannot send data if the connection is not in the 'Connected' State.\"));\r\n        }\r\n        if (!this.sendQueue) {\r\n            this.sendQueue = new TransportSendQueue(this.transport);\r\n        }\r\n        // Transport will not be null if state is connected\r\n        return this.sendQueue.send(data);\r\n    };\r\n    HttpConnection.prototype.stop = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnected state.\");\r\n                            return [2 /*return*/, Promise.resolve()];\r\n                        }\r\n                        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n                            return [2 /*return*/, this.stopPromise];\r\n                        }\r\n                        this.connectionState = \"Disconnecting\" /* Disconnecting */;\r\n                        this.stopPromise = new Promise(function (resolve) {\r\n                            // Don't complete stop() until stopConnection() completes.\r\n                            _this.stopPromiseResolver = resolve;\r\n                        });\r\n                        // stopInternal should never throw so just observe it.\r\n                        return [4 /*yield*/, this.stopInternal(error)];\r\n                    case 1:\r\n                        // stopInternal should never throw so just observe it.\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.stopInternal = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1, e_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Set error as soon as possible otherwise there is a race between\r\n                        // the transport closing and providing an error and the error from a close message\r\n                        // We would prefer the close message error.\r\n                        this.stopError = error;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 4:\r\n                        if (!this.transport) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.transport.stop()];\r\n                    case 6:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"HttpConnection.transport.stop() threw error '\" + e_2 + \"'.\");\r\n                        this.stopConnection();\r\n                        return [3 /*break*/, 8];\r\n                    case 8:\r\n                        this.transport = undefined;\r\n                        return [3 /*break*/, 10];\r\n                    case 9:\r\n                        this.logger.log(LogLevel.Debug, \"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.\");\r\n                        _a.label = 10;\r\n                    case 10: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.startInternal = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var url, negotiateResponse, redirects, _loop_1, this_1, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        url = this.baseUrl;\r\n                        this.accessTokenFactory = this.options.accessTokenFactory;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 12, , 13]);\r\n                        if (!this.options.skipNegotiation) return [3 /*break*/, 5];\r\n                        if (!(this.options.transport === HttpTransportType.WebSockets)) return [3 /*break*/, 3];\r\n                        // No need to add a connection ID in this case\r\n                        this.transport = this.constructTransport(HttpTransportType.WebSockets);\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        return [4 /*yield*/, this.startTransport(url, transferFormat)];\r\n                    case 2:\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3: throw new Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                    case 4: return [3 /*break*/, 11];\r\n                    case 5:\r\n                        negotiateResponse = null;\r\n                        redirects = 0;\r\n                        _loop_1 = function () {\r\n                            var accessToken_1;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4 /*yield*/, this_1.getNegotiationResponse(url)];\r\n                                    case 1:\r\n                                        negotiateResponse = _a.sent();\r\n                                        // the user tries to stop the connection when it is being started\r\n                                        if (this_1.connectionState === \"Disconnecting\" /* Disconnecting */ || this_1.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                                            throw new Error(\"The connection was stopped during negotiation.\");\r\n                                        }\r\n                                        if (negotiateResponse.error) {\r\n                                            throw new Error(negotiateResponse.error);\r\n                                        }\r\n                                        if (negotiateResponse.ProtocolVersion) {\r\n                                            throw new Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                                        }\r\n                                        if (negotiateResponse.url) {\r\n                                            url = negotiateResponse.url;\r\n                                        }\r\n                                        if (negotiateResponse.accessToken) {\r\n                                            accessToken_1 = negotiateResponse.accessToken;\r\n                                            this_1.accessTokenFactory = function () { return accessToken_1; };\r\n                                        }\r\n                                        redirects++;\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        };\r\n                        this_1 = this;\r\n                        _a.label = 6;\r\n                    case 6: return [5 /*yield**/, _loop_1()];\r\n                    case 7:\r\n                        _a.sent();\r\n                        _a.label = 8;\r\n                    case 8:\r\n                        if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                            throw new Error(\"Negotiate redirection limit exceeded.\");\r\n                        }\r\n                        return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        _a.label = 11;\r\n                    case 11:\r\n                        if (this.transport instanceof LongPollingTransport) {\r\n                            this.features.inherentKeepAlive = true;\r\n                        }\r\n                        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n                            // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.\r\n                            // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.\r\n                            this.logger.log(LogLevel.Debug, \"The HttpConnection connected successfully.\");\r\n                            this.connectionState = \"Connected\" /* Connected */;\r\n                        }\r\n                        return [3 /*break*/, 13];\r\n                    case 12:\r\n                        e_3 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_3);\r\n                        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n                        this.transport = undefined;\r\n                        // if start fails, any active calls to stop assume that start will complete the stop promise\r\n                        this.stopPromiseResolver();\r\n                        return [2 /*return*/, Promise.reject(e_3)];\r\n                    case 13: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.getNegotiationResponse = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, token, _a, name, value, negotiateUrl, response, negotiateResponse, e_4;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        headers = {};\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _b.sent();\r\n                        if (token) {\r\n                            headers[\"Authorization\"] = \"Bearer \" + token;\r\n                        }\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        _a = getUserAgentHeader(), name = _a[0], value = _a[1];\r\n                        headers[name] = value;\r\n                        negotiateUrl = this.resolveNegotiateUrl(url);\r\n                        this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl + \".\");\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _b.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.httpClient.post(negotiateUrl, {\r\n                                content: \"\",\r\n                                headers: __assign({}, headers, this.options.headers),\r\n                                withCredentials: this.options.withCredentials,\r\n                            })];\r\n                    case 4:\r\n                        response = _b.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unexpected status code returned from negotiate '\" + response.statusCode + \"'\"))];\r\n                        }\r\n                        negotiateResponse = JSON.parse(response.content);\r\n                        if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {\r\n                            // Negotiate version 0 doesn't use connectionToken\r\n                            // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version\r\n                            negotiateResponse.connectionToken = negotiateResponse.connectionId;\r\n                        }\r\n                        return [2 /*return*/, negotiateResponse];\r\n                    case 5:\r\n                        e_4 = _b.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_4);\r\n                        return [2 /*return*/, Promise.reject(e_4)];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.createConnectUrl = function (url, connectionToken) {\r\n        if (!connectionToken) {\r\n            return url;\r\n        }\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionToken);\r\n    };\r\n    HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var connectUrl, transportExceptions, transports, negotiate, _i, transports_1, endpoint, transportOrError, ex_1, ex_2, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionToken);\r\n                        if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];\r\n                        this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n                        this.transport = requestedTransport;\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.connectionId = negotiateResponse.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 2:\r\n                        transportExceptions = [];\r\n                        transports = negotiateResponse.availableTransports || [];\r\n                        negotiate = negotiateResponse;\r\n                        _i = 0, transports_1 = transports;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (!(_i < transports_1.length)) return [3 /*break*/, 13];\r\n                        endpoint = transports_1[_i];\r\n                        transportOrError = this.resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat);\r\n                        if (!(transportOrError instanceof Error)) return [3 /*break*/, 4];\r\n                        // Store the error and continue, we don't want to cause a re-negotiate in these cases\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + transportOrError);\r\n                        return [3 /*break*/, 12];\r\n                    case 4:\r\n                        if (!this.isITransport(transportOrError)) return [3 /*break*/, 12];\r\n                        this.transport = transportOrError;\r\n                        if (!!negotiate) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.getNegotiationResponse(url)];\r\n                    case 6:\r\n                        negotiate = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        ex_1 = _a.sent();\r\n                        return [2 /*return*/, Promise.reject(ex_1)];\r\n                    case 8:\r\n                        connectUrl = this.createConnectUrl(url, negotiate.connectionToken);\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        _a.trys.push([9, 11, , 12]);\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        this.connectionId = negotiate.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 11:\r\n                        ex_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + endpoint.transport + \"': \" + ex_2);\r\n                        negotiate = undefined;\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + ex_2);\r\n                        if (this.connectionState !== \"Connecting\" /* Connecting */) {\r\n                            message = \"Failed to select transport before stop() was called.\";\r\n                            this.logger.log(LogLevel.Debug, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        return [3 /*break*/, 12];\r\n                    case 12:\r\n                        _i++;\r\n                        return [3 /*break*/, 3];\r\n                    case 13:\r\n                        if (transportExceptions.length > 0) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unable to connect to the server with any of the available transports. \" + transportExceptions.join(\" \")))];\r\n                        }\r\n                        return [2 /*return*/, Promise.reject(new Error(\"None of the transports supported by the client are supported by the server.\"))];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.constructTransport = function (transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this.options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.WebSocket, this.options.headers || {});\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this.options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.EventSource, this.options.withCredentials, this.options.headers || {});\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.withCredentials, this.options.headers || {});\r\n            default:\r\n                throw new Error(\"Unknown transport: \" + transport + \".\");\r\n        }\r\n    };\r\n    HttpConnection.prototype.startTransport = function (url, transferFormat) {\r\n        var _this = this;\r\n        this.transport.onreceive = this.onreceive;\r\n        this.transport.onclose = function (e) { return _this.stopConnection(e); };\r\n        return this.transport.connect(url, transferFormat);\r\n    };\r\n    HttpConnection.prototype.resolveTransportOrError = function (endpoint, requestedTransport, requestedTransferFormat) {\r\n        var transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n            return new Error(\"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n        }\r\n        else {\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                var transferFormats = endpoint.transferFormats.map(function (s) { return TransferFormat[s]; });\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this.options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this.options.EventSource)) {\r\n                        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\r\n                        return new Error(\"'\" + HttpTransportType[transport] + \"' is not supported in your environment.\");\r\n                    }\r\n                    else {\r\n                        this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'.\");\r\n                        try {\r\n                            return this.constructTransport(transport);\r\n                        }\r\n                        catch (ex) {\r\n                            return ex;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\r\n                    return new Error(\"'\" + HttpTransportType[transport] + \"' does not support \" + TransferFormat[requestedTransferFormat] + \".\");\r\n                }\r\n            }\r\n            else {\r\n                this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\r\n                return new Error(\"'\" + HttpTransportType[transport] + \"' is disabled by the client.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.isITransport = function (transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    };\r\n    HttpConnection.prototype.stopConnection = function (error) {\r\n        var _this = this;\r\n        this.logger.log(LogLevel.Debug, \"HttpConnection.stopConnection(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        this.transport = undefined;\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this.stopError || error;\r\n        this.stopError = undefined;\r\n        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is already in the disconnected state.\");\r\n            return;\r\n        }\r\n        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n            this.logger.log(LogLevel.Warning, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is still in the connecting state.\");\r\n            throw new Error(\"HttpConnection.stopConnection(\" + error + \") was called while the connection is still in the connecting state.\");\r\n        }\r\n        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n            // A call to stop() induced this call to stopConnection and needs to be completed.\r\n            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.\r\n            this.stopPromiseResolver();\r\n        }\r\n        if (error) {\r\n            this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n        if (this.sendQueue) {\r\n            this.sendQueue.stop().catch(function (e) {\r\n                _this.logger.log(LogLevel.Error, \"TransportSendQueue.stop() threw error '\" + e + \"'.\");\r\n            });\r\n            this.sendQueue = undefined;\r\n        }\r\n        this.connectionId = undefined;\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        if (this.connectionStarted) {\r\n            this.connectionStarted = false;\r\n            try {\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"HttpConnection.onclose(\" + error + \") threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.resolveUrl = function (url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (!Platform.isBrowser || !window.document) {\r\n            throw new Error(\"Cannot resolve '\" + url + \"'.\");\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        var aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\r\n        return aTag.href;\r\n    };\r\n    HttpConnection.prototype.resolveNegotiateUrl = function (url) {\r\n        var index = url.indexOf(\"?\");\r\n        var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\r\n        if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\r\n            negotiateUrl += \"/\";\r\n        }\r\n        negotiateUrl += \"negotiate\";\r\n        negotiateUrl += index === -1 ? \"\" : url.substring(index);\r\n        if (negotiateUrl.indexOf(\"negotiateVersion\") === -1) {\r\n            negotiateUrl += index === -1 ? \"?\" : \"&\";\r\n            negotiateUrl += \"negotiateVersion=\" + this.negotiateVersion;\r\n        }\r\n        return negotiateUrl;\r\n    };\r\n    return HttpConnection;\r\n}());\r\nexport { HttpConnection };\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n/** @private */\r\nvar TransportSendQueue = /** @class */ (function () {\r\n    function TransportSendQueue(transport) {\r\n        this.transport = transport;\r\n        this.buffer = [];\r\n        this.executing = true;\r\n        this.sendBufferedData = new PromiseSource();\r\n        this.transportResult = new PromiseSource();\r\n        this.sendLoopPromise = this.sendLoop();\r\n    }\r\n    TransportSendQueue.prototype.send = function (data) {\r\n        this.bufferData(data);\r\n        if (!this.transportResult) {\r\n            this.transportResult = new PromiseSource();\r\n        }\r\n        return this.transportResult.promise;\r\n    };\r\n    TransportSendQueue.prototype.stop = function () {\r\n        this.executing = false;\r\n        this.sendBufferedData.resolve();\r\n        return this.sendLoopPromise;\r\n    };\r\n    TransportSendQueue.prototype.bufferData = function (data) {\r\n        if (this.buffer.length && typeof (this.buffer[0]) !== typeof (data)) {\r\n            throw new Error(\"Expected data to be of type \" + typeof (this.buffer) + \" but was of type \" + typeof (data));\r\n        }\r\n        this.buffer.push(data);\r\n        this.sendBufferedData.resolve();\r\n    };\r\n    TransportSendQueue.prototype.sendLoop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var transportResult, data, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!true) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.sendBufferedData.promise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.executing) {\r\n                            if (this.transportResult) {\r\n                                this.transportResult.reject(\"Connection stopped.\");\r\n                            }\r\n                            return [3 /*break*/, 6];\r\n                        }\r\n                        this.sendBufferedData = new PromiseSource();\r\n                        transportResult = this.transportResult;\r\n                        this.transportResult = undefined;\r\n                        data = typeof (this.buffer[0]) === \"string\" ?\r\n                            this.buffer.join(\"\") :\r\n                            TransportSendQueue.concatBuffers(this.buffer);\r\n                        this.buffer.length = 0;\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, this.transport.send(data)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        transportResult.resolve();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        error_1 = _a.sent();\r\n                        transportResult.reject(error_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [3 /*break*/, 0];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    TransportSendQueue.concatBuffers = function (arrayBuffers) {\r\n        var totalLength = arrayBuffers.map(function (b) { return b.byteLength; }).reduce(function (a, b) { return a + b; });\r\n        var result = new Uint8Array(totalLength);\r\n        var offset = 0;\r\n        for (var _i = 0, arrayBuffers_1 = arrayBuffers; _i < arrayBuffers_1.length; _i++) {\r\n            var item = arrayBuffers_1[_i];\r\n            result.set(new Uint8Array(item), offset);\r\n            offset += item.byteLength;\r\n        }\r\n        return result.buffer;\r\n    };\r\n    return TransportSendQueue;\r\n}());\r\nexport { TransportSendQueue };\r\nvar PromiseSource = /** @class */ (function () {\r\n    function PromiseSource() {\r\n        var _this = this;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            var _a;\r\n            return _a = [resolve, reject], _this.resolver = _a[0], _this.rejecter = _a[1], _a;\r\n        });\r\n    }\r\n    PromiseSource.prototype.resolve = function () {\r\n        this.resolver();\r\n    };\r\n    PromiseSource.prototype.reject = function (reason) {\r\n        this.rejecter(reason);\r\n    };\r\n    return PromiseSource;\r\n}());\r\n//# sourceMappingURL=HttpConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nvar JSON_HUB_PROTOCOL_NAME = \"json\";\r\n/** Implements the JSON Hub Protocol. */\r\nvar JsonHubProtocol = /** @class */ (function () {\r\n    function JsonHubProtocol() {\r\n        /** @inheritDoc */\r\n        this.name = JSON_HUB_PROTOCOL_NAME;\r\n        /** @inheritDoc */\r\n        this.version = 1;\r\n        /** @inheritDoc */\r\n        this.transferFormat = TransferFormat.Text;\r\n    }\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * @param {string} input A string containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    JsonHubProtocol.prototype.parseMessages = function (input, logger) {\r\n        // The interface does allow \"ArrayBuffer\" to be passed in, but this implementation does not. So let's throw a useful error.\r\n        if (typeof input !== \"string\") {\r\n            throw new Error(\"Invalid input for JSON hub protocol. Expected a string.\");\r\n        }\r\n        if (!input) {\r\n            return [];\r\n        }\r\n        if (logger === null) {\r\n            logger = NullLogger.instance;\r\n        }\r\n        // Parse the messages\r\n        var messages = TextMessageFormat.parse(input);\r\n        var hubMessages = [];\r\n        for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n            var message = messages_1[_i];\r\n            var parsedMessage = JSON.parse(message);\r\n            if (typeof parsedMessage.type !== \"number\") {\r\n                throw new Error(\"Invalid payload.\");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case MessageType.Invocation:\r\n                    this.isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.StreamItem:\r\n                    this.isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Completion:\r\n                    this.isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Ping:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case MessageType.Close:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(LogLevel.Information, \"Unknown message type '\" + parsedMessage.type + \"' ignored.\");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n        return hubMessages;\r\n    };\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string} A string containing the serialized representation of the message.\r\n     */\r\n    JsonHubProtocol.prototype.writeMessage = function (message) {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    };\r\n    JsonHubProtocol.prototype.isInvocationMessage = function (message) {\r\n        this.assertNotEmptyString(message.target, \"Invalid payload for Invocation message.\");\r\n        if (message.invocationId !== undefined) {\r\n            this.assertNotEmptyString(message.invocationId, \"Invalid payload for Invocation message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isStreamItemMessage = function (message) {\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for StreamItem message.\");\r\n        if (message.item === undefined) {\r\n            throw new Error(\"Invalid payload for StreamItem message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isCompletionMessage = function (message) {\r\n        if (message.result && message.error) {\r\n            throw new Error(\"Invalid payload for Completion message.\");\r\n        }\r\n        if (!message.result && message.error) {\r\n            this.assertNotEmptyString(message.error, \"Invalid payload for Completion message.\");\r\n        }\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for Completion message.\");\r\n    };\r\n    JsonHubProtocol.prototype.assertNotEmptyString = function (value, errorMessage) {\r\n        if (typeof value !== \"string\" || value === \"\") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    };\r\n    return JsonHubProtocol;\r\n}());\r\nexport { JsonHubProtocol };\r\n//# sourceMappingURL=JsonHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nimport { DefaultReconnectPolicy } from \"./DefaultReconnectPolicy\";\r\nimport { HttpConnection } from \"./HttpConnection\";\r\nimport { HubConnection } from \"./HubConnection\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { JsonHubProtocol } from \"./JsonHubProtocol\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { Arg, ConsoleLogger } from \"./Utils\";\r\n// tslint:disable:object-literal-sort-keys\r\nvar LogLevelNameMapping = {\r\n    trace: LogLevel.Trace,\r\n    debug: LogLevel.Debug,\r\n    info: LogLevel.Information,\r\n    information: LogLevel.Information,\r\n    warn: LogLevel.Warning,\r\n    warning: LogLevel.Warning,\r\n    error: LogLevel.Error,\r\n    critical: LogLevel.Critical,\r\n    none: LogLevel.None,\r\n};\r\nfunction parseLogLevel(name) {\r\n    // Case-insensitive matching via lower-casing\r\n    // Yes, I know case-folding is a complicated problem in Unicode, but we only support\r\n    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.\r\n    var mapping = LogLevelNameMapping[name.toLowerCase()];\r\n    if (typeof mapping !== \"undefined\") {\r\n        return mapping;\r\n    }\r\n    else {\r\n        throw new Error(\"Unknown log level: \" + name);\r\n    }\r\n}\r\n/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */\r\nvar HubConnectionBuilder = /** @class */ (function () {\r\n    function HubConnectionBuilder() {\r\n    }\r\n    HubConnectionBuilder.prototype.configureLogging = function (logging) {\r\n        Arg.isRequired(logging, \"logging\");\r\n        if (isLogger(logging)) {\r\n            this.logger = logging;\r\n        }\r\n        else if (typeof logging === \"string\") {\r\n            var logLevel = parseLogLevel(logging);\r\n            this.logger = new ConsoleLogger(logLevel);\r\n        }\r\n        else {\r\n            this.logger = new ConsoleLogger(logging);\r\n        }\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withUrl = function (url, transportTypeOrOptions) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isNotEmpty(url, \"url\");\r\n        this.url = url;\r\n        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed\r\n        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.\r\n        if (typeof transportTypeOrOptions === \"object\") {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, transportTypeOrOptions);\r\n        }\r\n        else {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, { transport: transportTypeOrOptions });\r\n        }\r\n        return this;\r\n    };\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.\r\n     *\r\n     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.\r\n     */\r\n    HubConnectionBuilder.prototype.withHubProtocol = function (protocol) {\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.protocol = protocol;\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withAutomaticReconnect = function (retryDelaysOrReconnectPolicy) {\r\n        if (this.reconnectPolicy) {\r\n            throw new Error(\"A reconnectPolicy has already been set.\");\r\n        }\r\n        if (!retryDelaysOrReconnectPolicy) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy();\r\n        }\r\n        else if (Array.isArray(retryDelaysOrReconnectPolicy)) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);\r\n        }\r\n        else {\r\n            this.reconnectPolicy = retryDelaysOrReconnectPolicy;\r\n        }\r\n        return this;\r\n    };\r\n    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.\r\n     *\r\n     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.\r\n     */\r\n    HubConnectionBuilder.prototype.build = function () {\r\n        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one\r\n        // provided to configureLogger\r\n        var httpConnectionOptions = this.httpConnectionOptions || {};\r\n        // If it's 'null', the user **explicitly** asked for null, don't mess with it.\r\n        if (httpConnectionOptions.logger === undefined) {\r\n            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.\r\n            httpConnectionOptions.logger = this.logger;\r\n        }\r\n        // Now create the connection\r\n        if (!this.url) {\r\n            throw new Error(\"The 'HubConnectionBuilder.withUrl' method must be called before building the connection.\");\r\n        }\r\n        var connection = new HttpConnection(this.url, httpConnectionOptions);\r\n        return HubConnection.create(connection, this.logger || NullLogger.instance, this.protocol || new JsonHubProtocol(), this.reconnectPolicy);\r\n    };\r\n    return HubConnectionBuilder;\r\n}());\r\nexport { HubConnectionBuilder };\r\nfunction isLogger(logger) {\r\n    return logger.log !== undefined;\r\n}\r\n//# sourceMappingURL=HubConnectionBuilder.js.map","import  * as signalR  from \"@microsoft/signalr\";\r\n\r\nclass serverConn {\r\n\r\n    constructor(){\r\n        this.connection  = new signalR.HubConnectionBuilder()\r\n            .configureLogging(signalR.LogLevel.Debug)\r\n            .withUrl(\"http://localhost:5000/czathub\", {\r\n                //.withUrl(\"http://192.168.0.246:5000/czathub\", {\r\n                skipNegotiation: true,\r\n                transport: signalR.HttpTransportType.WebSockets\r\n            })\r\n            .withAutomaticReconnect()\r\n            .build();\r\n    }\r\n\r\n    /** \r\n     * Pobieranie połącenia w celach doagnostycznych \r\n     * \r\n     * @returns aktialne połączenie \r\n     */\r\n    getConnection() { return this.connection }\r\n\r\n    /** \r\n     * Rozpoczęcie połączenia wyklonuje metody zależenie od wyniku\r\n     * \r\n     * @param {function} onSuccess  \r\n     * @param {function} onError \r\n     */\r\n    start(onSuccess, onError) {\r\n        this.connection.start().then( () => {\r\n            onSuccess();\r\n        }).catch ( err => {\r\n            onError(err);\r\n        });\r\n    }\r\n\r\n    /** \r\n     * wysyła żądanie logowania\r\n     * \r\n     * @param {string} username \r\n     * @param {string} password \r\n     */\r\n    login(username ,password ) {\r\n        this.connection.invoke(\"Login\",username,password)\r\n            .catch(err => console.error(err.toString()));\r\n    }\r\n\r\n    /**\r\n     * Wwysyła żądanie pobrania listy użytkowników\r\n     */\r\n    getUsers() { \r\n        \r\n        this.connection.invoke(\"GetUsers\")\r\n            .catch(err => console.error(err.toString()));\r\n            \r\n    }\r\n\r\n    /**\r\n     * Wysyła żądanie pobrania listy grup użytkownika\r\n     */\r\n    getGroupsByUser(username) {\r\n        this.connection.invoke(\"getGroupsByUser\",username)\r\n            .catch(err => console.error(err.toString()));\r\n    }\r\n\r\n    \r\n    /**\r\n     * Włącza nasłuchwanie otrzymania statusu logowania\r\n     * \r\n     * @param {function} onSuccess \r\n     * @param {function} onError \r\n     */\r\n    onLoginStatus(onSuccess, onError) {\r\n        this.connection.on(\"LoginStatus\", function(status) {\r\n            \r\n            if (status) {\r\n                onSuccess(); \r\n            }else \r\n            {\r\n                onError();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Włącza nasłuchiwanie wiadomości przychodzących od grup\r\n     * \r\n     * @param {function} onEvent \r\n     */\r\n    onReceiveGroupMessage(onEvent) { \r\n        this.connection.on(\"ReceiveMessage\", function (destination, json) {\r\n            \r\n            onEvent(destination,json,\"group\");\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Włącza nasłuchiwanie prywatnych wiadomośic \r\n     * \r\n     * @param {function} onEvent \r\n     */\r\n    onReceivePrivateMessage(onEvent) { \r\n        this.connection.on(\"ReceivePrivateMessage\", function (destination, json) {\r\n            \r\n            onEvent(destination,json,\"user\");\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Włącza nasłuchiwanie przychodzącej listy użytkowników\r\n     * \r\n     * @param {function} onEvent \r\n     */\r\n    onReceiveUsersList(onEvent) {\r\n        this.connection.on(\"ReceiveUserList\", json => {\r\n            onEvent(json);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Włącza nasłuchiwanie przychodzącej listy grup\r\n     * \r\n     * @param {function} onEvent \r\n     */\r\n    onReceiveGroupsList(onEvent) {\r\n        this.connection.on(\"ReceiveGroupList\", json => {\r\n            onEvent(json);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Włącza nasłuchiwanie przychodzącej paczki wiadomości\r\n     * \r\n     * @param {function} onEvent \r\n     */\r\n    onReceiveMessagesPack(onEvent) {\r\n        this.connection.on(\"ReceiveMessagesByGroup\", json => {\r\n            onEvent(json);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Wysyła wiadomość do grupy\r\n     * \r\n     * @param {string} username \r\n     * @param {string} destination \r\n     * @param {string} message \r\n     * @param {string} type \r\n     */\r\n    sendGroupMessage(username, destination, message, type){ \r\n        this.connection.invoke(\"SendMessageToGroup\", username, destination, message, type)\r\n            .catch((err) => console.error(err.toString()));\r\n    }\r\n\r\n    /**\r\n     * wysyła wiadomość prywatną\r\n     * \r\n     * @param {string} username \r\n     * @param {string} destination \r\n     * @param {string} message \r\n     * @param {string} type \r\n     */\r\n    sendPrivateMessage(username, destination, message, type){\r\n        this.connection.invoke(\"SendPrivateMessage\", username, destination, message, type)\r\n        .catch((err) => console.error(err.toString()));\r\n    }\r\n    /**\r\n     * Wysyła żądanie usunięcia użytkownika z grupy\r\n     * \r\n     * @param {string} username \r\n     * @param {string} group \r\n     */\r\n    removeUserFromGroup(username, group){\r\n        this.connection.invoke(\"RemoveUserFromGroup\", username, group)\r\n            .catch(err => console.error(err.toString())); \r\n\r\n    }\r\n\r\n    /**\r\n     * Wysyła żądanie dodania użytkownika do grupy\r\n     * \r\n     * @param {string} username \r\n     * @param {string} group \r\n     */\r\n    addUserToGroup(username, group){\r\n        this.connection.invoke(\"AddUserToGroup\", username, group)\r\n            .catch(err => console.error(err.toString()));\r\n    }\r\n\r\n    /**\r\n     * Wysyła żądanie pobrania paczki wiadomości z danej konwersacji\r\n     * \r\n     * @param {string} convName \r\n     * @param {string} type \r\n     */\r\n    getMessagesByGroup(convName,type) {\r\n        this.connection.invoke(\"getMessagesByGroup\", convName, type)\r\n            .catch(err => console.error(err.toString()));\r\n    }\r\n    \r\n}\r\nexport {serverConn};"],"sourceRoot":""}