{"version":3,"sources":["webpack://Lab3ChatKlient/webpack/bootstrap","webpack://Lab3ChatKlient/webpack/runtime/define property getters","webpack://Lab3ChatKlient/webpack/runtime/hasOwnProperty shorthand","webpack://Lab3ChatKlient/webpack/runtime/make namespace object","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Errors.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/ILogger.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Loggers.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Utils.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/FetchHttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/IHubProtocol.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/XhrHttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/DefaultHttpClient.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/TextMessageFormat.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HandshakeProtocol.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/Subject.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HubConnection.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/ITransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/DefaultReconnectPolicy.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/AbortController.js","webpack://Lab3ChatKlient/./src/js/app.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/LongPollingTransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/ServerSentEventsTransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/WebSocketTransport.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HttpConnection.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/JsonHubProtocol.js","webpack://Lab3ChatKlient/./node_modules/@microsoft/signalr/dist/esm/HubConnectionBuilder.js"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","extendStatics","LogLevel","__extends","setPrototypeOf","__proto__","Array","d","b","p","__","this","constructor","create","HttpError","_super","errorMessage","statusCode","_this","trueProto","Error","TimeoutError","AbortError","__assign","assign","t","s","i","n","arguments","length","HttpResponse","statusText","content","HttpClient","url","options","send","method","post","delete","getCookieString","NullLogger","log","_logLevel","_message","instance","VERSION","Arg","isRequired","val","name","isNotEmpty","match","isIn","values","Platform","window","configurable","self","isBrowser","isWebWorker","getDataDetail","data","includeContent","detail","isArrayBuffer","byteLength","view","Uint8Array","str","forEach","num","toString","substr","formatArrayBuffer","ArrayBuffer","sendMessage","logger","transportName","httpClient","accessTokenFactory","logMessageContent","withCredentials","defaultHeaders","thisArg","_arguments","generator","_a","headers","token","_b","responseType","response","body","f","y","g","_","label","sent","trys","ops","next","verb","iterator","v","op","TypeError","done","pop","push","e","step","__generator","_c","getUserAgentHeader","Trace","P","Promise","resolve","reject","fulfilled","rejected","result","then","apply","SubjectSubscription","subject","observer","dispose","index","observers","indexOf","splice","cancelCallback","catch","ConsoleLogger","minimumLogLevel","outputConsole","console","logLevel","message","Critical","error","Date","toISOString","Warning","warn","Information","info","version","os","runtime","runtimeVersion","userAgent","majorAndMinor","userAgentHeaderName","isNode","getOsName","getRuntimeVersion","split","process","platform","versions","node","MessageType","FetchHttpClient","fetch","requireFunc","jar","CookieJar","fetchType","abortControllerType","bind","AbortController","request","abortController","timeoutId","msTimeout","e_1","payload","abortSignal","aborted","onabort","abort","timeout","setTimeout","cache","credentials","mode","redirect","signal","clearTimeout","ok","status","arrayBuffer","text","deserializeContent","cookies","getCookies","c","join","XhrHttpClient","xhr","XMLHttpRequest","open","undefined","setRequestHeader","keys","header","onload","responseText","onerror","ontimeout","DefaultHttpClient","TextMessageFormat","write","output","RecordSeparator","parse","input","messages","RecordSeparatorCode","String","fromCharCode","HandshakeProtocol","writeHandshakeRequest","handshakeRequest","JSON","stringify","parseHandshakeResponse","messageData","remainingData","Buffer","binaryData","separatorIndex","responseLength","slice","buffer","textData","substring","type","HubConnectionState","Subject","item","_i","err","complete","subscribe","HttpTransportType","TransferFormat","HubConnection","connection","protocol","reconnectPolicy","nextKeepAlive","serverTimeoutInMilliseconds","keepAliveIntervalInMilliseconds","handshakeProtocol","onreceive","processIncomingData","onclose","connectionClosed","callbacks","methods","closedCallbacks","reconnectingCallbacks","reconnectedCallbacks","invocationId","receivedHandshakeResponse","connectionState","Disconnected","connectionStarted","cachedPingMessage","writeMessage","Ping","connectionId","baseUrl","set","Reconnecting","start","startPromise","startWithStateTransitions","Connecting","Debug","startInternal","Connected","handshakePromise","e_2","stopDuringStartError","handshakeResolver","handshakeRejecter","transferFormat","cleanupTimeout","resetTimeoutPeriod","resetKeepAliveInterval","cleanupPingTimer","stop","stopPromise","stopInternal","Disconnecting","reconnectDelayHandle","completeClose","stream","methodName","args","promiseQueue","replaceStreamingParams","streams","streamIds","invocationDescriptor","createStreamInvocation","cancelInvocation","createCancelInvocation","sendWithProtocol","invocationEvent","Completion","launchStreams","sendPromise","createInvocation","invoke","on","newMethod","toLowerCase","off","handlers","removeIdx","callback","onreconnecting","onreconnected","processHandshakeResponse","messages_1","parseMessages","Invocation","invokeClientMethod","StreamItem","Close","allowReconnect","responseMessage","features","inherentKeepAlive","getTime","timeoutHandle","serverTimeout","pingServerHandle","nextPing","invocationMessage","target","m","cancelCallbacksWithError","reconnect","reconnectStartTime","previousReconnectAttempts","retryError","nextRetryDelay","e_4","now","getNextRetryDelay","previousRetryCount","elapsedMilliseconds","retryReason","nextRetryDelayInMilliseconds","nonblocking","_loop_1","streamId","createCompletionMessage","createStreamItemMessage","argument","isObservable","arg","StreamInvocation","id","CancelInvocation","DEFAULT_RETRY_DELAYS_IN_MILLISECONDS","DefaultReconnectPolicy","retryDelays","concat","retryContext","username","isAborted","LongPollingTransport","pollAbort","running","connect","pollOptions","pollUrl","Binary","getAccessToken","updateHeaderToken","closeError","receiving","poll","pollAborted","raiseOnClose","name_1","deleteOptions","logMessage","ServerSentEventsTransport","eventSourceConstructor","encodeURIComponent","opened","Text","eventSource","Cookie","onmessage","close","onopen","WebSocketTransport","webSocketConstructor","webSocket","replace","binaryType","_event","event","ErrorEvent","readyState","OPEN","isCloseEvent","wasClean","code","reason","HttpConnection","stopPromiseResolver","negotiateVersion","resolveUrl","webSocketModule","eventSourceModule","WebSocket","EventSource","startInternalPromise","sendQueue","TransportSendQueue","transport","stopError","stopConnection","negotiateResponse","redirects","this_1","e_3","skipNegotiation","WebSockets","constructTransport","startTransport","accessToken_1","getNegotiationResponse","ProtocolVersion","accessToken","createTransport","negotiateUrl","resolveNegotiateUrl","connectionToken","createConnectUrl","requestedTransport","requestedTransferFormat","connectUrl","transportExceptions","transports","negotiate","transports_1","endpoint","transportOrError","ex_1","ex_2","isITransport","availableTransports","resolveTransportOrError","ServerSentEvents","LongPolling","actualTransport","transportMatches","transferFormats","map","ex","lastIndexOf","document","aTag","createElement","href","executing","sendBufferedData","PromiseSource","transportResult","sendLoopPromise","sendLoop","bufferData","promise","error_1","concatBuffers","arrayBuffers","totalLength","reduce","a","offset","arrayBuffers_1","resolver","rejecter","JsonHubProtocol","hubMessages","parsedMessage","isInvocationMessage","isStreamItemMessage","isCompletionMessage","assertNotEmptyString","LogLevelNameMapping","trace","debug","information","warning","critical","none","None","HubConnectionBuilder","configureLogging","logging","mapping","parseLogLevel","withUrl","transportTypeOrOptions","httpConnectionOptions","withHubProtocol","withAutomaticReconnect","retryDelaysOrReconnectPolicy","isArray","build","base64","byte","selected","loginBtn","querySelector","unseen","Set","signalR","disabled","style","color","addEventListener","preventDefault","click","dir","prepareWindow","parentNode","children","el","remove","container","appPanel","groupsList","usersList","messagesView","messageInput","imageInput","breakLine","div1","div2","div3","divBox","width","display","classList","add","height","innerHTML","accept","appendChild","destination","json","msg","sender","float","textAlign","marginRight","marginLeft","scrollTop","scrollHeight","getElementById","buildUsersList","buildGroupsList","conv","showMessages","addToGroup","toBase64","files","user","Users","has","isActive","getSelected","group","flag","Groups","abortion","sel","buildConversation","groupInput","joinBTN","placeholder","convName","file","reader","FileReader","onloadend","readAsDataURL"],"mappings":"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","file":"bundle.min.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\n/** Error thrown when an HTTP request fails. */\r\nvar HttpError = /** @class */ (function (_super) {\r\n    __extends(HttpError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     * @param {number} statusCode The HTTP status code represented by this error.\r\n     */\r\n    function HttpError(errorMessage, statusCode) {\r\n        var _newTarget = this.constructor;\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        _this.statusCode = statusCode;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return HttpError;\r\n}(Error));\r\nexport { HttpError };\r\n/** Error thrown when a timeout elapses. */\r\nvar TimeoutError = /** @class */ (function (_super) {\r\n    __extends(TimeoutError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function TimeoutError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"A timeout occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return TimeoutError;\r\n}(Error));\r\nexport { TimeoutError };\r\n/** Error thrown when an action is aborted. */\r\nvar AbortError = /** @class */ (function (_super) {\r\n    __extends(AbortError, _super);\r\n    /** Constructs a new instance of {@link AbortError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function AbortError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"An abort occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return AbortError;\r\n}(Error));\r\nexport { AbortError };\r\n//# sourceMappingURL=Errors.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.\r\n/** Indicates the severity of a log message.\r\n *\r\n * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.\r\n */\r\nexport var LogLevel;\r\n(function (LogLevel) {\r\n    /** Log level for very low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Trace\"] = 0] = \"Trace\";\r\n    /** Log level for low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Debug\"] = 1] = \"Debug\";\r\n    /** Log level for informational diagnostic messages. */\r\n    LogLevel[LogLevel[\"Information\"] = 2] = \"Information\";\r\n    /** Log level for diagnostic messages that indicate a non-fatal problem. */\r\n    LogLevel[LogLevel[\"Warning\"] = 3] = \"Warning\";\r\n    /** Log level for diagnostic messages that indicate a failure in the current operation. */\r\n    LogLevel[LogLevel[\"Error\"] = 4] = \"Error\";\r\n    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */\r\n    LogLevel[LogLevel[\"Critical\"] = 5] = \"Critical\";\r\n    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */\r\n    LogLevel[LogLevel[\"None\"] = 6] = \"None\";\r\n})(LogLevel || (LogLevel = {}));\r\n//# sourceMappingURL=ILogger.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\n/** Represents an HTTP response. */\r\nvar HttpResponse = /** @class */ (function () {\r\n    function HttpResponse(statusCode, statusText, content) {\r\n        this.statusCode = statusCode;\r\n        this.statusText = statusText;\r\n        this.content = content;\r\n    }\r\n    return HttpResponse;\r\n}());\r\nexport { HttpResponse };\r\n/** Abstraction over an HTTP client.\r\n *\r\n * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.\r\n */\r\nvar HttpClient = /** @class */ (function () {\r\n    function HttpClient() {\r\n    }\r\n    HttpClient.prototype.get = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"GET\", url: url }));\r\n    };\r\n    HttpClient.prototype.post = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"POST\", url: url }));\r\n    };\r\n    HttpClient.prototype.delete = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"DELETE\", url: url }));\r\n    };\r\n    /** Gets all cookies that apply to the specified URL.\r\n     *\r\n     * @param url The URL that the cookies are valid for.\r\n     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.\r\n     */\r\n    // @ts-ignore\r\n    HttpClient.prototype.getCookieString = function (url) {\r\n        return \"\";\r\n    };\r\n    return HttpClient;\r\n}());\r\nexport { HttpClient };\r\n//# sourceMappingURL=HttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** A logger that does nothing when log messages are sent to it. */\r\nvar NullLogger = /** @class */ (function () {\r\n    function NullLogger() {\r\n    }\r\n    /** @inheritDoc */\r\n    // tslint:disable-next-line\r\n    NullLogger.prototype.log = function (_logLevel, _message) {\r\n    };\r\n    /** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */\r\n    NullLogger.instance = new NullLogger();\r\n    return NullLogger;\r\n}());\r\nexport { NullLogger };\r\n//# sourceMappingURL=Loggers.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\nexport var VERSION = \"5.0.7\";\r\n/** @private */\r\nvar Arg = /** @class */ (function () {\r\n    function Arg() {\r\n    }\r\n    Arg.isRequired = function (val, name) {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(\"The '\" + name + \"' argument is required.\");\r\n        }\r\n    };\r\n    Arg.isNotEmpty = function (val, name) {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(\"The '\" + name + \"' argument should not be empty.\");\r\n        }\r\n    };\r\n    Arg.isIn = function (val, values, name) {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(\"Unknown \" + name + \" value: \" + val + \".\");\r\n        }\r\n    };\r\n    return Arg;\r\n}());\r\nexport { Arg };\r\n/** @private */\r\nvar Platform = /** @class */ (function () {\r\n    function Platform() {\r\n    }\r\n    Object.defineProperty(Platform, \"isBrowser\", {\r\n        get: function () {\r\n            return typeof window === \"object\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isWebWorker\", {\r\n        get: function () {\r\n            return typeof self === \"object\" && \"importScripts\" in self;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isNode\", {\r\n        get: function () {\r\n            return !this.isBrowser && !this.isWebWorker;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Platform;\r\n}());\r\nexport { Platform };\r\n/** @private */\r\nexport function getDataDetail(data, includeContent) {\r\n    var detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = \"Binary data of length \" + data.byteLength;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + formatArrayBuffer(data) + \"'\";\r\n        }\r\n    }\r\n    else if (typeof data === \"string\") {\r\n        detail = \"String data of length \" + data.length;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + data + \"'\";\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n/** @private */\r\nexport function formatArrayBuffer(data) {\r\n    var view = new Uint8Array(data);\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    var str = \"\";\r\n    view.forEach(function (num) {\r\n        var pad = num < 16 ? \"0\" : \"\";\r\n        str += \"0x\" + pad + num.toString(16) + \" \";\r\n    });\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val) {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n/** @private */\r\nexport function sendMessage(logger, transportName, httpClient, url, accessTokenFactory, content, logMessageContent, withCredentials, defaultHeaders) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, headers, token, _b, name, value, responseType, response;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    headers = {};\r\n                    if (!accessTokenFactory) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, accessTokenFactory()];\r\n                case 1:\r\n                    token = _c.sent();\r\n                    if (token) {\r\n                        headers = (_a = {},\r\n                            _a[\"Authorization\"] = \"Bearer \" + token,\r\n                            _a);\r\n                    }\r\n                    _c.label = 2;\r\n                case 2:\r\n                    _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                    headers[name] = value;\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) sending data. \" + getDataDetail(content, logMessageContent) + \".\");\r\n                    responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n                    return [4 /*yield*/, httpClient.post(url, {\r\n                            content: content,\r\n                            headers: __assign({}, headers, defaultHeaders),\r\n                            responseType: responseType,\r\n                            withCredentials: withCredentials,\r\n                        })];\r\n                case 3:\r\n                    response = _c.sent();\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) request complete. Response status: \" + response.statusCode + \".\");\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** @private */\r\nexport function createLogger(logger) {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n    if (logger.log) {\r\n        return logger;\r\n    }\r\n    return new ConsoleLogger(logger);\r\n}\r\n/** @private */\r\nvar SubjectSubscription = /** @class */ (function () {\r\n    function SubjectSubscription(subject, observer) {\r\n        this.subject = subject;\r\n        this.observer = observer;\r\n    }\r\n    SubjectSubscription.prototype.dispose = function () {\r\n        var index = this.subject.observers.indexOf(this.observer);\r\n        if (index > -1) {\r\n            this.subject.observers.splice(index, 1);\r\n        }\r\n        if (this.subject.observers.length === 0 && this.subject.cancelCallback) {\r\n            this.subject.cancelCallback().catch(function (_) { });\r\n        }\r\n    };\r\n    return SubjectSubscription;\r\n}());\r\nexport { SubjectSubscription };\r\n/** @private */\r\nvar ConsoleLogger = /** @class */ (function () {\r\n    function ConsoleLogger(minimumLogLevel) {\r\n        this.minimumLogLevel = minimumLogLevel;\r\n        this.outputConsole = console;\r\n    }\r\n    ConsoleLogger.prototype.log = function (logLevel, message) {\r\n        if (logLevel >= this.minimumLogLevel) {\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.outputConsole.error(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.outputConsole.warn(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.outputConsole.info(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.outputConsole.log(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    return ConsoleLogger;\r\n}());\r\nexport { ConsoleLogger };\r\n/** @private */\r\nexport function getUserAgentHeader() {\r\n    var userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion())];\r\n}\r\n/** @private */\r\nexport function constructUserAgent(version, os, runtime, runtimeVersion) {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    var userAgent = \"Microsoft SignalR/\";\r\n    var majorAndMinor = version.split(\".\");\r\n    userAgent += majorAndMinor[0] + \".\" + majorAndMinor[1];\r\n    userAgent += \" (\" + version + \"; \";\r\n    if (os && os !== \"\") {\r\n        userAgent += os + \"; \";\r\n    }\r\n    else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n    userAgent += \"\" + runtime;\r\n    if (runtimeVersion) {\r\n        userAgent += \"; \" + runtimeVersion;\r\n    }\r\n    else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\nfunction getOsName() {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    }\r\n    else {\r\n        return \"\";\r\n    }\r\n}\r\nfunction getRuntimeVersion() {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\nfunction getRuntime() {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    }\r\n    else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n//# sourceMappingURL=Utils.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Platform } from \"./Utils\";\r\nvar FetchHttpClient = /** @class */ (function (_super) {\r\n    __extends(FetchHttpClient, _super);\r\n    function FetchHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        if (typeof fetch === \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests\r\n            _this.jar = new (requireFunc(\"tough-cookie\")).CookieJar();\r\n            _this.fetchType = requireFunc(\"node-fetch\");\r\n            // node-fetch doesn't have a nice API for getting and setting cookies\r\n            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one\r\n            _this.fetchType = requireFunc(\"fetch-cookie\")(_this.fetchType, _this.jar);\r\n            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide\r\n            _this.abortControllerType = requireFunc(\"abort-controller\");\r\n        }\r\n        else {\r\n            _this.fetchType = fetch.bind(self);\r\n            _this.abortControllerType = AbortController;\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    FetchHttpClient.prototype.send = function (request) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var abortController, error, timeoutId, msTimeout, response, e_1, content, payload;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Check that abort was not signaled before calling send\r\n                        if (request.abortSignal && request.abortSignal.aborted) {\r\n                            throw new AbortError();\r\n                        }\r\n                        if (!request.method) {\r\n                            throw new Error(\"No method defined.\");\r\n                        }\r\n                        if (!request.url) {\r\n                            throw new Error(\"No url defined.\");\r\n                        }\r\n                        abortController = new this.abortControllerType();\r\n                        // Hook our abortSignal into the abort controller\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = function () {\r\n                                abortController.abort();\r\n                                error = new AbortError();\r\n                            };\r\n                        }\r\n                        timeoutId = null;\r\n                        if (request.timeout) {\r\n                            msTimeout = request.timeout;\r\n                            timeoutId = setTimeout(function () {\r\n                                abortController.abort();\r\n                                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                                error = new TimeoutError();\r\n                            }, msTimeout);\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, 4, 5]);\r\n                        return [4 /*yield*/, this.fetchType(request.url, {\r\n                                body: request.content,\r\n                                cache: \"no-cache\",\r\n                                credentials: request.withCredentials === true ? \"include\" : \"same-origin\",\r\n                                headers: __assign({ \"Content-Type\": \"text/plain;charset=UTF-8\", \"X-Requested-With\": \"XMLHttpRequest\" }, request.headers),\r\n                                method: request.method,\r\n                                mode: \"cors\",\r\n                                redirect: \"manual\",\r\n                                signal: abortController.signal,\r\n                            })];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        if (error) {\r\n                            throw error;\r\n                        }\r\n                        this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + e_1 + \".\");\r\n                        throw e_1;\r\n                    case 4:\r\n                        if (timeoutId) {\r\n                            clearTimeout(timeoutId);\r\n                        }\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = null;\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 5:\r\n                        if (!response.ok) {\r\n                            throw new HttpError(response.statusText, response.status);\r\n                        }\r\n                        content = deserializeContent(response, request.responseType);\r\n                        return [4 /*yield*/, content];\r\n                    case 6:\r\n                        payload = _a.sent();\r\n                        return [2 /*return*/, new HttpResponse(response.status, response.statusText, payload)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    FetchHttpClient.prototype.getCookieString = function (url) {\r\n        var cookies = \"\";\r\n        if (Platform.isNode && this.jar) {\r\n            // @ts-ignore: unused variable\r\n            this.jar.getCookies(url, function (e, c) { return cookies = c.join(\"; \"); });\r\n        }\r\n        return cookies;\r\n    };\r\n    return FetchHttpClient;\r\n}(HttpClient));\r\nexport { FetchHttpClient };\r\nfunction deserializeContent(response, responseType) {\r\n    var content;\r\n    switch (responseType) {\r\n        case \"arraybuffer\":\r\n            content = response.arrayBuffer();\r\n            break;\r\n        case \"text\":\r\n            content = response.text();\r\n            break;\r\n        case \"blob\":\r\n        case \"document\":\r\n        case \"json\":\r\n            throw new Error(responseType + \" is not supported.\");\r\n        default:\r\n            content = response.text();\r\n            break;\r\n    }\r\n    return content;\r\n}\r\n//# sourceMappingURL=FetchHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** Defines the type of a Hub Message. */\r\nexport var MessageType;\r\n(function (MessageType) {\r\n    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */\r\n    MessageType[MessageType[\"Invocation\"] = 1] = \"Invocation\";\r\n    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */\r\n    MessageType[MessageType[\"StreamItem\"] = 2] = \"StreamItem\";\r\n    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */\r\n    MessageType[MessageType[\"Completion\"] = 3] = \"Completion\";\r\n    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */\r\n    MessageType[MessageType[\"StreamInvocation\"] = 4] = \"StreamInvocation\";\r\n    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */\r\n    MessageType[MessageType[\"CancelInvocation\"] = 5] = \"CancelInvocation\";\r\n    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */\r\n    MessageType[MessageType[\"Ping\"] = 6] = \"Ping\";\r\n    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */\r\n    MessageType[MessageType[\"Close\"] = 7] = \"Close\";\r\n})(MessageType || (MessageType = {}));\r\n//# sourceMappingURL=IHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nvar XhrHttpClient = /** @class */ (function (_super) {\r\n    __extends(XhrHttpClient, _super);\r\n    function XhrHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    XhrHttpClient.prototype.send = function (request) {\r\n        var _this = this;\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open(request.method, request.url, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            // Explicitly setting the Content-Type header for React Native on Android platform.\r\n            xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n            var headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach(function (header) {\r\n                    xhr.setRequestHeader(header, headers[header]);\r\n                });\r\n            }\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = function () {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n            xhr.onload = function () {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                }\r\n                else {\r\n                    reject(new HttpError(xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n            xhr.onerror = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + xhr.status + \": \" + xhr.statusText + \".\");\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n            xhr.ontimeout = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                reject(new TimeoutError());\r\n            };\r\n            xhr.send(request.content || \"\");\r\n        });\r\n    };\r\n    return XhrHttpClient;\r\n}(HttpClient));\r\nexport { XhrHttpClient };\r\n//# sourceMappingURL=XhrHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError } from \"./Errors\";\r\nimport { FetchHttpClient } from \"./FetchHttpClient\";\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { Platform } from \"./Utils\";\r\nimport { XhrHttpClient } from \"./XhrHttpClient\";\r\n/** Default implementation of {@link @microsoft/signalr.HttpClient}. */\r\nvar DefaultHttpClient = /** @class */ (function (_super) {\r\n    __extends(DefaultHttpClient, _super);\r\n    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */\r\n    function DefaultHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        if (typeof fetch !== \"undefined\" || Platform.isNode) {\r\n            _this.httpClient = new FetchHttpClient(logger);\r\n        }\r\n        else if (typeof XMLHttpRequest !== \"undefined\") {\r\n            _this.httpClient = new XhrHttpClient(logger);\r\n        }\r\n        else {\r\n            throw new Error(\"No usable HttpClient found.\");\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    DefaultHttpClient.prototype.send = function (request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return this.httpClient.send(request);\r\n    };\r\n    DefaultHttpClient.prototype.getCookieString = function (url) {\r\n        return this.httpClient.getCookieString(url);\r\n    };\r\n    return DefaultHttpClient;\r\n}(HttpClient));\r\nexport { DefaultHttpClient };\r\n//# sourceMappingURL=DefaultHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Not exported from index\r\n/** @private */\r\nvar TextMessageFormat = /** @class */ (function () {\r\n    function TextMessageFormat() {\r\n    }\r\n    TextMessageFormat.write = function (output) {\r\n        return \"\" + output + TextMessageFormat.RecordSeparator;\r\n    };\r\n    TextMessageFormat.parse = function (input) {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error(\"Message is incomplete.\");\r\n        }\r\n        var messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    };\r\n    TextMessageFormat.RecordSeparatorCode = 0x1e;\r\n    TextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n    return TextMessageFormat;\r\n}());\r\nexport { TextMessageFormat };\r\n//# sourceMappingURL=TextMessageFormat.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nvar HandshakeProtocol = /** @class */ (function () {\r\n    function HandshakeProtocol() {\r\n    }\r\n    // Handshake request is always JSON\r\n    HandshakeProtocol.prototype.writeHandshakeRequest = function (handshakeRequest) {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    };\r\n    HandshakeProtocol.prototype.parseHandshakeResponse = function (data) {\r\n        var responseMessage;\r\n        var messageData;\r\n        var remainingData;\r\n        if (isArrayBuffer(data) || (typeof Buffer !== \"undefined\" && data instanceof Buffer)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            var binaryData = new Uint8Array(data);\r\n            var separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, binaryData.slice(0, responseLength));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        }\r\n        else {\r\n            var textData = data;\r\n            var separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n        // At this point we should have just the single handshake message\r\n        var messages = TextMessageFormat.parse(messageData);\r\n        var response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        responseMessage = response;\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    };\r\n    return HandshakeProtocol;\r\n}());\r\nexport { HandshakeProtocol };\r\n//# sourceMappingURL=HandshakeProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { SubjectSubscription } from \"./Utils\";\r\n/** Stream implementation to stream items to the server. */\r\nvar Subject = /** @class */ (function () {\r\n    function Subject() {\r\n        this.observers = [];\r\n    }\r\n    Subject.prototype.next = function (item) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            observer.next(item);\r\n        }\r\n    };\r\n    Subject.prototype.error = function (err) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.complete = function () {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.subscribe = function (observer) {\r\n        this.observers.push(observer);\r\n        return new SubjectSubscription(this, observer);\r\n    };\r\n    return Subject;\r\n}());\r\nexport { Subject };\r\n//# sourceMappingURL=Subject.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { HandshakeProtocol } from \"./HandshakeProtocol\";\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Subject } from \"./Subject\";\r\nimport { Arg } from \"./Utils\";\r\nvar DEFAULT_TIMEOUT_IN_MS = 30 * 1000;\r\nvar DEFAULT_PING_INTERVAL_IN_MS = 15 * 1000;\r\n/** Describes the current state of the {@link HubConnection} to the server. */\r\nexport var HubConnectionState;\r\n(function (HubConnectionState) {\r\n    /** The hub connection is disconnected. */\r\n    HubConnectionState[\"Disconnected\"] = \"Disconnected\";\r\n    /** The hub connection is connecting. */\r\n    HubConnectionState[\"Connecting\"] = \"Connecting\";\r\n    /** The hub connection is connected. */\r\n    HubConnectionState[\"Connected\"] = \"Connected\";\r\n    /** The hub connection is disconnecting. */\r\n    HubConnectionState[\"Disconnecting\"] = \"Disconnecting\";\r\n    /** The hub connection is reconnecting. */\r\n    HubConnectionState[\"Reconnecting\"] = \"Reconnecting\";\r\n})(HubConnectionState || (HubConnectionState = {}));\r\n/** Represents a connection to a SignalR Hub. */\r\nvar HubConnection = /** @class */ (function () {\r\n    function HubConnection(connection, logger, protocol, reconnectPolicy) {\r\n        var _this = this;\r\n        this.nextKeepAlive = 0;\r\n        Arg.isRequired(connection, \"connection\");\r\n        Arg.isRequired(logger, \"logger\");\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.serverTimeoutInMilliseconds = DEFAULT_TIMEOUT_IN_MS;\r\n        this.keepAliveIntervalInMilliseconds = DEFAULT_PING_INTERVAL_IN_MS;\r\n        this.logger = logger;\r\n        this.protocol = protocol;\r\n        this.connection = connection;\r\n        this.reconnectPolicy = reconnectPolicy;\r\n        this.handshakeProtocol = new HandshakeProtocol();\r\n        this.connection.onreceive = function (data) { return _this.processIncomingData(data); };\r\n        this.connection.onclose = function (error) { return _this.connectionClosed(error); };\r\n        this.callbacks = {};\r\n        this.methods = {};\r\n        this.closedCallbacks = [];\r\n        this.reconnectingCallbacks = [];\r\n        this.reconnectedCallbacks = [];\r\n        this.invocationId = 0;\r\n        this.receivedHandshakeResponse = false;\r\n        this.connectionState = HubConnectionState.Disconnected;\r\n        this.connectionStarted = false;\r\n        this.cachedPingMessage = this.protocol.writeMessage({ type: MessageType.Ping });\r\n    }\r\n    /** @internal */\r\n    // Using a public static factory method means we can have a private constructor and an _internal_\r\n    // create method that can be used by HubConnectionBuilder. An \"internal\" constructor would just\r\n    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a\r\n    // public parameter-less constructor.\r\n    HubConnection.create = function (connection, logger, protocol, reconnectPolicy) {\r\n        return new HubConnection(connection, logger, protocol, reconnectPolicy);\r\n    };\r\n    Object.defineProperty(HubConnection.prototype, \"state\", {\r\n        /** Indicates the state of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connectionState;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"connectionId\", {\r\n        /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either\r\n         *  in the disconnected state or if the negotiation step was skipped.\r\n         */\r\n        get: function () {\r\n            return this.connection ? (this.connection.connectionId || null) : null;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"baseUrl\", {\r\n        /** Indicates the url of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connection.baseUrl || \"\";\r\n        },\r\n        /**\r\n         * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or\r\n         * Reconnecting states.\r\n         * @param {string} url The url to connect to.\r\n         */\r\n        set: function (url) {\r\n            if (this.connectionState !== HubConnectionState.Disconnected && this.connectionState !== HubConnectionState.Reconnecting) {\r\n                throw new Error(\"The HubConnection must be in the Disconnected or Reconnecting state to change the url.\");\r\n            }\r\n            if (!url) {\r\n                throw new Error(\"The HubConnection url must be a valid url.\");\r\n            }\r\n            this.connection.baseUrl = url;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** Starts the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.start = function () {\r\n        this.startPromise = this.startWithStateTransitions();\r\n        return this.startPromise;\r\n    };\r\n    HubConnection.prototype.startWithStateTransitions = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState !== HubConnectionState.Disconnected) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start a HubConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Connecting;\r\n                        this.logger.log(LogLevel.Debug, \"Starting HubConnection.\");\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.connectionStarted = true;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection connected successfully.\");\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        this.connectionState = HubConnectionState.Disconnected;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection failed to start successfully because of error '\" + e_1 + \"'.\");\r\n                        return [2 /*return*/, Promise.reject(e_1)];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.startInternal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var handshakePromise, handshakeRequest, e_2;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.stopDuringStartError = undefined;\r\n                        this.receivedHandshakeResponse = false;\r\n                        handshakePromise = new Promise(function (resolve, reject) {\r\n                            _this.handshakeResolver = resolve;\r\n                            _this.handshakeRejecter = reject;\r\n                        });\r\n                        return [4 /*yield*/, this.connection.start(this.protocol.transferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 7]);\r\n                        handshakeRequest = {\r\n                            protocol: this.protocol.name,\r\n                            version: this.protocol.version,\r\n                        };\r\n                        this.logger.log(LogLevel.Debug, \"Sending handshake request.\");\r\n                        return [4 /*yield*/, this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(handshakeRequest))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Using HubProtocol '\" + this.protocol.name + \"'.\");\r\n                        // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n                        this.cleanupTimeout();\r\n                        this.resetTimeoutPeriod();\r\n                        this.resetKeepAliveInterval();\r\n                        return [4 /*yield*/, handshakePromise];\r\n                    case 4:\r\n                        _a.sent();\r\n                        // It's important to check the stopDuringStartError instead of just relying on the handshakePromise\r\n                        // being rejected on close, because this continuation can run after both the handshake completed successfully\r\n                        // and the connection was closed.\r\n                        if (this.stopDuringStartError) {\r\n                            // It's important to throw instead of returning a rejected promise, because we don't want to allow any state\r\n                            // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise\r\n                            // will cause the calling continuation to get scheduled to run later.\r\n                            throw this.stopDuringStartError;\r\n                        }\r\n                        return [3 /*break*/, 7];\r\n                    case 5:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Debug, \"Hub handshake failed with error '\" + e_2 + \"' during start(). Stopping HubConnection.\");\r\n                        this.cleanupTimeout();\r\n                        this.cleanupPingTimer();\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        return [4 /*yield*/, this.connection.stop(e_2)];\r\n                    case 6:\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        _a.sent();\r\n                        throw e_2;\r\n                    case 7: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /** Stops the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var startPromise, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        startPromise = this.startPromise;\r\n                        this.stopPromise = this.stopInternal();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        // Awaiting undefined continues immediately\r\n                        return [4 /*yield*/, startPromise];\r\n                    case 3:\r\n                        // Awaiting undefined continues immediately\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        e_3 = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.stopInternal = function (error) {\r\n        if (this.connectionState === HubConnectionState.Disconnected) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HubConnection.stop(\" + error + \") ignored because it is already in the disconnected state.\");\r\n            return Promise.resolve();\r\n        }\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n            return this.stopPromise;\r\n        }\r\n        this.connectionState = HubConnectionState.Disconnecting;\r\n        this.logger.log(LogLevel.Debug, \"Stopping HubConnection.\");\r\n        if (this.reconnectDelayHandle) {\r\n            // We're in a reconnect delay which means the underlying connection is currently already stopped.\r\n            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and\r\n            // fire the onclose callbacks.\r\n            this.logger.log(LogLevel.Debug, \"Connection stopped during reconnect delay. Done reconnecting.\");\r\n            clearTimeout(this.reconnectDelayHandle);\r\n            this.reconnectDelayHandle = undefined;\r\n            this.completeClose();\r\n            return Promise.resolve();\r\n        }\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        this.stopDuringStartError = error || new Error(\"The connection was stopped before the hub handshake could complete.\");\r\n        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails\r\n        // or the onclose callback is invoked. The onclose callback will transition the HubConnection\r\n        // to the disconnected state if need be before HttpConnection.stop() completes.\r\n        return this.connection.stop(error);\r\n    };\r\n    /** Invokes a streaming hub method on the server using the specified name and arguments.\r\n     *\r\n     * @typeparam T The type of the items returned by the server.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.\r\n     */\r\n    HubConnection.prototype.stream = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createStreamInvocation(methodName, args, streamIds);\r\n        var promiseQueue;\r\n        var subject = new Subject();\r\n        subject.cancelCallback = function () {\r\n            var cancelInvocation = _this.createCancelInvocation(invocationDescriptor.invocationId);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n            return promiseQueue.then(function () {\r\n                return _this.sendWithProtocol(cancelInvocation);\r\n            });\r\n        };\r\n        this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            }\r\n            else if (invocationEvent) {\r\n                // invocationEvent will not be null when an error is not passed to the callback\r\n                if (invocationEvent.type === MessageType.Completion) {\r\n                    if (invocationEvent.error) {\r\n                        subject.error(new Error(invocationEvent.error));\r\n                    }\r\n                    else {\r\n                        subject.complete();\r\n                    }\r\n                }\r\n                else {\r\n                    subject.next((invocationEvent.item));\r\n                }\r\n            }\r\n        };\r\n        promiseQueue = this.sendWithProtocol(invocationDescriptor)\r\n            .catch(function (e) {\r\n            subject.error(e);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n        });\r\n        this.launchStreams(streams, promiseQueue);\r\n        return subject;\r\n    };\r\n    HubConnection.prototype.sendMessage = function (message) {\r\n        this.resetKeepAliveInterval();\r\n        return this.connection.send(message);\r\n    };\r\n    /**\r\n     * Sends a js object to the server.\r\n     * @param message The js object to serialize and send.\r\n     */\r\n    HubConnection.prototype.sendWithProtocol = function (message) {\r\n        return this.sendMessage(this.protocol.writeMessage(message));\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.\r\n     *\r\n     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still\r\n     * be processing the invocation.\r\n     *\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.send = function (methodName) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var sendPromise = this.sendWithProtocol(this.createInvocation(methodName, args, true, streamIds));\r\n        this.launchStreams(streams, sendPromise);\r\n        return sendPromise;\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments.\r\n     *\r\n     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise\r\n     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of\r\n     * resolving the Promise.\r\n     *\r\n     * @typeparam T The expected return type.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.\r\n     */\r\n    HubConnection.prototype.invoke = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createInvocation(methodName, args, false, streamIds);\r\n        var p = new Promise(function (resolve, reject) {\r\n            // invocationId will always have a value for a non-blocking invocation\r\n            _this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n                else if (invocationEvent) {\r\n                    // invocationEvent will not be null when an error is not passed to the callback\r\n                    if (invocationEvent.type === MessageType.Completion) {\r\n                        if (invocationEvent.error) {\r\n                            reject(new Error(invocationEvent.error));\r\n                        }\r\n                        else {\r\n                            resolve(invocationEvent.result);\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(new Error(\"Unexpected message type: \" + invocationEvent.type));\r\n                    }\r\n                }\r\n            };\r\n            var promiseQueue = _this.sendWithProtocol(invocationDescriptor)\r\n                .catch(function (e) {\r\n                reject(e);\r\n                // invocationId will always have a value for a non-blocking invocation\r\n                delete _this.callbacks[invocationDescriptor.invocationId];\r\n            });\r\n            _this.launchStreams(streams, promiseQueue);\r\n        });\r\n        return p;\r\n    };\r\n    /** Registers a handler that will be invoked when the hub method with the specified method name is invoked.\r\n     *\r\n     * @param {string} methodName The name of the hub method to define.\r\n     * @param {Function} newMethod The handler that will be raised when the hub method is invoked.\r\n     */\r\n    HubConnection.prototype.on = function (methodName, newMethod) {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        if (!this.methods[methodName]) {\r\n            this.methods[methodName] = [];\r\n        }\r\n        // Preventing adding the same handler multiple times.\r\n        if (this.methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n        this.methods[methodName].push(newMethod);\r\n    };\r\n    HubConnection.prototype.off = function (methodName, method) {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        var handlers = this.methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            var removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this.methods[methodName];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            delete this.methods[methodName];\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection is closed.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).\r\n     */\r\n    HubConnection.prototype.onclose = function (callback) {\r\n        if (callback) {\r\n            this.closedCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection starts reconnecting.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).\r\n     */\r\n    HubConnection.prototype.onreconnecting = function (callback) {\r\n        if (callback) {\r\n            this.reconnectingCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection successfully reconnects.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.\r\n     */\r\n    HubConnection.prototype.onreconnected = function (callback) {\r\n        if (callback) {\r\n            this.reconnectedCallbacks.push(callback);\r\n        }\r\n    };\r\n    HubConnection.prototype.processIncomingData = function (data) {\r\n        this.cleanupTimeout();\r\n        if (!this.receivedHandshakeResponse) {\r\n            data = this.processHandshakeResponse(data);\r\n            this.receivedHandshakeResponse = true;\r\n        }\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            var messages = this.protocol.parseMessages(data, this.logger);\r\n            for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n                var message = messages_1[_i];\r\n                switch (message.type) {\r\n                    case MessageType.Invocation:\r\n                        this.invokeClientMethod(message);\r\n                        break;\r\n                    case MessageType.StreamItem:\r\n                    case MessageType.Completion:\r\n                        var callback = this.callbacks[message.invocationId];\r\n                        if (callback) {\r\n                            if (message.type === MessageType.Completion) {\r\n                                delete this.callbacks[message.invocationId];\r\n                            }\r\n                            callback(message);\r\n                        }\r\n                        break;\r\n                    case MessageType.Ping:\r\n                        // Don't care about pings\r\n                        break;\r\n                    case MessageType.Close:\r\n                        this.logger.log(LogLevel.Information, \"Close message received from server.\");\r\n                        var error = message.error ? new Error(\"Server returned an error on close: \" + message.error) : undefined;\r\n                        if (message.allowReconnect === true) {\r\n                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,\r\n                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.\r\n                            // tslint:disable-next-line:no-floating-promises\r\n                            this.connection.stop(error);\r\n                        }\r\n                        else {\r\n                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.\r\n                            this.stopPromise = this.stopInternal(error);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        this.logger.log(LogLevel.Warning, \"Invalid message type: \" + message.type + \".\");\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this.resetTimeoutPeriod();\r\n    };\r\n    HubConnection.prototype.processHandshakeResponse = function (data) {\r\n        var _a;\r\n        var responseMessage;\r\n        var remainingData;\r\n        try {\r\n            _a = this.handshakeProtocol.parseHandshakeResponse(data), remainingData = _a[0], responseMessage = _a[1];\r\n        }\r\n        catch (e) {\r\n            var message = \"Error parsing handshake response: \" + e;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            var message = \"Server returned handshake error: \" + responseMessage.error;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Debug, \"Server handshake complete.\");\r\n        }\r\n        this.handshakeResolver();\r\n        return remainingData;\r\n    };\r\n    HubConnection.prototype.resetKeepAliveInterval = function () {\r\n        if (this.connection.features.inherentKeepAlive) {\r\n            return;\r\n        }\r\n        // Set the time we want the next keep alive to be sent\r\n        // Timer will be setup on next message receive\r\n        this.nextKeepAlive = new Date().getTime() + this.keepAliveIntervalInMilliseconds;\r\n        this.cleanupPingTimer();\r\n    };\r\n    HubConnection.prototype.resetTimeoutPeriod = function () {\r\n        var _this = this;\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this.timeoutHandle = setTimeout(function () { return _this.serverTimeout(); }, this.serverTimeoutInMilliseconds);\r\n            // Set keepAlive timer if there isn't one\r\n            if (this.pingServerHandle === undefined) {\r\n                var nextPing = this.nextKeepAlive - new Date().getTime();\r\n                if (nextPing < 0) {\r\n                    nextPing = 0;\r\n                }\r\n                // The timer needs to be set from a networking callback to avoid Chrome timer throttling from causing timers to run once a minute\r\n                this.pingServerHandle = setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                    var _a;\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (!(this.connectionState === HubConnectionState.Connected)) return [3 /*break*/, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4 /*yield*/, this.sendMessage(this.cachedPingMessage)];\r\n                            case 2:\r\n                                _b.sent();\r\n                                return [3 /*break*/, 4];\r\n                            case 3:\r\n                                _a = _b.sent();\r\n                                // We don't care about the error. It should be seen elsewhere in the client.\r\n                                // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering\r\n                                this.cleanupPingTimer();\r\n                                return [3 /*break*/, 4];\r\n                            case 4: return [2 /*return*/];\r\n                        }\r\n                    });\r\n                }); }, nextPing);\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.serverTimeout = function () {\r\n        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(\r\n        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.\r\n        // tslint:disable-next-line:no-floating-promises\r\n        this.connection.stop(new Error(\"Server timeout elapsed without receiving a message from the server.\"));\r\n    };\r\n    HubConnection.prototype.invokeClientMethod = function (invocationMessage) {\r\n        var _this = this;\r\n        var methods = this.methods[invocationMessage.target.toLowerCase()];\r\n        if (methods) {\r\n            try {\r\n                methods.forEach(function (m) { return m.apply(_this, invocationMessage.arguments); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"A callback for the method \" + invocationMessage.target.toLowerCase() + \" threw error '\" + e + \"'.\");\r\n            }\r\n            if (invocationMessage.invocationId) {\r\n                // This is not supported in v1. So we return an error to avoid blocking the server waiting for the response.\r\n                var message = \"Server requested a response, which is not supported in this version of the client.\";\r\n                this.logger.log(LogLevel.Error, message);\r\n                // We don't want to wait on the stop itself.\r\n                this.stopPromise = this.stopInternal(new Error(message));\r\n            }\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Warning, \"No client method with the name '\" + invocationMessage.target + \"' found.\");\r\n        }\r\n    };\r\n    HubConnection.prototype.connectionClosed = function (error) {\r\n        this.logger.log(LogLevel.Debug, \"HubConnection.connectionClosed(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.\r\n        this.stopDuringStartError = this.stopDuringStartError || error || new Error(\"The underlying connection was closed before the hub handshake could complete.\");\r\n        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.\r\n        // If it has already completed, this should just noop.\r\n        if (this.handshakeResolver) {\r\n            this.handshakeResolver();\r\n        }\r\n        this.cancelCallbacksWithError(error || new Error(\"Invocation canceled due to the underlying connection being closed.\"));\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.completeClose(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected && this.reconnectPolicy) {\r\n            // tslint:disable-next-line:no-floating-promises\r\n            this.reconnect(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected) {\r\n            this.completeClose(error);\r\n        }\r\n        // If none of the above if conditions were true were called the HubConnection must be in either:\r\n        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.\r\n        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt\r\n        //    and potentially continue the reconnect() loop.\r\n        // 3. The Disconnected state in which case we're already done.\r\n    };\r\n    HubConnection.prototype.completeClose = function (error) {\r\n        var _this = this;\r\n        if (this.connectionStarted) {\r\n            this.connectionState = HubConnectionState.Disconnected;\r\n            this.connectionStarted = false;\r\n            try {\r\n                this.closedCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"An onclose callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.reconnect = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var reconnectStartTime, previousReconnectAttempts, retryError, nextRetryDelay, e_4;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        reconnectStartTime = Date.now();\r\n                        previousReconnectAttempts = 0;\r\n                        retryError = error !== undefined ? error : new Error(\"Attempting to reconnect due to a unknown error.\");\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, 0, retryError);\r\n                        if (nextRetryDelay === null) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.\");\r\n                            this.completeClose(error);\r\n                            return [2 /*return*/];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Reconnecting;\r\n                        if (error) {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting because of error '\" + error + \"'.\");\r\n                        }\r\n                        else {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting.\");\r\n                        }\r\n                        if (this.onreconnecting) {\r\n                            try {\r\n                                this.reconnectingCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnecting callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n                            }\r\n                            // Exit early if an onreconnecting callback called connection.stop().\r\n                            if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                                this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.\");\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(nextRetryDelay !== null)) return [3 /*break*/, 7];\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt number \" + previousReconnectAttempts + \" will start in \" + nextRetryDelay + \" ms.\");\r\n                        return [4 /*yield*/, new Promise(function (resolve) {\r\n                                _this.reconnectDelayHandle = setTimeout(resolve, nextRetryDelay);\r\n                            })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.reconnectDelayHandle = undefined;\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state during reconnect delay. Done reconnecting.\");\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.logger.log(LogLevel.Information, \"HubConnection reconnected successfully.\");\r\n                        if (this.onreconnected) {\r\n                            try {\r\n                                this.reconnectedCallbacks.forEach(function (c) { return c.apply(_this, [_this.connection.connectionId]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnected callback called with connectionId '\" + this.connection.connectionId + \"; threw error '\" + e + \"'.\");\r\n                            }\r\n                        }\r\n                        return [2 /*return*/];\r\n                    case 5:\r\n                        e_4 = _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt failed because of error '\" + e_4 + \"'.\");\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection moved to the '\" + this.connectionState + \"' from the reconnecting state during reconnect attempt. Done reconnecting.\");\r\n                            // The TypeScript compiler thinks that connectionState must be Connected here. The TypeScript compiler is wrong.\r\n                            if (this.connectionState === HubConnectionState.Disconnecting) {\r\n                                this.completeClose();\r\n                            }\r\n                            return [2 /*return*/];\r\n                        }\r\n                        retryError = e_4 instanceof Error ? e_4 : new Error(e_4.toString());\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7:\r\n                        this.logger.log(LogLevel.Information, \"Reconnect retries have been exhausted after \" + (Date.now() - reconnectStartTime) + \" ms and \" + previousReconnectAttempts + \" failed attempts. Connection disconnecting.\");\r\n                        this.completeClose();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.getNextRetryDelay = function (previousRetryCount, elapsedMilliseconds, retryReason) {\r\n        try {\r\n            return this.reconnectPolicy.nextRetryDelayInMilliseconds({\r\n                elapsedMilliseconds: elapsedMilliseconds,\r\n                previousRetryCount: previousRetryCount,\r\n                retryReason: retryReason,\r\n            });\r\n        }\r\n        catch (e) {\r\n            this.logger.log(LogLevel.Error, \"IRetryPolicy.nextRetryDelayInMilliseconds(\" + previousRetryCount + \", \" + elapsedMilliseconds + \") threw error '\" + e + \"'.\");\r\n            return null;\r\n        }\r\n    };\r\n    HubConnection.prototype.cancelCallbacksWithError = function (error) {\r\n        var callbacks = this.callbacks;\r\n        this.callbacks = {};\r\n        Object.keys(callbacks)\r\n            .forEach(function (key) {\r\n            var callback = callbacks[key];\r\n            callback(null, error);\r\n        });\r\n    };\r\n    HubConnection.prototype.cleanupPingTimer = function () {\r\n        if (this.pingServerHandle) {\r\n            clearTimeout(this.pingServerHandle);\r\n            this.pingServerHandle = undefined;\r\n        }\r\n    };\r\n    HubConnection.prototype.cleanupTimeout = function () {\r\n        if (this.timeoutHandle) {\r\n            clearTimeout(this.timeoutHandle);\r\n        }\r\n    };\r\n    HubConnection.prototype.createInvocation = function (methodName, args, nonblocking, streamIds) {\r\n        if (nonblocking) {\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            var invocationId = this.invocationId;\r\n            this.invocationId++;\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.launchStreams = function (streams, promiseQueue) {\r\n        var _this = this;\r\n        if (streams.length === 0) {\r\n            return;\r\n        }\r\n        // Synchronize stream data so they arrive in-order on the server\r\n        if (!promiseQueue) {\r\n            promiseQueue = Promise.resolve();\r\n        }\r\n        var _loop_1 = function (streamId) {\r\n            streams[streamId].subscribe({\r\n                complete: function () {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId)); });\r\n                },\r\n                error: function (err) {\r\n                    var message;\r\n                    if (err instanceof Error) {\r\n                        message = err.message;\r\n                    }\r\n                    else if (err && err.toString) {\r\n                        message = err.toString();\r\n                    }\r\n                    else {\r\n                        message = \"Unknown error\";\r\n                    }\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId, message)); });\r\n                },\r\n                next: function (item) {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createStreamItemMessage(streamId, item)); });\r\n                },\r\n            });\r\n        };\r\n        // We want to iterate over the keys, since the keys are the stream ids\r\n        // tslint:disable-next-line:forin\r\n        for (var streamId in streams) {\r\n            _loop_1(streamId);\r\n        }\r\n    };\r\n    HubConnection.prototype.replaceStreamingParams = function (args) {\r\n        var streams = [];\r\n        var streamIds = [];\r\n        for (var i = 0; i < args.length; i++) {\r\n            var argument = args[i];\r\n            if (this.isObservable(argument)) {\r\n                var streamId = this.invocationId;\r\n                this.invocationId++;\r\n                // Store the stream for later use\r\n                streams[streamId] = argument;\r\n                streamIds.push(streamId.toString());\r\n                // remove stream from args\r\n                args.splice(i, 1);\r\n            }\r\n        }\r\n        return [streams, streamIds];\r\n    };\r\n    HubConnection.prototype.isObservable = function (arg) {\r\n        // This allows other stream implementations to just work (like rxjs)\r\n        return arg && arg.subscribe && typeof arg.subscribe === \"function\";\r\n    };\r\n    HubConnection.prototype.createStreamInvocation = function (methodName, args, streamIds) {\r\n        var invocationId = this.invocationId;\r\n        this.invocationId++;\r\n        if (streamIds.length !== 0) {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                streamIds: streamIds,\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n    };\r\n    HubConnection.prototype.createCancelInvocation = function (id) {\r\n        return {\r\n            invocationId: id,\r\n            type: MessageType.CancelInvocation,\r\n        };\r\n    };\r\n    HubConnection.prototype.createStreamItemMessage = function (id, item) {\r\n        return {\r\n            invocationId: id,\r\n            item: item,\r\n            type: MessageType.StreamItem,\r\n        };\r\n    };\r\n    HubConnection.prototype.createCompletionMessage = function (id, error, result) {\r\n        if (error) {\r\n            return {\r\n                error: error,\r\n                invocationId: id,\r\n                type: MessageType.Completion,\r\n            };\r\n        }\r\n        return {\r\n            invocationId: id,\r\n            result: result,\r\n            type: MessageType.Completion,\r\n        };\r\n    };\r\n    return HubConnection;\r\n}());\r\nexport { HubConnection };\r\n//# sourceMappingURL=HubConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// This will be treated as a bit flag in the future, so we keep it using power-of-two values.\r\n/** Specifies a specific HTTP transport type. */\r\nexport var HttpTransportType;\r\n(function (HttpTransportType) {\r\n    /** Specifies no transport preference. */\r\n    HttpTransportType[HttpTransportType[\"None\"] = 0] = \"None\";\r\n    /** Specifies the WebSockets transport. */\r\n    HttpTransportType[HttpTransportType[\"WebSockets\"] = 1] = \"WebSockets\";\r\n    /** Specifies the Server-Sent Events transport. */\r\n    HttpTransportType[HttpTransportType[\"ServerSentEvents\"] = 2] = \"ServerSentEvents\";\r\n    /** Specifies the Long Polling transport. */\r\n    HttpTransportType[HttpTransportType[\"LongPolling\"] = 4] = \"LongPolling\";\r\n})(HttpTransportType || (HttpTransportType = {}));\r\n/** Specifies the transfer format for a connection. */\r\nexport var TransferFormat;\r\n(function (TransferFormat) {\r\n    /** Specifies that only text data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Text\"] = 1] = \"Text\";\r\n    /** Specifies that binary data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Binary\"] = 2] = \"Binary\";\r\n})(TransferFormat || (TransferFormat = {}));\r\n//# sourceMappingURL=ITransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// 0, 2, 10, 30 second delays before reconnect attempts.\r\nvar DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];\r\n/** @private */\r\nvar DefaultReconnectPolicy = /** @class */ (function () {\r\n    function DefaultReconnectPolicy(retryDelays) {\r\n        this.retryDelays = retryDelays !== undefined ? retryDelays.concat([null]) : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;\r\n    }\r\n    DefaultReconnectPolicy.prototype.nextRetryDelayInMilliseconds = function (retryContext) {\r\n        return this.retryDelays[retryContext.previousRetryCount];\r\n    };\r\n    return DefaultReconnectPolicy;\r\n}());\r\nexport { DefaultReconnectPolicy };\r\n//# sourceMappingURL=DefaultReconnectPolicy.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don't actually ever use the API being polyfilled, we always use the polyfill because\r\n// it's a very new API right now.\r\n// Not exported from index.\r\n/** @private */\r\nvar AbortController = /** @class */ (function () {\r\n    function AbortController() {\r\n        this.isAborted = false;\r\n        this.onabort = null;\r\n    }\r\n    AbortController.prototype.abort = function () {\r\n        if (!this.isAborted) {\r\n            this.isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    };\r\n    Object.defineProperty(AbortController.prototype, \"signal\", {\r\n        get: function () {\r\n            return this;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbortController.prototype, \"aborted\", {\r\n        get: function () {\r\n            return this.isAborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return AbortController;\r\n}());\r\nexport { AbortController };\r\n//# sourceMappingURL=AbortController.js.map","\r\nimport  * as signalR  from \"@microsoft/signalr\";\r\n\r\n\r\nlet username;\r\n\r\nconst base64 = {byte:\"\"};\r\nconst selected = { item: \"none\" , type:\"none\"};\r\nlet activeUsers;\r\nconst loginBtn = document.querySelector(\".loginBtn\");\r\n\r\nconst unseen = new Set();\r\n//zbior konwersacji\r\nconst messages = new Set(); \r\n//konwersacja \r\nclass conversation{\r\n    \r\n    constructor(groupname, type) {\r\n        this.groupName = groupname;\r\n        this.type = type;\r\n        this.content = new Set();\r\n    }\r\n    addMessage(message){\r\n        this.content.add(message);\r\n    }\r\n}\r\n//wiadomosc\r\nclass message{\r\n    constructor(sender, time, message) {\r\n        this.sender = sender;\r\n        this.time = time;\r\n        this.message = message;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\nconsole.log(signalR);\r\nvar connection =connection = new signalR.HubConnectionBuilder()\r\n.configureLogging(signalR.LogLevel.Debug)\r\n.withUrl(\"http://localhost:5000/czathub\", {\r\n//.withUrl(\"http://192.168.0.246:5000/czathub\", {\r\n  skipNegotiation: true,\r\n  transport: signalR.HttpTransportType.WebSockets\r\n})\r\n.withAutomaticReconnect()\r\n.build();\r\n\r\n\r\n// wyczenie przycisku do momentu poczenia \r\nloginBtn.disabled = true;\r\n\r\n\r\n\r\n\r\n//start poczenia \r\nconnection.start().then( () => {\r\n    loginBtn.disabled = false;\r\n    \r\n    loginBtn.style.color = \"white\";\r\n    loginBtn.value=\"Start\";\r\n}).catch ( err => {\r\n    loginBtn.style.color = \"red\";\r\n    loginBtn.value=\"Conn.ERROR\";\r\n    return console.error(err.toString());\r\n});\r\n\r\nloginBtn.addEventListener(\"click\", (event) => {\r\n    username = document.querySelector(\".userNameInput\").value;\r\n    \r\n    //console.log(\"Zalogowano\");\r\n    connection.invoke(\"Login\",username, document.querySelector(\".passwordInput\").value)\r\n        .catch(err => console.error(err.toString()));\r\n    \r\n    \r\n    \r\n    event.preventDefault();\r\n\r\n    \r\n    \r\n})\r\n\r\n// klawisz enter aktywuje przycisk Start\r\ndocument.querySelector(\".userNameInput\").addEventListener(\"keyup\", (event) => {\r\n\r\n    if (event.key === 'Enter') {\r\n        event.preventDefault();\r\n        loginBtn.click();\r\n    } \r\n})\r\n\r\nconnection.on(\"LoginStatus\", function(status) {\r\n    console.dir(status);\r\n    if (status) {\r\n        prepareWindow();\r\n        connection.invoke(\"GetUsers\")\r\n            .catch(err => console.error(err.toString()));\r\n        connection.invoke(\"getGroupsByUser\",username)\r\n            .catch(err => console.error(err.toString()));\r\n    }else \r\n    {\r\n        loginBtn.style.color = \"red\";\r\n        loginBtn.value=\"ERROR\";\r\n        document.querySelector(\".passwordInput\").addEventListener(\"input\", ()=> {\r\n            loginBtn.style.color = \"white\";\r\n            loginBtn.value=\"LOGIN\";\r\n        });\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// tworzenie okna po zalogowaniu  \r\nconst prepareWindow=function() {\r\n\r\n    const children = Array.prototype.slice.call(loginBtn.parentNode.children);\r\n    children.forEach(el => el.remove());\r\n\r\n    const container = document.querySelector(\".container\");\r\n    container.remove();\r\n\r\n    const appPanel = document.createElement(\"div\");\r\n    \r\n    const groupsList = document.createElement(\"div\");\r\n    const usersList = document.createElement(\"div\");\r\n\r\n    const messagesView = document.createElement(\"div\");\r\n    const messageInput = document.createElement(\"input\");\r\n    const imageInput = document.createElement(\"input\");\r\n    const sendMessage = document.createElement(\"div\");\r\n    const breakLine = document.createElement(\"div\");\r\n    const join = document.createElement(\"div\");\r\n    \r\n    const div1 = document.createElement(\"div\");\r\n    const div2 = document.createElement(\"div\");\r\n    const div3 = document.createElement(\"div\");\r\n    const divBox = document.createElement(\"div\");\r\n\r\n    div1.style.width=\"100%\";\r\n    div1.style.display=\"flex\";\r\n    div2.style.width=\"100%\";\r\n\r\n    appPanel.classList.add(\"appPanel\");\r\n\r\n    groupsList.classList.add(\"listPanel\");\r\n    groupsList.id = \"groupsList\";\r\n    groupsList.style.height =\"400px\";\r\n\r\n    usersList.classList.add(\"listPanel\");\r\n    usersList.id = \"usersList\";\r\n\r\n    imageInput.classList.add(\"imageInput\");\r\n    messagesView.classList.add(\"messagesView\");\r\n    messageInput.classList.add(\"messageInput\");\r\n    sendMessage.classList.add(\"sendMessage\");\r\n    breakLine.classList.add(\"break\");\r\n    join.classList.add(\"joinBTN\");\r\n    divBox.classList.add(\"inputBox\");\r\n\r\n    \r\n    sendMessage.innerHTML = \"<p>SEND</p>\";\r\n    join.innerHTML = \"<p>JOIN</p>\";\r\n    //divBox.innerHTML = \"<p>M</p>\";\r\n    \r\n    imageInput.type = \"file\";\r\n    imageInput.accept = \"image/png, image/jpeg\";\r\n    \r\n\r\n    divBox.appendChild(imageInput);\r\n    container.appendChild(messagesView);\r\n    container.appendChild(breakLine);\r\n    container.appendChild(div1);\r\n    div1.appendChild(div2);\r\n    div2.appendChild(messageInput);\r\n    div1.appendChild(divBox);\r\n    div1.appendChild(sendMessage);\r\n\r\n    div3.appendChild(groupsList);\r\n    div3.appendChild(join);\r\n\r\n    appPanel.appendChild(div3);\r\n    appPanel.appendChild(container);\r\n    appPanel.appendChild(usersList);\r\n\r\n    document.querySelector(\".content\").appendChild(appPanel);\r\n    //container.appendChild(appPanel);\r\n    //container.appendChild(messegeInput);\r\n    //container.appendChild(sendMessege);\r\n\r\n    connection.on(\"ReceiveMessage\", function (destination, json) {\r\n        const message = JSON.parse(json);\r\n        console.dir(message);\r\n        const msg = document.createElement(\"p\");\r\n        if (selected.item === destination && selected.type === \"group\"){\r\n            messagesView.appendChild(msg);\r\n            if(message.sender === username) {\r\n                message.sender = \"You\";\r\n                msg.style.width=\"80%\";\r\n                msg.style.float=\"right\";\r\n                msg.style.textAlign=\"right\";\r\n                msg.style.marginRight=\"3px\";\r\n                msg.style.color=\"#03A062\";\r\n            }else{\r\n                msg.style.width=\"80%\";\r\n                msg.style.float=\"left\";\r\n                msg.style.textAlign=\"left\";\r\n                msg.style.marginLeft=\"3px\";\r\n                msg.style.color=\"white\";\r\n            }\r\n        \r\n        //skrolowanie listy wiadomoci do dou \r\n        messagesView.scrollTop = messagesView.scrollHeight;\r\n        msg.innerHTML = `<span style=\"color: #00bfff;\">${message.sender}:</span><span>${message.msg}</span>`;\r\n        }else {\r\n            const name = document.getElementById(destination);\r\n            name.classList.add(\"unseen\");\r\n            unseen.add(destination);\r\n\r\n        }\r\n        \r\n    });\r\n\r\n    connection.on(\"ReceivePrivateMessage\", function (destination, json) {\r\n        const message = JSON.parse(json);\r\n        console.dir(message);\r\n        const msg = document.createElement(\"p\");\r\n        if (selected.item === destination && selected.type === \"user\"){\r\n            messagesView.appendChild(msg);\r\n            if(message.sender === username) {\r\n                message.sender = \"You\";\r\n                msg.style.width=\"80%\";\r\n                msg.style.float=\"right\";\r\n                msg.style.textAlign=\"right\";\r\n                msg.style.marginRight=\"3px\";\r\n                msg.style.color=\"#03A062\";\r\n            }else{\r\n                msg.style.width=\"80%\";\r\n                msg.style.float=\"left\";\r\n                msg.style.textAlign=\"left\";\r\n                msg.style.marginLeft=\"3px\";\r\n                msg.style.color=\"white\";\r\n            }\r\n        \r\n        //skrolowanie listy wiadomoci do dou \r\n        messagesView.scrollTop = messagesView.scrollHeight;\r\n        msg.innerHTML = `<span style=\"color: #00bfff;\">${message.sender}:</span><span>${message.msg}</span>`;\r\n        }else if(destination != username){\r\n\r\n            const name = document.getElementById(destination);\r\n            name.classList.add(\"unseen\");\r\n\r\n        }\r\n        \r\n    });\r\n\r\n    connection.on(\"ReceiveUserList\" ,  json => {\r\n        //activeUsers  = JSON.parse(json);\r\n        //console.dir(activeUsers);\r\n        buildUsersList(json);\r\n    } );\r\n\r\n    connection.on(\"ReceiveGroupList\" ,  json => {\r\n        //activeUsers  = JSON.parse(json);\r\n        //console.dir(activeUsers);\r\n        buildGroupsList(json);\r\n    } );\r\n\r\n    connection.on(\"ReceiveMessagesByGroup\" ,  json => {\r\n        console.log();\r\n        console.log(\"json: \" + json);\r\n        console.log();\r\n        const conv = JSON.parse(json);\r\n        console.dir(conv);\r\n        // messages.forEach(obj =>{\r\n        //     if (obj.groupName === conv.groupName) messages.delete(obj);\r\n        // });\r\n\r\n        // messages.add(conv.content);\r\n\r\n        showMessages(conv);\r\n    } );\r\n\r\n    \r\n\r\n    join.addEventListener(\"click\", addToGroup);\r\n    \r\n    document.querySelector(\".sendMessage\").addEventListener(\"click\", (event) => {\r\n        const message = document.querySelector(\".messageInput\").value;\r\n        document.querySelector(\".messageInput\").value = \"\";\r\n        if (document.querySelector(\".imageInput\").value !=\"\") {\r\n            if(selected.type ===\"user\") {\r\n            \r\n                connection.invoke(\"SendPrivateMessage\", username,selected.item, toBase64(document.querySelector(\".imageInput\").files[0]),\"Image\").catch( (err) => console.error(err.toString()) );\r\n                console.log(\"wiadomo prywatna\");\r\n                //connection.invoke(\"SendPrivateMessage\", username,username, message,\"Text\").catch( (err) => console.error(err.toString()) );\r\n                //console.log(\"wiadomo prywatna\");\r\n            }else {\r\n                connection.invoke(\"SendMessageToGroup\", username,selected.item, toBase64(document.querySelector(\".imageInput\").files[0]),\"Image\").catch( (err) => console.error(err.toString()) );\r\n                console.log(\"wiadomo do grupy\");\r\n            }\r\n            \r\n        }\r\n        else {\r\n            if (selected.item ===\"none\"){\r\n                connection.invoke(\"SendMessage\", username, message,\"Text\").catch( (err) => console.error(err.toString()) );\r\n                console.log(\"wiadomo do wszystkich\"); \r\n            }\r\n        \r\n            else if(selected.type ===\"user\") {\r\n            \r\n                connection.invoke(\"SendPrivateMessage\", username,selected.item, message,\"Text\").catch( (err) => console.error(err.toString()) );\r\n                console.log(\"wiadomo prywatna\");\r\n                //connection.invoke(\"SendPrivateMessage\", username,username, message,\"Text\").catch( (err) => console.error(err.toString()) );\r\n                //console.log(\"wiadomo prywatna\");\r\n            }else {\r\n                connection.invoke(\"SendMessageToGroup\", username,selected.item, message,\"Text\").catch( (err) => console.error(err.toString()) );\r\n                console.log(\"wiadomo do grupy\");\r\n            }\r\n        }\r\n        \r\n    });\r\n\r\n    // klawisz enter aktywuje przycisk sendsendMessage\r\n    messageInput.addEventListener(\"keyup\", (event) => {\r\n        if (event.key === 'Enter') {\r\n            event.preventDefault();\r\n            sendMessage.click();\r\n        }\r\n    })\r\n    // Testowanie Grup ();\r\n    console.log(\"jo\");\r\n    //connection.invoke(\"AddUserToGroup\",\"Czarek\",\"Grupa nie testowa\");\r\n    //connection.invoke(\"AddUserToGroup\",\"Marek\",\"Grupa nie testowa\");\r\n    //connection.invoke(\"AddUserToGroup\",\"Darek\",\"prawidlowa\");\r\n    //connection.invoke(\"SendMessageToGroup\",\"Darek\",\"Grupa Testowa\",\"Wiadomo testowa\");\r\n    \r\n    \r\n};\r\n\r\nconst buildUsersList = function(json) {\r\n\r\n    console.log(\"dziaam\");\r\n    const usersList = document.querySelector(\"#usersList\");\r\n\r\n    const children = Array.prototype.slice.call(usersList.children);\r\n    children.forEach(el => el.remove());\r\n\r\n    console.log(\"dziaam\");\r\n    let user;\r\n    const Users = JSON.parse(json);\r\n    console.dir(Users);\r\n    Users.forEach(el => {\r\n        user = document.createElement(\"p\");\r\n        user.innerHTML = el.name;\r\n        user.id = el.name;\r\n        if (unseen.has(el.name)) {\r\n            user.classList.add(\"unseen\");\r\n        }\r\n        if (el.isActive === \"True\" ) {\r\n            user.style.color=\"#03A062\";\r\n        }else {\r\n            user.style.color=\"white\"; }\r\n        \r\n        \r\n        if (el.name === selected.item) {\r\n            user.classList.add(\"selected\");\r\n        }\r\n        \r\n        user.addEventListener(\"click\",getSelected);\r\n        usersList.appendChild(user);\r\n    });\r\n\r\n\r\n\r\n    setTimeout(() => {\r\n        connection.invoke(\"GetUsers\")\r\n            .catch(err => console.error(err.toString()));\r\n        connection.invoke(\"getGroupsByUser\",username)\r\n            .catch(err => console.error(err.toString()));\r\n        console.log(username);\r\n    },15000);\r\n}\r\n\r\nconst buildGroupsList = function(json) {\r\n\r\n    const usersList = document.querySelector(\"#groupsList\");\r\n\r\n    const children = Array.prototype.slice.call(usersList.children);\r\n    children.forEach(el => el.remove());\r\n\r\n    console.log(\"grupy\");\r\n    let flag = true;\r\n    let group;\r\n    const Groups = JSON.parse(json);\r\n    console.dir(Groups);\r\n    Groups.forEach(el => {\r\n        group = document.createElement(\"p\");\r\n        group.innerHTML = el;\r\n        console.log(\"Nazwa :::::\"+el);\r\n        group.id = el+\"\";\r\n        group.style.color=\"white\";\r\n        if (unseen.has(el)) {\r\n            group.classList.add(\"unseen\");\r\n        }\r\n        if (el === selected.item) {\r\n            flag = false;\r\n            group.classList.add(\"selected\");\r\n        }\r\n        group.addEventListener(\"click\",getSelected);\r\n        usersList.appendChild(group);\r\n        \r\n    });\r\n    console.log(\"flag\",flag,\" type\",selected.type);\r\n    if (flag === true && selected.type !== \"user\"){\r\n        abortion();\r\n    }\r\n}\r\n\r\nconst getSelected = function() {\r\n\r\n    document.querySelector(\".joinBTN\").innerHTML =\"<p>JOIN</p>\";\r\n\r\n    if (selected.item !== \"none\"){\r\n        console.log(\"dziaam tutaj przy zmianie\");\r\n        document.getElementById(selected.item).classList.remove(\"unseen\");\r\n        console.dir(document.getElementById(selected.item));\r\n        unseen.delete(selected.item);\r\n    }\r\n        \r\n    //console.dir(this);\r\n    //this.classList.remove(\"unseen\");\r\n    \r\n    const sel = document.querySelector(\".selected\");\r\n    \r\n    if ( sel ){\r\n        sel.classList.remove(\"selected\");\r\n    }\r\n    ;\r\n    if (selected.item === this.innerHTML) {\r\n        \r\n        this.color =\"white\";\r\n        selected.item = \"none\";\r\n        selected.type = \"none\";\r\n    }else{\r\n\r\n        selected.item =this.innerHTML;\r\n        if(this.parentNode.id === \"usersList\") {\r\n            buildConversation(selected.item,\"Private\");\r\n            selected.type = \"user\";\r\n        }else {\r\n            document.querySelector(\".joinBTN\").innerHTML =\"<p>LEAVE</p>\";\r\n            buildConversation(selected.item,\"Public\");\r\n            selected.type = \"group\";\r\n        }\r\n        this.classList.add(\"selected\");\r\n    }\r\n    console.dir(selected);\r\n\r\n\r\n\r\n    \r\n}\r\n\r\nconst addToGroup = function() {\r\n\r\n    if(selected.type === \"group\"){\r\n\r\n        connection.invoke(\"RemoveUserFromGroup\",username,selected.item)\r\n            .catch(err => console.error(err.toString()));\r\n        \r\n        //connection.invoke(\"getGroupsByUser\",username)\r\n        //    .catch(err => console.error(err.toString()));\r\n        selected.item =\"none\";\r\n        selected.type =\"none\";\r\n        document.querySelector(\".joinBTN\").innerHTML =\"<p>JOIN</p>\";\r\n\r\n    }else {\r\n        const window = document.createElement(\"div\");\r\n        const groupInput = document.createElement(\"input\");\r\n        const joinBTN = document.createElement(\"div\");\r\n\r\n        groupInput.classList.add(\"groupInput\");\r\n        joinBTN.classList.add(\"joinTogroupBTN\");\r\n        window.classList.add(\"addToGroup\");\r\n\r\n        groupInput.placeholder =\"Groupname\";\r\n        joinBTN.innerHTML =\"<p>EXIT</p>\";\r\n\r\n        window.appendChild(groupInput);\r\n        window.appendChild(joinBTN);\r\n\r\n        document.querySelector(\"body\").appendChild(window);\r\n        // zmiana wartoci przycisku w zalenoci od wartoci pola\r\n        groupInput.addEventListener(\"input\" , ()=>{\r\n            if (groupInput.value ===\"\"){\r\n                joinBTN.innerHTML =\"<p>EXIT</p>\";\r\n            }else {\r\n                joinBTN.innerHTML =\"<p>JOIN</p>\";\r\n            }\r\n        \r\n        })\r\n\r\n        //dodawanie do grupy\r\n        joinBTN.addEventListener(\"click\", () => {\r\n            if (groupInput.value ===\"\"){\r\n                window.remove();\r\n            }else {\r\n            \r\n                connection.invoke(\"AddUserToGroup\",username,groupInput.value)\r\n                    .catch(err => console.error(err.toString()));\r\n                //connection.invoke(\"getGroupsByUser\",username)\r\n                //    .catch(err => console.error(err.toString()));\r\n                window.remove();\r\n            }\r\n        });\r\n    }\r\n    \r\n}\r\n\r\nconst buildConversation = function(convName,type){\r\n\r\n    \r\n    connection.invoke(\"getMessagesByGroup\",convName,type)\r\n                    .catch(err => console.error(err.toString()));\r\n\r\n    abortion();\r\n}\r\nconst showMessages = function(conv){\r\n    console.log(\"Dziaam tutaj\");\r\n    const messagesView = document.querySelector(\".messagesView\");\r\n    console.log(\"Dziaam tutaj\");\r\n    conv.content.forEach(el =>{\r\n        const msg = document.createElement(\"p\");\r\n        console.log(\"Dziaam tutaj\");\r\n        messagesView.appendChild(msg);\r\n        console.log(\"Dziaam tutaj\");\r\n        if(el.sender === username) {\r\n            console.log(\"Dziaam tutaj1\");\r\n            el.sender = \"You\";\r\n            msg.style.width=\"80%\";\r\n            msg.style.float=\"right\";\r\n            msg.style.textAlign=\"right\";\r\n            msg.style.marginRight=\"3px\";\r\n            msg.style.color=\"#03A062\";\r\n        }else{\r\n            console.log(\"Dziaam tutaj2\");\r\n            msg.style.width=\"80%\";\r\n            msg.style.float=\"left\";\r\n            msg.style.textAlign=\"left\";\r\n            msg.style.marginLeft=\"3px\";\r\n            msg.style.color=\"white\";\r\n        }\r\n        console.log(\"Dziaam tutaj2 Type \", el.type);\r\n        if(el.type ==\"Image\") {\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${el.sender}:</span><img src=\"${el.msg}\"></img>`;\r\n        } else{\r\n            msg.innerHTML = `<span style=\"color: #00bfff;\">${el.sender}:</span><span>${el.msg}</span>`;\r\n        }\r\n        \r\n    });\r\n    //skrolowanie listy wiadomoci do dou \r\n    messagesView.scrollTop = messagesView.scrollHeight;\r\n    \r\n    \r\n    \r\n\r\n}\r\nconst abortion = function(){\r\n    const messagesView = document.querySelector(\".messagesView\");\r\n    const children = Array.prototype.slice.call(messagesView.children);\r\n    children.forEach(el => el.remove());\r\n}\r\n\r\n\r\nconst toBase64 = function(file){\r\n\r\n    //let base64 ;\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n      // log to console\r\n      // logs data:<type>;base64,wL2dvYWwgbW9yZ...\r\n       base64.byte = reader.result;\r\n      //console.log(reader.result);\r\n    };\r\n    console.log(base64.byte);\r\n    reader.readAsDataURL(file);\r\n    return base64.byte;\r\n}","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortController } from \"./AbortController\";\r\nimport { HttpError, TimeoutError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, sendMessage } from \"./Utils\";\r\n// Not exported from 'index', this type is internal.\r\n/** @private */\r\nvar LongPollingTransport = /** @class */ (function () {\r\n    function LongPollingTransport(httpClient, accessTokenFactory, logger, logMessageContent, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.pollAbort = new AbortController();\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.headers = headers;\r\n        this.running = false;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    Object.defineProperty(LongPollingTransport.prototype, \"pollAborted\", {\r\n        // This is an internal type, not exported from 'index' so this is really just internal.\r\n        get: function () {\r\n            return this.pollAbort.aborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LongPollingTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, _b, name, value, headers, pollOptions, token, pollUrl, response;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.url = url;\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Connecting.\");\r\n                        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)\r\n                        if (transferFormat === TransferFormat.Binary &&\r\n                            (typeof XMLHttpRequest !== \"undefined\" && typeof new XMLHttpRequest().responseType !== \"string\")) {\r\n                            throw new Error(\"Binary protocols over XmlHttpRequest not implementing advanced features are not supported.\");\r\n                        }\r\n                        _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                        headers = __assign((_a = {}, _a[name] = value, _a), this.headers);\r\n                        pollOptions = {\r\n                            abortSignal: this.pollAbort.signal,\r\n                            headers: headers,\r\n                            timeout: 100000,\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        if (transferFormat === TransferFormat.Binary) {\r\n                            pollOptions.responseType = \"arraybuffer\";\r\n                        }\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 1:\r\n                        token = _c.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 2:\r\n                        response = _c.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Mark running as false so that the poll immediately ends and runs the close logic\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            this.running = true;\r\n                        }\r\n                        this.receiving = this.poll(this.url, pollOptions);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.getAccessToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1: return [2 /*return*/, _a.sent()];\r\n                    case 2: return [2 /*return*/, null];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.updateHeaderToken = function (request, token) {\r\n        if (!request.headers) {\r\n            request.headers = {};\r\n        }\r\n        if (token) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            request.headers[\"Authorization\"] = \"Bearer \" + token;\r\n            return;\r\n        }\r\n        // tslint:disable-next-line:no-string-literal\r\n        if (request.headers[\"Authorization\"]) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            delete request.headers[\"Authorization\"];\r\n        }\r\n    };\r\n    LongPollingTransport.prototype.poll = function (url, pollOptions) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token, pollUrl, response, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, , 8, 9]);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!this.running) return [3 /*break*/, 7];\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 2:\r\n                        token = _a.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 4:\r\n                        response = _a.sent();\r\n                        if (response.statusCode === 204) {\r\n                            this.logger.log(LogLevel.Information, \"(LongPolling transport) Poll terminated by server.\");\r\n                            this.running = false;\r\n                        }\r\n                        else if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Unexpected status code\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            // Process the response\r\n                            if (response.content) {\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) data received. \" + getDataDetail(response.content, this.logMessageContent) + \".\");\r\n                                if (this.onreceive) {\r\n                                    this.onreceive(response.content);\r\n                                }\r\n                            }\r\n                            else {\r\n                                // This is another way timeout manifest.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        e_1 = _a.sent();\r\n                        if (!this.running) {\r\n                            // Log but disregard errors that occur after stopping\r\n                            this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll errored after shutdown: \" + e_1.message);\r\n                        }\r\n                        else {\r\n                            if (e_1 instanceof TimeoutError) {\r\n                                // Ignore timeouts and reissue the poll.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                            else {\r\n                                // Close the connection with the error as the result.\r\n                                this.closeError = e_1;\r\n                                this.running = false;\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7: return [3 /*break*/, 9];\r\n                    case 8:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Polling complete.\");\r\n                        // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.\r\n                        // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.\r\n                        if (!this.pollAborted) {\r\n                            this.raiseOnClose();\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 9: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.running) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"LongPolling\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, _a, name_1, value, deleteOptions, token;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stopping polling.\");\r\n                        // Tell receiving loop to stop, abort any current request, and then wait for it to finish\r\n                        this.running = false;\r\n                        this.pollAbort.abort();\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, , 5, 6]);\r\n                        return [4 /*yield*/, this.receiving];\r\n                    case 2:\r\n                        _b.sent();\r\n                        // Send DELETE to clean up long polling on the server\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) sending DELETE request to \" + this.url + \".\");\r\n                        headers = {};\r\n                        _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                        headers[name_1] = value;\r\n                        deleteOptions = {\r\n                            headers: __assign({}, headers, this.headers),\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 3:\r\n                        token = _b.sent();\r\n                        this.updateHeaderToken(deleteOptions, token);\r\n                        return [4 /*yield*/, this.httpClient.delete(this.url, deleteOptions)];\r\n                    case 4:\r\n                        _b.sent();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) DELETE request sent.\");\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stop finished.\");\r\n                        // Raise close event here instead of in polling\r\n                        // It needs to happen after the DELETE request is sent\r\n                        this.raiseOnClose();\r\n                        return [7 /*endfinally*/];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.raiseOnClose = function () {\r\n        if (this.onclose) {\r\n            var logMessage = \"(LongPolling transport) Firing onclose event.\";\r\n            if (this.closeError) {\r\n                logMessage += \" Error: \" + this.closeError;\r\n            }\r\n            this.logger.log(LogLevel.Trace, logMessage);\r\n            this.onclose(this.closeError);\r\n        }\r\n    };\r\n    return LongPollingTransport;\r\n}());\r\nexport { LongPollingTransport };\r\n//# sourceMappingURL=LongPollingTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform, sendMessage } from \"./Utils\";\r\n/** @private */\r\nvar ServerSentEventsTransport = /** @class */ (function () {\r\n    function ServerSentEventsTransport(httpClient, accessTokenFactory, logger, logMessageContent, eventSourceConstructor, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.eventSourceConstructor = eventSourceConstructor;\r\n        this.headers = headers;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    ServerSentEventsTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(SSE transport) Connecting.\");\r\n                        // set url before accessTokenFactory because this.url is only for send and we set the auth header instead of the query string for send\r\n                        this.url = url;\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            var opened = false;\r\n                            if (transferFormat !== TransferFormat.Text) {\r\n                                reject(new Error(\"The Server-Sent Events transport only supports the 'Text' transfer format\"));\r\n                                return;\r\n                            }\r\n                            var eventSource;\r\n                            if (Platform.isBrowser || Platform.isWebWorker) {\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials });\r\n                            }\r\n                            else {\r\n                                // Non-browser passes cookies via the dictionary\r\n                                var cookies = _this.httpClient.getCookieString(url);\r\n                                var headers = {};\r\n                                headers.Cookie = cookies;\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials, headers: __assign({}, headers, _this.headers) });\r\n                            }\r\n                            try {\r\n                                eventSource.onmessage = function (e) {\r\n                                    if (_this.onreceive) {\r\n                                        try {\r\n                                            _this.logger.log(LogLevel.Trace, \"(SSE transport) data received. \" + getDataDetail(e.data, _this.logMessageContent) + \".\");\r\n                                            _this.onreceive(e.data);\r\n                                        }\r\n                                        catch (error) {\r\n                                            _this.close(error);\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                };\r\n                                eventSource.onerror = function (e) {\r\n                                    var error = new Error(e.data || \"Error occurred\");\r\n                                    if (opened) {\r\n                                        _this.close(error);\r\n                                    }\r\n                                    else {\r\n                                        reject(error);\r\n                                    }\r\n                                };\r\n                                eventSource.onopen = function () {\r\n                                    _this.logger.log(LogLevel.Information, \"SSE connected to \" + _this.url);\r\n                                    _this.eventSource = eventSource;\r\n                                    opened = true;\r\n                                    resolve();\r\n                                };\r\n                            }\r\n                            catch (e) {\r\n                                reject(e);\r\n                                return;\r\n                            }\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.eventSource) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"SSE\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.stop = function () {\r\n        this.close();\r\n        return Promise.resolve();\r\n    };\r\n    ServerSentEventsTransport.prototype.close = function (e) {\r\n        if (this.eventSource) {\r\n            this.eventSource.close();\r\n            this.eventSource = undefined;\r\n            if (this.onclose) {\r\n                this.onclose(e);\r\n            }\r\n        }\r\n    };\r\n    return ServerSentEventsTransport;\r\n}());\r\nexport { ServerSentEventsTransport };\r\n//# sourceMappingURL=ServerSentEventsTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform } from \"./Utils\";\r\n/** @private */\r\nvar WebSocketTransport = /** @class */ (function () {\r\n    function WebSocketTransport(httpClient, accessTokenFactory, logger, logMessageContent, webSocketConstructor, headers) {\r\n        this.logger = logger;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logMessageContent = logMessageContent;\r\n        this.webSocketConstructor = webSocketConstructor;\r\n        this.httpClient = httpClient;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n        this.headers = headers;\r\n    }\r\n    WebSocketTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(WebSockets transport) Connecting.\");\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            url = url.replace(/^http/, \"ws\");\r\n                            var webSocket;\r\n                            var cookies = _this.httpClient.getCookieString(url);\r\n                            var opened = false;\r\n                            if (Platform.isNode) {\r\n                                var headers = {};\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                if (cookies) {\r\n                                    headers[\"Cookie\"] = \"\" + cookies;\r\n                                }\r\n                                // Only pass headers when in non-browser environments\r\n                                webSocket = new _this.webSocketConstructor(url, undefined, {\r\n                                    headers: __assign({}, headers, _this.headers),\r\n                                });\r\n                            }\r\n                            if (!webSocket) {\r\n                                // Chrome is not happy with passing 'undefined' as protocol\r\n                                webSocket = new _this.webSocketConstructor(url);\r\n                            }\r\n                            if (transferFormat === TransferFormat.Binary) {\r\n                                webSocket.binaryType = \"arraybuffer\";\r\n                            }\r\n                            // tslint:disable-next-line:variable-name\r\n                            webSocket.onopen = function (_event) {\r\n                                _this.logger.log(LogLevel.Information, \"WebSocket connected to \" + url + \".\");\r\n                                _this.webSocket = webSocket;\r\n                                opened = true;\r\n                                resolve();\r\n                            };\r\n                            webSocket.onerror = function (event) {\r\n                                var error = null;\r\n                                // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                    error = event.error;\r\n                                }\r\n                                else {\r\n                                    error = new Error(\"There was an error with the transport.\");\r\n                                }\r\n                                reject(error);\r\n                            };\r\n                            webSocket.onmessage = function (message) {\r\n                                _this.logger.log(LogLevel.Trace, \"(WebSockets transport) data received. \" + getDataDetail(message.data, _this.logMessageContent) + \".\");\r\n                                if (_this.onreceive) {\r\n                                    try {\r\n                                        _this.onreceive(message.data);\r\n                                    }\r\n                                    catch (error) {\r\n                                        _this.close(error);\r\n                                        return;\r\n                                    }\r\n                                }\r\n                            };\r\n                            webSocket.onclose = function (event) {\r\n                                // Don't call close handler if connection was never established\r\n                                // We'll reject the connect call instead\r\n                                if (opened) {\r\n                                    _this.close(event);\r\n                                }\r\n                                else {\r\n                                    var error = null;\r\n                                    // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                    if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                        error = event.error;\r\n                                    }\r\n                                    else {\r\n                                        error = new Error(\"There was an error with the transport.\");\r\n                                    }\r\n                                    reject(error);\r\n                                }\r\n                            };\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WebSocketTransport.prototype.send = function (data) {\r\n        if (this.webSocket && this.webSocket.readyState === this.webSocketConstructor.OPEN) {\r\n            this.logger.log(LogLevel.Trace, \"(WebSockets transport) sending data. \" + getDataDetail(data, this.logMessageContent) + \".\");\r\n            this.webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n        return Promise.reject(\"WebSocket is not in the OPEN state\");\r\n    };\r\n    WebSocketTransport.prototype.stop = function () {\r\n        if (this.webSocket) {\r\n            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning\r\n            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects\r\n            this.close(undefined);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WebSocketTransport.prototype.close = function (event) {\r\n        // webSocket will be null if the transport did not start successfully\r\n        if (this.webSocket) {\r\n            // Clear websocket handlers because we are considering the socket closed now\r\n            this.webSocket.onclose = function () { };\r\n            this.webSocket.onmessage = function () { };\r\n            this.webSocket.onerror = function () { };\r\n            this.webSocket.close();\r\n            this.webSocket = undefined;\r\n        }\r\n        this.logger.log(LogLevel.Trace, \"(WebSockets transport) socket closed.\");\r\n        if (this.onclose) {\r\n            if (this.isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {\r\n                this.onclose(new Error(\"WebSocket closed with status code: \" + event.code + \" (\" + event.reason + \").\"));\r\n            }\r\n            else if (event instanceof Error) {\r\n                this.onclose(event);\r\n            }\r\n            else {\r\n                this.onclose();\r\n            }\r\n        }\r\n    };\r\n    WebSocketTransport.prototype.isCloseEvent = function (event) {\r\n        return event && typeof event.wasClean === \"boolean\" && typeof event.code === \"number\";\r\n    };\r\n    return WebSocketTransport;\r\n}());\r\nexport { WebSocketTransport };\r\n//# sourceMappingURL=WebSocketTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger, getUserAgentHeader, Platform } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nvar MAX_REDIRECTS = 100;\r\n/** @private */\r\nvar HttpConnection = /** @class */ (function () {\r\n    function HttpConnection(url, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.stopPromiseResolver = function () { };\r\n        this.features = {};\r\n        this.negotiateVersion = 1;\r\n        Arg.isRequired(url, \"url\");\r\n        this.logger = createLogger(options.logger);\r\n        this.baseUrl = this.resolveUrl(url);\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;\r\n        if (typeof options.withCredentials === \"boolean\" || options.withCredentials === undefined) {\r\n            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;\r\n        }\r\n        else {\r\n            throw new Error(\"withCredentials option was not a 'boolean' or 'undefined' value\");\r\n        }\r\n        var webSocketModule = null;\r\n        var eventSourceModule = null;\r\n        if (Platform.isNode && typeof require !== \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            webSocketModule = requireFunc(\"ws\");\r\n            eventSourceModule = requireFunc(\"eventsource\");\r\n        }\r\n        if (!Platform.isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        }\r\n        else if (Platform.isNode && !options.WebSocket) {\r\n            if (webSocketModule) {\r\n                options.WebSocket = webSocketModule;\r\n            }\r\n        }\r\n        if (!Platform.isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        }\r\n        else if (Platform.isNode && !options.EventSource) {\r\n            if (typeof eventSourceModule !== \"undefined\") {\r\n                options.EventSource = eventSourceModule;\r\n            }\r\n        }\r\n        this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        this.connectionStarted = false;\r\n        this.options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    HttpConnection.prototype.start = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var message, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        transferFormat = transferFormat || TransferFormat.Binary;\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\r\n                        if (this.connectionState !== \"Disconnected\" /* Disconnected */) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start an HttpConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = \"Connecting\" /* Connecting */;\r\n                        this.startInternalPromise = this.startInternal(transferFormat);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!(this.connectionState === \"Disconnecting\" /* Disconnecting */)) return [3 /*break*/, 3];\r\n                        message = \"Failed to start the HttpConnection before stop() was called.\";\r\n                        this.logger.log(LogLevel.Error, message);\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        _a.sent();\r\n                        return [2 /*return*/, Promise.reject(new Error(message))];\r\n                    case 3:\r\n                        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n                            message = \"HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!\";\r\n                            this.logger.log(LogLevel.Error, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        this.connectionStarted = true;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.send = function (data) {\r\n        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n            return Promise.reject(new Error(\"Cannot send data if the connection is not in the 'Connected' State.\"));\r\n        }\r\n        if (!this.sendQueue) {\r\n            this.sendQueue = new TransportSendQueue(this.transport);\r\n        }\r\n        // Transport will not be null if state is connected\r\n        return this.sendQueue.send(data);\r\n    };\r\n    HttpConnection.prototype.stop = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnected state.\");\r\n                            return [2 /*return*/, Promise.resolve()];\r\n                        }\r\n                        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n                            return [2 /*return*/, this.stopPromise];\r\n                        }\r\n                        this.connectionState = \"Disconnecting\" /* Disconnecting */;\r\n                        this.stopPromise = new Promise(function (resolve) {\r\n                            // Don't complete stop() until stopConnection() completes.\r\n                            _this.stopPromiseResolver = resolve;\r\n                        });\r\n                        // stopInternal should never throw so just observe it.\r\n                        return [4 /*yield*/, this.stopInternal(error)];\r\n                    case 1:\r\n                        // stopInternal should never throw so just observe it.\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.stopInternal = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1, e_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Set error as soon as possible otherwise there is a race between\r\n                        // the transport closing and providing an error and the error from a close message\r\n                        // We would prefer the close message error.\r\n                        this.stopError = error;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 4:\r\n                        if (!this.transport) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.transport.stop()];\r\n                    case 6:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"HttpConnection.transport.stop() threw error '\" + e_2 + \"'.\");\r\n                        this.stopConnection();\r\n                        return [3 /*break*/, 8];\r\n                    case 8:\r\n                        this.transport = undefined;\r\n                        return [3 /*break*/, 10];\r\n                    case 9:\r\n                        this.logger.log(LogLevel.Debug, \"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.\");\r\n                        _a.label = 10;\r\n                    case 10: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.startInternal = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var url, negotiateResponse, redirects, _loop_1, this_1, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        url = this.baseUrl;\r\n                        this.accessTokenFactory = this.options.accessTokenFactory;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 12, , 13]);\r\n                        if (!this.options.skipNegotiation) return [3 /*break*/, 5];\r\n                        if (!(this.options.transport === HttpTransportType.WebSockets)) return [3 /*break*/, 3];\r\n                        // No need to add a connection ID in this case\r\n                        this.transport = this.constructTransport(HttpTransportType.WebSockets);\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        return [4 /*yield*/, this.startTransport(url, transferFormat)];\r\n                    case 2:\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3: throw new Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                    case 4: return [3 /*break*/, 11];\r\n                    case 5:\r\n                        negotiateResponse = null;\r\n                        redirects = 0;\r\n                        _loop_1 = function () {\r\n                            var accessToken_1;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4 /*yield*/, this_1.getNegotiationResponse(url)];\r\n                                    case 1:\r\n                                        negotiateResponse = _a.sent();\r\n                                        // the user tries to stop the connection when it is being started\r\n                                        if (this_1.connectionState === \"Disconnecting\" /* Disconnecting */ || this_1.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                                            throw new Error(\"The connection was stopped during negotiation.\");\r\n                                        }\r\n                                        if (negotiateResponse.error) {\r\n                                            throw new Error(negotiateResponse.error);\r\n                                        }\r\n                                        if (negotiateResponse.ProtocolVersion) {\r\n                                            throw new Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                                        }\r\n                                        if (negotiateResponse.url) {\r\n                                            url = negotiateResponse.url;\r\n                                        }\r\n                                        if (negotiateResponse.accessToken) {\r\n                                            accessToken_1 = negotiateResponse.accessToken;\r\n                                            this_1.accessTokenFactory = function () { return accessToken_1; };\r\n                                        }\r\n                                        redirects++;\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        };\r\n                        this_1 = this;\r\n                        _a.label = 6;\r\n                    case 6: return [5 /*yield**/, _loop_1()];\r\n                    case 7:\r\n                        _a.sent();\r\n                        _a.label = 8;\r\n                    case 8:\r\n                        if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                            throw new Error(\"Negotiate redirection limit exceeded.\");\r\n                        }\r\n                        return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        _a.label = 11;\r\n                    case 11:\r\n                        if (this.transport instanceof LongPollingTransport) {\r\n                            this.features.inherentKeepAlive = true;\r\n                        }\r\n                        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n                            // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.\r\n                            // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.\r\n                            this.logger.log(LogLevel.Debug, \"The HttpConnection connected successfully.\");\r\n                            this.connectionState = \"Connected\" /* Connected */;\r\n                        }\r\n                        return [3 /*break*/, 13];\r\n                    case 12:\r\n                        e_3 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_3);\r\n                        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n                        this.transport = undefined;\r\n                        // if start fails, any active calls to stop assume that start will complete the stop promise\r\n                        this.stopPromiseResolver();\r\n                        return [2 /*return*/, Promise.reject(e_3)];\r\n                    case 13: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.getNegotiationResponse = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, token, _a, name, value, negotiateUrl, response, negotiateResponse, e_4;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        headers = {};\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _b.sent();\r\n                        if (token) {\r\n                            headers[\"Authorization\"] = \"Bearer \" + token;\r\n                        }\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        _a = getUserAgentHeader(), name = _a[0], value = _a[1];\r\n                        headers[name] = value;\r\n                        negotiateUrl = this.resolveNegotiateUrl(url);\r\n                        this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl + \".\");\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _b.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.httpClient.post(negotiateUrl, {\r\n                                content: \"\",\r\n                                headers: __assign({}, headers, this.options.headers),\r\n                                withCredentials: this.options.withCredentials,\r\n                            })];\r\n                    case 4:\r\n                        response = _b.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unexpected status code returned from negotiate '\" + response.statusCode + \"'\"))];\r\n                        }\r\n                        negotiateResponse = JSON.parse(response.content);\r\n                        if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {\r\n                            // Negotiate version 0 doesn't use connectionToken\r\n                            // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version\r\n                            negotiateResponse.connectionToken = negotiateResponse.connectionId;\r\n                        }\r\n                        return [2 /*return*/, negotiateResponse];\r\n                    case 5:\r\n                        e_4 = _b.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_4);\r\n                        return [2 /*return*/, Promise.reject(e_4)];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.createConnectUrl = function (url, connectionToken) {\r\n        if (!connectionToken) {\r\n            return url;\r\n        }\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionToken);\r\n    };\r\n    HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var connectUrl, transportExceptions, transports, negotiate, _i, transports_1, endpoint, transportOrError, ex_1, ex_2, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionToken);\r\n                        if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];\r\n                        this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n                        this.transport = requestedTransport;\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.connectionId = negotiateResponse.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 2:\r\n                        transportExceptions = [];\r\n                        transports = negotiateResponse.availableTransports || [];\r\n                        negotiate = negotiateResponse;\r\n                        _i = 0, transports_1 = transports;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (!(_i < transports_1.length)) return [3 /*break*/, 13];\r\n                        endpoint = transports_1[_i];\r\n                        transportOrError = this.resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat);\r\n                        if (!(transportOrError instanceof Error)) return [3 /*break*/, 4];\r\n                        // Store the error and continue, we don't want to cause a re-negotiate in these cases\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + transportOrError);\r\n                        return [3 /*break*/, 12];\r\n                    case 4:\r\n                        if (!this.isITransport(transportOrError)) return [3 /*break*/, 12];\r\n                        this.transport = transportOrError;\r\n                        if (!!negotiate) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.getNegotiationResponse(url)];\r\n                    case 6:\r\n                        negotiate = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        ex_1 = _a.sent();\r\n                        return [2 /*return*/, Promise.reject(ex_1)];\r\n                    case 8:\r\n                        connectUrl = this.createConnectUrl(url, negotiate.connectionToken);\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        _a.trys.push([9, 11, , 12]);\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        this.connectionId = negotiate.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 11:\r\n                        ex_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + endpoint.transport + \"': \" + ex_2);\r\n                        negotiate = undefined;\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + ex_2);\r\n                        if (this.connectionState !== \"Connecting\" /* Connecting */) {\r\n                            message = \"Failed to select transport before stop() was called.\";\r\n                            this.logger.log(LogLevel.Debug, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        return [3 /*break*/, 12];\r\n                    case 12:\r\n                        _i++;\r\n                        return [3 /*break*/, 3];\r\n                    case 13:\r\n                        if (transportExceptions.length > 0) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unable to connect to the server with any of the available transports. \" + transportExceptions.join(\" \")))];\r\n                        }\r\n                        return [2 /*return*/, Promise.reject(new Error(\"None of the transports supported by the client are supported by the server.\"))];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.constructTransport = function (transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this.options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.WebSocket, this.options.headers || {});\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this.options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.EventSource, this.options.withCredentials, this.options.headers || {});\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.withCredentials, this.options.headers || {});\r\n            default:\r\n                throw new Error(\"Unknown transport: \" + transport + \".\");\r\n        }\r\n    };\r\n    HttpConnection.prototype.startTransport = function (url, transferFormat) {\r\n        var _this = this;\r\n        this.transport.onreceive = this.onreceive;\r\n        this.transport.onclose = function (e) { return _this.stopConnection(e); };\r\n        return this.transport.connect(url, transferFormat);\r\n    };\r\n    HttpConnection.prototype.resolveTransportOrError = function (endpoint, requestedTransport, requestedTransferFormat) {\r\n        var transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n            return new Error(\"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n        }\r\n        else {\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                var transferFormats = endpoint.transferFormats.map(function (s) { return TransferFormat[s]; });\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this.options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this.options.EventSource)) {\r\n                        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\r\n                        return new Error(\"'\" + HttpTransportType[transport] + \"' is not supported in your environment.\");\r\n                    }\r\n                    else {\r\n                        this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'.\");\r\n                        try {\r\n                            return this.constructTransport(transport);\r\n                        }\r\n                        catch (ex) {\r\n                            return ex;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\r\n                    return new Error(\"'\" + HttpTransportType[transport] + \"' does not support \" + TransferFormat[requestedTransferFormat] + \".\");\r\n                }\r\n            }\r\n            else {\r\n                this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\r\n                return new Error(\"'\" + HttpTransportType[transport] + \"' is disabled by the client.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.isITransport = function (transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    };\r\n    HttpConnection.prototype.stopConnection = function (error) {\r\n        var _this = this;\r\n        this.logger.log(LogLevel.Debug, \"HttpConnection.stopConnection(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        this.transport = undefined;\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this.stopError || error;\r\n        this.stopError = undefined;\r\n        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is already in the disconnected state.\");\r\n            return;\r\n        }\r\n        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n            this.logger.log(LogLevel.Warning, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is still in the connecting state.\");\r\n            throw new Error(\"HttpConnection.stopConnection(\" + error + \") was called while the connection is still in the connecting state.\");\r\n        }\r\n        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n            // A call to stop() induced this call to stopConnection and needs to be completed.\r\n            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.\r\n            this.stopPromiseResolver();\r\n        }\r\n        if (error) {\r\n            this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n        if (this.sendQueue) {\r\n            this.sendQueue.stop().catch(function (e) {\r\n                _this.logger.log(LogLevel.Error, \"TransportSendQueue.stop() threw error '\" + e + \"'.\");\r\n            });\r\n            this.sendQueue = undefined;\r\n        }\r\n        this.connectionId = undefined;\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        if (this.connectionStarted) {\r\n            this.connectionStarted = false;\r\n            try {\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"HttpConnection.onclose(\" + error + \") threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.resolveUrl = function (url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (!Platform.isBrowser || !window.document) {\r\n            throw new Error(\"Cannot resolve '\" + url + \"'.\");\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        var aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\r\n        return aTag.href;\r\n    };\r\n    HttpConnection.prototype.resolveNegotiateUrl = function (url) {\r\n        var index = url.indexOf(\"?\");\r\n        var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\r\n        if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\r\n            negotiateUrl += \"/\";\r\n        }\r\n        negotiateUrl += \"negotiate\";\r\n        negotiateUrl += index === -1 ? \"\" : url.substring(index);\r\n        if (negotiateUrl.indexOf(\"negotiateVersion\") === -1) {\r\n            negotiateUrl += index === -1 ? \"?\" : \"&\";\r\n            negotiateUrl += \"negotiateVersion=\" + this.negotiateVersion;\r\n        }\r\n        return negotiateUrl;\r\n    };\r\n    return HttpConnection;\r\n}());\r\nexport { HttpConnection };\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n/** @private */\r\nvar TransportSendQueue = /** @class */ (function () {\r\n    function TransportSendQueue(transport) {\r\n        this.transport = transport;\r\n        this.buffer = [];\r\n        this.executing = true;\r\n        this.sendBufferedData = new PromiseSource();\r\n        this.transportResult = new PromiseSource();\r\n        this.sendLoopPromise = this.sendLoop();\r\n    }\r\n    TransportSendQueue.prototype.send = function (data) {\r\n        this.bufferData(data);\r\n        if (!this.transportResult) {\r\n            this.transportResult = new PromiseSource();\r\n        }\r\n        return this.transportResult.promise;\r\n    };\r\n    TransportSendQueue.prototype.stop = function () {\r\n        this.executing = false;\r\n        this.sendBufferedData.resolve();\r\n        return this.sendLoopPromise;\r\n    };\r\n    TransportSendQueue.prototype.bufferData = function (data) {\r\n        if (this.buffer.length && typeof (this.buffer[0]) !== typeof (data)) {\r\n            throw new Error(\"Expected data to be of type \" + typeof (this.buffer) + \" but was of type \" + typeof (data));\r\n        }\r\n        this.buffer.push(data);\r\n        this.sendBufferedData.resolve();\r\n    };\r\n    TransportSendQueue.prototype.sendLoop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var transportResult, data, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!true) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.sendBufferedData.promise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.executing) {\r\n                            if (this.transportResult) {\r\n                                this.transportResult.reject(\"Connection stopped.\");\r\n                            }\r\n                            return [3 /*break*/, 6];\r\n                        }\r\n                        this.sendBufferedData = new PromiseSource();\r\n                        transportResult = this.transportResult;\r\n                        this.transportResult = undefined;\r\n                        data = typeof (this.buffer[0]) === \"string\" ?\r\n                            this.buffer.join(\"\") :\r\n                            TransportSendQueue.concatBuffers(this.buffer);\r\n                        this.buffer.length = 0;\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, this.transport.send(data)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        transportResult.resolve();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        error_1 = _a.sent();\r\n                        transportResult.reject(error_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [3 /*break*/, 0];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    TransportSendQueue.concatBuffers = function (arrayBuffers) {\r\n        var totalLength = arrayBuffers.map(function (b) { return b.byteLength; }).reduce(function (a, b) { return a + b; });\r\n        var result = new Uint8Array(totalLength);\r\n        var offset = 0;\r\n        for (var _i = 0, arrayBuffers_1 = arrayBuffers; _i < arrayBuffers_1.length; _i++) {\r\n            var item = arrayBuffers_1[_i];\r\n            result.set(new Uint8Array(item), offset);\r\n            offset += item.byteLength;\r\n        }\r\n        return result.buffer;\r\n    };\r\n    return TransportSendQueue;\r\n}());\r\nexport { TransportSendQueue };\r\nvar PromiseSource = /** @class */ (function () {\r\n    function PromiseSource() {\r\n        var _this = this;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            var _a;\r\n            return _a = [resolve, reject], _this.resolver = _a[0], _this.rejecter = _a[1], _a;\r\n        });\r\n    }\r\n    PromiseSource.prototype.resolve = function () {\r\n        this.resolver();\r\n    };\r\n    PromiseSource.prototype.reject = function (reason) {\r\n        this.rejecter(reason);\r\n    };\r\n    return PromiseSource;\r\n}());\r\n//# sourceMappingURL=HttpConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nvar JSON_HUB_PROTOCOL_NAME = \"json\";\r\n/** Implements the JSON Hub Protocol. */\r\nvar JsonHubProtocol = /** @class */ (function () {\r\n    function JsonHubProtocol() {\r\n        /** @inheritDoc */\r\n        this.name = JSON_HUB_PROTOCOL_NAME;\r\n        /** @inheritDoc */\r\n        this.version = 1;\r\n        /** @inheritDoc */\r\n        this.transferFormat = TransferFormat.Text;\r\n    }\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * @param {string} input A string containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    JsonHubProtocol.prototype.parseMessages = function (input, logger) {\r\n        // The interface does allow \"ArrayBuffer\" to be passed in, but this implementation does not. So let's throw a useful error.\r\n        if (typeof input !== \"string\") {\r\n            throw new Error(\"Invalid input for JSON hub protocol. Expected a string.\");\r\n        }\r\n        if (!input) {\r\n            return [];\r\n        }\r\n        if (logger === null) {\r\n            logger = NullLogger.instance;\r\n        }\r\n        // Parse the messages\r\n        var messages = TextMessageFormat.parse(input);\r\n        var hubMessages = [];\r\n        for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n            var message = messages_1[_i];\r\n            var parsedMessage = JSON.parse(message);\r\n            if (typeof parsedMessage.type !== \"number\") {\r\n                throw new Error(\"Invalid payload.\");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case MessageType.Invocation:\r\n                    this.isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.StreamItem:\r\n                    this.isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Completion:\r\n                    this.isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Ping:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case MessageType.Close:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(LogLevel.Information, \"Unknown message type '\" + parsedMessage.type + \"' ignored.\");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n        return hubMessages;\r\n    };\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string} A string containing the serialized representation of the message.\r\n     */\r\n    JsonHubProtocol.prototype.writeMessage = function (message) {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    };\r\n    JsonHubProtocol.prototype.isInvocationMessage = function (message) {\r\n        this.assertNotEmptyString(message.target, \"Invalid payload for Invocation message.\");\r\n        if (message.invocationId !== undefined) {\r\n            this.assertNotEmptyString(message.invocationId, \"Invalid payload for Invocation message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isStreamItemMessage = function (message) {\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for StreamItem message.\");\r\n        if (message.item === undefined) {\r\n            throw new Error(\"Invalid payload for StreamItem message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isCompletionMessage = function (message) {\r\n        if (message.result && message.error) {\r\n            throw new Error(\"Invalid payload for Completion message.\");\r\n        }\r\n        if (!message.result && message.error) {\r\n            this.assertNotEmptyString(message.error, \"Invalid payload for Completion message.\");\r\n        }\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for Completion message.\");\r\n    };\r\n    JsonHubProtocol.prototype.assertNotEmptyString = function (value, errorMessage) {\r\n        if (typeof value !== \"string\" || value === \"\") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    };\r\n    return JsonHubProtocol;\r\n}());\r\nexport { JsonHubProtocol };\r\n//# sourceMappingURL=JsonHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nimport { DefaultReconnectPolicy } from \"./DefaultReconnectPolicy\";\r\nimport { HttpConnection } from \"./HttpConnection\";\r\nimport { HubConnection } from \"./HubConnection\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { JsonHubProtocol } from \"./JsonHubProtocol\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { Arg, ConsoleLogger } from \"./Utils\";\r\n// tslint:disable:object-literal-sort-keys\r\nvar LogLevelNameMapping = {\r\n    trace: LogLevel.Trace,\r\n    debug: LogLevel.Debug,\r\n    info: LogLevel.Information,\r\n    information: LogLevel.Information,\r\n    warn: LogLevel.Warning,\r\n    warning: LogLevel.Warning,\r\n    error: LogLevel.Error,\r\n    critical: LogLevel.Critical,\r\n    none: LogLevel.None,\r\n};\r\nfunction parseLogLevel(name) {\r\n    // Case-insensitive matching via lower-casing\r\n    // Yes, I know case-folding is a complicated problem in Unicode, but we only support\r\n    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.\r\n    var mapping = LogLevelNameMapping[name.toLowerCase()];\r\n    if (typeof mapping !== \"undefined\") {\r\n        return mapping;\r\n    }\r\n    else {\r\n        throw new Error(\"Unknown log level: \" + name);\r\n    }\r\n}\r\n/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */\r\nvar HubConnectionBuilder = /** @class */ (function () {\r\n    function HubConnectionBuilder() {\r\n    }\r\n    HubConnectionBuilder.prototype.configureLogging = function (logging) {\r\n        Arg.isRequired(logging, \"logging\");\r\n        if (isLogger(logging)) {\r\n            this.logger = logging;\r\n        }\r\n        else if (typeof logging === \"string\") {\r\n            var logLevel = parseLogLevel(logging);\r\n            this.logger = new ConsoleLogger(logLevel);\r\n        }\r\n        else {\r\n            this.logger = new ConsoleLogger(logging);\r\n        }\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withUrl = function (url, transportTypeOrOptions) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isNotEmpty(url, \"url\");\r\n        this.url = url;\r\n        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed\r\n        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.\r\n        if (typeof transportTypeOrOptions === \"object\") {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, transportTypeOrOptions);\r\n        }\r\n        else {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, { transport: transportTypeOrOptions });\r\n        }\r\n        return this;\r\n    };\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.\r\n     *\r\n     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.\r\n     */\r\n    HubConnectionBuilder.prototype.withHubProtocol = function (protocol) {\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.protocol = protocol;\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withAutomaticReconnect = function (retryDelaysOrReconnectPolicy) {\r\n        if (this.reconnectPolicy) {\r\n            throw new Error(\"A reconnectPolicy has already been set.\");\r\n        }\r\n        if (!retryDelaysOrReconnectPolicy) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy();\r\n        }\r\n        else if (Array.isArray(retryDelaysOrReconnectPolicy)) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);\r\n        }\r\n        else {\r\n            this.reconnectPolicy = retryDelaysOrReconnectPolicy;\r\n        }\r\n        return this;\r\n    };\r\n    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.\r\n     *\r\n     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.\r\n     */\r\n    HubConnectionBuilder.prototype.build = function () {\r\n        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one\r\n        // provided to configureLogger\r\n        var httpConnectionOptions = this.httpConnectionOptions || {};\r\n        // If it's 'null', the user **explicitly** asked for null, don't mess with it.\r\n        if (httpConnectionOptions.logger === undefined) {\r\n            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.\r\n            httpConnectionOptions.logger = this.logger;\r\n        }\r\n        // Now create the connection\r\n        if (!this.url) {\r\n            throw new Error(\"The 'HubConnectionBuilder.withUrl' method must be called before building the connection.\");\r\n        }\r\n        var connection = new HttpConnection(this.url, httpConnectionOptions);\r\n        return HubConnection.create(connection, this.logger || NullLogger.instance, this.protocol || new JsonHubProtocol(), this.reconnectPolicy);\r\n    };\r\n    return HubConnectionBuilder;\r\n}());\r\nexport { HubConnectionBuilder };\r\nfunction isLogger(logger) {\r\n    return logger.log !== undefined;\r\n}\r\n//# sourceMappingURL=HubConnectionBuilder.js.map"],"sourceRoot":""}